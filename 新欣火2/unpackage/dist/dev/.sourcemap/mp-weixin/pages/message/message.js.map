{"version":3,"sources":["uni-app:///main.js","webpack:///D:/ä»£ç /å°ç¨‹åº/æ–°æ¬£ç«1/pages/message/message.vue?d5df","webpack:///D:/ä»£ç /å°ç¨‹åº/æ–°æ¬£ç«1/pages/message/message.vue?000b","webpack:///D:/ä»£ç /å°ç¨‹åº/æ–°æ¬£ç«1/pages/message/message.vue?2807","webpack:///D:/ä»£ç /å°ç¨‹åº/æ–°æ¬£ç«1/pages/message/message.vue?5ef4","uni-app:///pages/message/message.vue","webpack:///D:/ä»£ç /å°ç¨‹åº/æ–°æ¬£ç«1/pages/message/message.vue?4a86","webpack:///D:/ä»£ç /å°ç¨‹åº/æ–°æ¬£ç«1/pages/message/message.vue?9d51"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","userInfo","activeTab","messages","loading","showSubscriptionPrompt","computed","filteredMessages","onShow","methods","loadMessages","uniCloud","name","action","page","pageSize","newsRes","systemMessages","_id","title","content","contentBlocks","type","read","createTime","source","newsId","courseChangeMessages","courseChangeRes","filter","map","applicationId","console","sort","loadDemoMessages","extractTextFromContentBlocks","join","getMessagePreview","switchTab","readMessage","message","uni","url","icon","markAllRead","msg","clearAllMessages","success","formatTime","yesterday","checkSubscriptionStatus","openid","res","goToSubscription"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,gBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgI;AAChI;AAC2D;AACL;AACqC;;;AAG3F;AACgL;AAChL,gBAAgB,uLAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,8FAAM;AACR,EAAE,uGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,kGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAAqqB,CAAgB,mqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCsGzrB;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MAAA;MACA;QACA;MACA;MACA;QAAA;MAAA;IACA;EACA;EACAC;IACA;IACA;IACA;EACA;EACAC;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBAAA;gBAAA;gBAAA,OAGAC;kBACAC;kBACAZ;oBACAa;oBACAC;oBACAC;kBACA;gBACA;cAAA;gBAPAC;gBASAC;gBACA;kBACAA;oBAAA;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;oBACA;kBAAA;gBACA;;gBAEA;gBACAC;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OAEAhB;kBACAC;kBACAZ;oBACAa;kBACA;gBACA;cAAA;gBALAe;gBAOA;kBACAD,mDACAE;oBAAA;kBAAA,GACAC;oBAAA;sBACAZ;sBACAC;sBACAC;sBACAE;sBACAC;sBACAC;sBACAC;sBACAM;oBACA;kBAAA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;cAAA;gBAIA;gBACA,sIACAC;kBAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAD;gBACA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAE;MACA;MACA,iBACA;QACAhB;QACAC;QACAC;QACAE;QACAC;QACAC;MACA,GACA;QACAN;QACAC;QACAC;QACAE;QACAC;QACAC;MACA,GACA;QACAN;QACAC;QACAC;QACAE;QACAC;QACAC;MACA,GACA;QACAN;QACAC;QACAC;QACAE;QACAC;QACAC;MACA,EACA;IACA;IAEAW;MACA;MAEA,qBACAN;QAAA;MAAA,GACAC;QAAA;MAAA,GACAM;IACA;IAEAC;MACA;MACA;QACA;MACA;MACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MACAC;;MAEA;MACA;QACA;QACAC;UACAC;QACA;MACA;QACA;QACAD;UACAC;QACA;MACA;QACAD;UACAtB;UACAwB;QACA;MACA;IACA;IAEAC;MACA;QACAC;MACA;MACAJ;QACAtB;QACAwB;MACA;IACA;IAEAG;MAAA;MACAL;QACAtB;QACAC;QACA2B;UACA;YACA;YACAN;cACAtB;cACAwB;YACA;UACA;QACA;MACA;IACA;IAEAK;MACA;MACA;MACA;;MAEA;MACA;QACA;MACA;;MAEA;MACA;MACAC;MACA;QACA;MACA;;MAEA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAC;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBACA;gBAAA;cAAA;gBAAA;gBAAA,OAKAxC;kBACAC;kBACAZ;oBACAa;oBACAsC;kBACA;gBACA;cAAA;gBANAC;gBAQA;kBACA;gBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEApB;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAqB;MACAZ;QACAC;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC1WA;AAAA;AAAA;AAAA;AAA0+B,CAAgB,o8BAAG,EAAC,C;;;;;;;;;;;ACA9/B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/message/message.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/message/message.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./message.vue?vue&type=template&id=a91f51d4&scoped=true&\"\nvar renderjs\nimport script from \"./message.vue?vue&type=script&lang=js&\"\nexport * from \"./message.vue?vue&type=script&lang=js&\"\nimport style0 from \"./message.vue?vue&type=style&index=0&id=a91f51d4&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a91f51d4\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/message/message.vue\"\nexport default component.exports","export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=template&id=a91f51d4&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = !_vm.loading ? _vm.filteredMessages.length : null\n  var l0 =\n    !_vm.loading && !(g0 === 0)\n      ? _vm.__map(_vm.filteredMessages, function (message, __i0__) {\n          var $orig = _vm.__get_orig(message)\n          var m0 = _vm.getMessagePreview(message)\n          var m1 = _vm.formatTime(message.createTime)\n          return {\n            $orig: $orig,\n            m0: m0,\n            m1: m1,\n          }\n        })\n      : null\n  var g1 = _vm.filteredMessages.length > 0 && !_vm.loading\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        l0: l0,\n        g1: g1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"message-page\">\n    <view class=\"status-bar\"></view>\n    <view class=\"top-bar\">\n      <view class=\"top-nav\">\n        <view class=\"page-title\">æ¶ˆæ¯ä¸­å¿ƒ</view>\n      </view>\n    </view>\n    \n    <!-- æ¶ˆæ¯åˆ†ç±»æ ‡ç­¾ -->\n    <view class=\"message-tabs\">\n      <view \n        class=\"tab-item\" \n        :class=\"{ active: activeTab === 'all' }\"\n        @click=\"switchTab('all')\"\n      >\n        å…¨éƒ¨\n      </view>\n      <view \n        class=\"tab-item\" \n        :class=\"{ active: activeTab === 'notification' }\"\n        @click=\"switchTab('notification')\"\n      >\n        é€šçŸ¥\n      </view>\n      <view \n        class=\"tab-item\" \n        :class=\"{ active: activeTab === 'system' }\"\n        @click=\"switchTab('system')\"\n      >\n        ç³»ç»Ÿæ¶ˆæ¯\n      </view>\n    </view>\n    \n    <!-- æ¶ˆæ¯åˆ—è¡¨ -->\n    <view class=\"content\">\n      <!-- åŠ è½½çŠ¶æ€ -->\n      <view v-if=\"loading\" class=\"loading-state\">\n        <view class=\"loading-icon\">ğŸ”„</view>\n        <view class=\"loading-text\">åŠ è½½ä¸­...</view>\n      </view>\n      \n      <!-- ç©ºçŠ¶æ€ -->\n      <view v-else-if=\"filteredMessages.length === 0\" class=\"empty-state\">\n        <view class=\"empty-icon\">ğŸ“­</view>\n        <view class=\"empty-text\">æš‚æ— æ¶ˆæ¯</view>\n        <view class=\"empty-desc\">æ‚¨è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ¶ˆæ¯</view>\n      </view>\n      \n      <!-- æ¶ˆæ¯åˆ—è¡¨ -->\n      <view v-else class=\"message-list\">\n        <view \n          v-for=\"message in filteredMessages\" \n          :key=\"message._id\" \n          class=\"message-item\"\n          :class=\"{ unread: !message.read }\"\n          @click=\"readMessage(message)\"\n        >\n          <view class=\"message-icon\">\n            <text v-if=\"message.type === 'notification'\">ğŸ””</text>\n            <text v-else-if=\"message.type === 'system'\">âš™ï¸</text>\n            <text v-else-if=\"message.type === 'schedule'\">ğŸ“…</text>\n            <text v-else-if=\"message.type === 'courseChange'\">ğŸ”„</text>\n            <text v-else>âœ‰ï¸</text>\n          </view>\n          <view class=\"message-content\">\n            <view class=\"message-title\">{{ message.title }}</view>\n            <view class=\"message-preview\">{{ getMessagePreview(message) }}</view>\n            <view class=\"message-meta\">\n              <text class=\"message-time\">{{ formatTime(message.createTime) }}</text>\n              <text v-if=\"!message.read\" class=\"unread-dot\">â—</text>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n    \n    <!-- åº•éƒ¨æ“ä½œæ  -->\n    <view class=\"bottom-actions\" v-if=\"filteredMessages.length > 0 && !loading\">\n      <button class=\"action-btn mark-all-read\" @click=\"markAllRead\">\n        å…¨éƒ¨å·²è¯»\n      </button>\n      <button class=\"action-btn clear-all\" @click=\"clearAllMessages\">\n        æ¸…ç©ºæ¶ˆæ¯\n      </button>\n    </view>\n    \n    <!-- è®¢é˜…è®¾ç½®æç¤º -->\n    <view class=\"subscription-prompt\" v-if=\"showSubscriptionPrompt\">\n      <view class=\"prompt-content\">\n        <view class=\"prompt-icon\">ğŸ””</view>\n        <view class=\"prompt-text\">\n          <view class=\"prompt-title\">å¼€å¯è®¢é˜…é€šçŸ¥</view>\n          <view class=\"prompt-desc\">åŠæ—¶æ¥æ”¶è¯¾ç¨‹å®‰æ’å’Œç³»ç»Ÿé€šçŸ¥</view>\n        </view>\n        <button class=\"prompt-btn\" @click=\"goToSubscription\">å»è®¾ç½®</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      userInfo: null,\n      activeTab: 'all',\n      messages: [],\n      loading: true,\n      showSubscriptionPrompt: false\n    }\n  },\n  computed: {\n    filteredMessages() {\n      if (this.activeTab === 'all') {\n        return this.messages;\n      }\n      return this.messages.filter(msg => msg.type === this.activeTab);\n    }\n  },\n  onShow() {\n    this.userInfo = uni.getStorageSync('userInfo');\n    this.loadMessages();\n    this.checkSubscriptionStatus();\n  },\n  methods: {\n    async loadMessages() {\n      this.loading = true;\n      try {\n        // è·å–ç³»ç»Ÿæ¶ˆæ¯ï¼ˆæ–°é—»ï¼‰\n        const newsRes = await uniCloud.callFunction({\n          name: 'news-service',\n          data: {\n            action: 'listNews',\n            page: 1,\n            pageSize: 20\n          }\n        });\n        \n        let systemMessages = [];\n        if (newsRes.result.code === 0) {\n          systemMessages = newsRes.result.data.map(news => ({\n            _id: 'news_' + news._id,\n            title: news.title,\n            content: this.extractTextFromContentBlocks(news.contentBlocks),\n            contentBlocks: news.contentBlocks,\n            type: 'system',\n            read: false,\n            createTime: new Date(news.createTime),\n            source: 'news',\n            newsId: news._id\n          }));\n        }\n        \n        // è·å–è°ƒè¯¾ç”³è¯·æ¶ˆæ¯ï¼ˆå¦‚æœæ˜¯ç®¡ç†å‘˜ï¼‰\n        let courseChangeMessages = [];\n        if (this.userInfo && (this.userInfo.permission === 'ç®¡ç†å‘˜' || this.userInfo.permission === 'superadmin')) {\n          try {\n            const courseChangeRes = await uniCloud.callFunction({\n              name: 'course-change',\n              data: {\n                action: 'list'\n              }\n            });\n            \n            if (courseChangeRes.result && courseChangeRes.result.success) {\n              courseChangeMessages = courseChangeRes.result.data\n                .filter(app => app.status === 'pending')\n                .map(app => ({\n                  _id: 'courseChange_' + app._id,\n                  title: 'è°ƒè¯¾ç”³è¯·å¾…å®¡æ‰¹',\n                  content: `${app.teacherName}ç”³è¯·è°ƒè¯¾ï¼š${app.courseName}ï¼ŒåŸæ—¶é—´ï¼š${app.originalDate} ${app.originalTime}ï¼Œæ–°æ—¶é—´ï¼š${app.newDate} ${app.newTime}`,\n                  type: 'courseChange',\n                  read: false,\n                  createTime: new Date(app.createTime),\n                  source: 'courseChange',\n                  applicationId: app._id\n                }));\n            }\n          } catch (error) {\n            console.error('è·å–è°ƒè¯¾ç”³è¯·å¤±è´¥:', error);\n          }\n        }\n        \n        // åˆå¹¶æ‰€æœ‰æ¶ˆæ¯å¹¶æŒ‰æ—¶é—´æ’åº\n        this.messages = [...systemMessages, ...courseChangeMessages]\n          .sort((a, b) => new Date(b.createTime) - new Date(a.createTime));\n          \n      } catch (error) {\n        console.error('è·å–æ¶ˆæ¯å¤±è´¥:', error);\n        this.loadDemoMessages();\n      } finally {\n        this.loading = false;\n      }\n    },\n    \n    loadDemoMessages() {\n      // å¦‚æœæ— æ³•è·å–çœŸå®æ•°æ®ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®\n      this.messages = [\n        {\n          _id: '1',\n          title: 'æ’è¯¾é€šçŸ¥',\n          content: 'æ‚¨æœ‰ä¸€èŠ‚æ–°çš„è¯¾ç¨‹å·²å®‰æ’ï¼Œè¯·æŸ¥çœ‹è¯¾è¡¨',\n          type: 'notification',\n          read: false,\n          createTime: new Date(Date.now() - 3600000) // 1å°æ—¶å‰\n        },\n        {\n          _id: '2',\n          title: 'ç³»ç»Ÿç»´æŠ¤é€šçŸ¥',\n          content: 'ç³»ç»Ÿå°†äºä»Šæ™š22:00-24:00è¿›è¡Œç»´æŠ¤ï¼Œè¯·æå‰ä¿å­˜æ•°æ®',\n          type: 'system',\n          read: true,\n          createTime: new Date(Date.now() - 86400000) // 1å¤©å‰\n        },\n        {\n          _id: '3',\n          title: 'è°ƒè¯¾ç”³è¯·',\n          content: 'æ‚¨æœ‰ä¸€æ¡è°ƒè¯¾ç”³è¯·å¾…å®¡æ‰¹',\n          type: 'courseChange',\n          read: false,\n          createTime: new Date(Date.now() - 1800000) // 30åˆ†é’Ÿå‰\n        },\n        {\n          _id: '4',\n          title: 'æ–°åŠŸèƒ½ä¸Šçº¿',\n          content: 'æˆç»©åˆ†æåŠŸèƒ½å·²ä¸Šçº¿ï¼Œæ¬¢è¿ä½“éªŒ',\n          type: 'system',\n          read: true,\n          createTime: new Date(Date.now() - 172800000) // 2å¤©å‰\n        }\n      ];\n    },\n    \n    extractTextFromContentBlocks(contentBlocks) {\n      if (!contentBlocks || !Array.isArray(contentBlocks)) return '';\n      \n      return contentBlocks\n        .filter(block => block.type === 'text')\n        .map(block => block.content)\n        .join(' ');\n    },\n    \n    getMessagePreview(message) {\n      // å¦‚æœæœ‰contentBlocksï¼Œæå–çº¯æ–‡æœ¬é¢„è§ˆ\n      if (message.contentBlocks) {\n        return this.extractTextFromContentBlocks(message.contentBlocks).substring(0, 50) + '...';\n      }\n      // å¦åˆ™ä½¿ç”¨contentå­—æ®µ\n      return message.content ? message.content.substring(0, 50) + '...' : '';\n    },\n    \n    switchTab(tab) {\n      this.activeTab = tab;\n    },\n    \n    readMessage(message) {\n      // æ ‡è®°ä¸ºå·²è¯»\n      message.read = true;\n      \n      // æ ¹æ®æ¶ˆæ¯ç±»å‹è¿›è¡Œä¸åŒå¤„ç†\n      if (message.source === 'news') {\n        // ç³»ç»Ÿæ–°é—»æ¶ˆæ¯ï¼Œè·³è½¬åˆ°è¯¦æƒ…é¡µ\n        uni.navigateTo({\n          url: `/pages/news-detail/news-detail?id=${message.newsId}`\n        });\n      } else if (message.source === 'courseChange') {\n        // è°ƒè¯¾ç”³è¯·æ¶ˆæ¯ï¼Œè·³è½¬åˆ°å®¡æ‰¹é¡µé¢\n        uni.navigateTo({\n          url: `/pages/course-change-approval/course-change-approval`\n        });\n      } else {\n        uni.showToast({\n          title: 'æ ‡è®°ä¸ºå·²è¯»',\n          icon: 'none'\n        });\n      }\n    },\n    \n    markAllRead() {\n      this.messages.forEach(msg => {\n        msg.read = true;\n      });\n      uni.showToast({\n        title: 'å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»',\n        icon: 'success'\n      });\n    },\n    \n    clearAllMessages() {\n      uni.showModal({\n        title: 'æ¸…ç©ºæ¶ˆæ¯',\n        content: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ¶ˆæ¯å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤',\n        success: (res) => {\n          if (res.confirm) {\n            this.messages = [];\n            uni.showToast({\n              title: 'æ¶ˆæ¯å·²æ¸…ç©º',\n              icon: 'success'\n            });\n          }\n        }\n      });\n    },\n    \n    formatTime(time) {\n      const now = new Date();\n      const msgTime = new Date(time);\n      const diff = now - msgTime;\n      \n      // å¦‚æœæ˜¯ä»Šå¤©\n      if (msgTime.toDateString() === now.toDateString()) {\n        return `${msgTime.getHours().toString().padStart(2, '0')}:${msgTime.getMinutes().toString().padStart(2, '0')}`;\n      }\n      \n      // å¦‚æœæ˜¯æ˜¨å¤©\n      const yesterday = new Date(now);\n      yesterday.setDate(yesterday.getDate() - 1);\n      if (msgTime.toDateString() === yesterday.toDateString()) {\n        return `æ˜¨å¤© ${msgTime.getHours().toString().padStart(2, '0')}:${msgTime.getMinutes().toString().padStart(2, '0')}`;\n      }\n      \n      // å…¶ä»–æƒ…å†µæ˜¾ç¤ºæ—¥æœŸ\n      return `${msgTime.getMonth() + 1}-${msgTime.getDate()}`;\n    },\n    \n    // æ£€æŸ¥è®¢é˜…çŠ¶æ€\n    async checkSubscriptionStatus() {\n      try {\n        const openid = uni.getStorageSync('openid');\n        if (!openid) {\n          this.showSubscriptionPrompt = true;\n          return;\n        }\n        \n        // æ£€æŸ¥äº‘ç«¯è®¢é˜…çŠ¶æ€\n        const res = await uniCloud.callFunction({\n          name: 'subscription-message',\n          data: {\n            action: 'get-subscription-status',\n            openid: openid\n          }\n        });\n        \n        if (res.result.code === 200) {\n          this.showSubscriptionPrompt = !res.result.data.isSubscribed;\n        } else {\n          this.showSubscriptionPrompt = true;\n        }\n      } catch (error) {\n        console.error('æ£€æŸ¥è®¢é˜…çŠ¶æ€å¤±è´¥:', error);\n        this.showSubscriptionPrompt = true;\n      }\n    },\n    \n    // è·³è½¬åˆ°è®¢é˜…è®¾ç½®é¡µé¢\n    goToSubscription() {\n      uni.navigateTo({\n        url: '/pages/subscription-settings/subscription-settings'\n      });\n    }\n  }\n}\n</script>\n\n<style scoped>\n.message-page {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.status-bar {\n  height: var(--status-bar-height);\n  background-color: #1976D2;\n}\n\n.top-bar {\n  background-color: #1976D2;\n  padding: 20rpx 30rpx;\n}\n\n.top-nav {\n  display: flex;\n  align-items: center;\n  position: relative;\n}\n\n.page-title {\n  color: white;\n  font-size: 36rpx;\n  font-weight: bold;\n  text-align: center;\n  flex: 1;\n}\n\n/* æ¶ˆæ¯åˆ†ç±»æ ‡ç­¾ */\n.message-tabs {\n  display: flex;\n  background: white;\n  border-bottom: 1rpx solid #e0e0e0;\n}\n\n.tab-item {\n  flex: 1;\n  text-align: center;\n  padding: 25rpx 0;\n  font-size: 30rpx;\n  color: #666;\n  position: relative;\n}\n\n.tab-item.active {\n  color: #1976D2;\n  font-weight: 500;\n}\n\n.tab-item.active::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: 25%;\n  width: 50%;\n  height: 6rpx;\n  background: #1976D2;\n  border-radius: 3rpx;\n}\n\n.content {\n  padding: 20rpx;\n  min-height: calc(100vh - 200rpx);\n}\n\n/* åŠ è½½çŠ¶æ€ */\n.loading-state {\n  text-align: center;\n  padding: 100rpx 40rpx;\n}\n\n.loading-icon {\n  font-size: 80rpx;\n  margin-bottom: 30rpx;\n  animation: rotate 1s linear infinite;\n}\n\n@keyframes rotate {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.loading-text {\n  font-size: 32rpx;\n  color: #666;\n}\n\n/* ç©ºçŠ¶æ€ */\n.empty-state {\n  text-align: center;\n  padding: 100rpx 40rpx;\n}\n\n.empty-icon {\n  font-size: 120rpx;\n  margin-bottom: 30rpx;\n}\n\n.empty-text {\n  font-size: 36rpx;\n  color: #333;\n  margin-bottom: 20rpx;\n}\n\n.empty-desc {\n  font-size: 28rpx;\n  color: #999;\n}\n\n/* æ¶ˆæ¯åˆ—è¡¨ */\n.message-list {\n  background: white;\n  border-radius: 20rpx;\n  overflow: hidden;\n}\n\n.message-item {\n  display: flex;\n  padding: 30rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.message-item:last-child {\n  border-bottom: none;\n}\n\n.message-item.unread {\n  background: #f0f8ff;\n}\n\n.message-icon {\n  width: 80rpx;\n  height: 80rpx;\n  background: #e3f2fd;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40rpx;\n  margin-right: 20rpx;\n  flex-shrink: 0;\n}\n\n.message-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.message-title {\n  font-size: 32rpx;\n  color: #333;\n  font-weight: 500;\n  margin-bottom: 10rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.message-preview {\n  font-size: 28rpx;\n  color: #666;\n  margin-bottom: 15rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n\n.message-meta {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.message-time {\n  font-size: 24rpx;\n  color: #999;\n}\n\n.unread-dot {\n  color: #ff6b6b;\n  font-size: 20rpx;\n}\n\n/* åº•éƒ¨æ“ä½œæ  */\n.bottom-actions {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: white;\n  padding: 20rpx;\n  display: flex;\n  justify-content: space-around;\n  border-top: 1rpx solid #e0e0e0;\n}\n\n.action-btn {\n  flex: 1;\n  margin: 0 10rpx;\n  padding: 20rpx 0;\n  border-radius: 50rpx;\n  font-size: 28rpx;\n  border: none;\n}\n\n.mark-all-read {\n  background: #1976D2;\n  color: white;\n}\n\n.clear-all {\n  background: #f5f5f5;\n  color: #666;\n}\n\n.action-btn:active {\n  opacity: 0.8;\n}\n\n/* è®¢é˜…è®¾ç½®æç¤º */\n.subscription-prompt {\n  position: fixed;\n  bottom: 120rpx;\n  left: 20rpx;\n  right: 20rpx;\n  background: white;\n  border-radius: 20rpx;\n  box-shadow: 0 10rpx 30rpx rgba(0, 0, 0, 0.1);\n  padding: 30rpx;\n  z-index: 100;\n}\n\n.prompt-content {\n  display: flex;\n  align-items: center;\n}\n\n.prompt-icon {\n  font-size: 48rpx;\n  margin-right: 20rpx;\n  color: #1976D2;\n}\n\n.prompt-text {\n  flex: 1;\n}\n\n.prompt-title {\n  font-size: 32rpx;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 10rpx;\n}\n\n.prompt-desc {\n  font-size: 24rpx;\n  color: #666;\n}\n\n.prompt-btn {\n  background: #1976D2;\n  color: white;\n  border: none;\n  border-radius: 50rpx;\n  padding: 15rpx 30rpx;\n  font-size: 24rpx;\n}\n</style>","import mod from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=style&index=0&id=a91f51d4&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=style&index=0&id=a91f51d4&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1759881831276\n      var cssReload = require(\"D:/hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}