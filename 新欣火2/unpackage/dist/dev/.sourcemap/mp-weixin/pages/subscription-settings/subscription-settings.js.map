{"version":3,"sources":["uni-app:///main.js","webpack:///D:/代码/小程序/新欣火1/pages/subscription-settings/subscription-settings.vue?0528","webpack:///D:/代码/小程序/新欣火1/pages/subscription-settings/subscription-settings.vue?4b9b","webpack:///D:/代码/小程序/新欣火1/pages/subscription-settings/subscription-settings.vue?4362","webpack:///D:/代码/小程序/新欣火1/pages/subscription-settings/subscription-settings.vue?0303","uni-app:///pages/subscription-settings/subscription-settings.vue","webpack:///D:/代码/小程序/新欣火1/pages/subscription-settings/subscription-settings.vue?24de","webpack:///D:/代码/小程序/新欣火1/pages/subscription-settings/subscription-settings.vue?48f6"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","isSubscribed","isSubscribing","hasOpenid","isBinding","isTesting","templateId","onMounted","console","onShow","methods","goBack","uni","checkUserStatus","localStatus","openid","onSubscriptionToggle","isOn","enableSubscription","tmplIds","authResult","status","lastUpdate","cacheExpiry","uniCloud","name","action","syncResult","title","icon","content","showCancel","confirmText","disableSubscription","handleWechatBinding","success","bindWechat","provider","loginResult","userInfo","params","code","userId","res","errorMsg","sendTestMessage","statusResult","now","tomorrow","year","month","date","formattedDateTime","uniqueId","messageData","courseName","classTime","remark","studentName","page","result","cloudResult","msgid","method","note","originalError","isLocalSubscribed","localSubscribed","errorCode"],"mappings":"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","file":"pages/subscription-settings/subscription-settings.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/subscription-settings/subscription-settings.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./subscription-settings.vue?vue&type=template&id=2075e12e&scoped=true&\"\nvar renderjs\nimport script from \"./subscription-settings.vue?vue&type=script&lang=js&\"\nexport * from \"./subscription-settings.vue?vue&type=script&lang=js&\"\nimport style0 from \"./subscription-settings.vue?vue&type=style&index=0&id=2075e12e&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2075e12e\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/subscription-settings/subscription-settings.vue\"\nexport default component.exports","export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./subscription-settings.vue?vue&type=template&id=2075e12e&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./subscription-settings.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./subscription-settings.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"page-container\">\r\n\t\t<!-- 状态栏 -->\r\n\t\t<view class=\"status-bar\"></view>\r\n\t\t\r\n\t\t<!-- 顶部导航栏 -->\r\n\t\t<view class=\"top-bar\">\r\n\t\t\t<view class=\"top-nav\">\r\n\t\t\t\t<view class=\"back-btn\" @click=\"goBack\">\r\n\t\t\t\t\t<text class=\"back-icon\">←</text>\r\n\t\t\t\t\t<text>返回</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"page-title\">订阅通知设置</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 主要内容 -->\r\n\t\t<view class=\"content\">\r\n\t\t\t<!-- 订阅通知开关区域 -->\r\n\t\t\t<view class=\"subscription-section\">\r\n\t\t\t\t<view class=\"section-title\">📨 订阅通知</view>\r\n\t\t\t\t<view class=\"section-desc\">开启订阅通知，及时接收课程安排信息</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 订阅开关 -->\r\n\t\t\t\t<view class=\"switch-container\">\r\n\t\t\t\t\t<view class=\"switch-label\">\r\n\t\t\t\t\t\t<text class=\"switch-text\">订阅消息通知</text>\r\n\t\t\t\t\t\t<text class=\"switch-status\">{{ isSubscribed ? '已开启' : '已关闭' }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<switch \r\n\t\t\t\t\t\t:checked=\"isSubscribed\" \r\n\t\t\t\t\t\t@change=\"onSubscriptionToggle\"\r\n\t\t\t\t\t\tcolor=\"#667eea\" \r\n\t\t\t\t\t\tclass=\"subscription-switch\" />\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 微信绑定区域 -->\r\n\t\t\t<view class=\"wechat-section\">\r\n\t\t\t\t<view class=\"section-title\">🔗 微信绑定</view>\r\n\t\t\t\t<view class=\"section-desc\">{{ hasOpenid ? '微信已绑定，可以接收消息' : '绑定微信账号以接收订阅消息' }}</view>\r\n\t\t\t\t\r\n\t\t\t\t<view class=\"wechat-action\">\r\n\t\t\t\t\t<button \r\n\t\t\t\t\t\tclass=\"wechat-btn\" \r\n\t\t\t\t\t\t:class=\"{ 'bound': hasOpenid }\"\r\n\t\t\t\t\t\t@click=\"handleWechatBinding\"\r\n\t\t\t\t\t\t:loading=\"isBinding\">\r\n\t\t\t\t\t\t{{ isBinding ? '绑定中...' : (hasOpenid ? '✓ 已绑定微信' : '绑定微信') }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 测试消息区域 -->\r\n\t\t\t<view class=\"test-section\" v-if=\"isSubscribed && hasOpenid\">\r\n\t\t\t\t<view class=\"section-title\">🧪 测试消息</view>\r\n\t\t\t\t<view class=\"section-desc\">发送一条测试订阅消息，验证功能是否正常</view>\r\n\t\t\t\t\r\n\t\t\t\t<view class=\"test-action\">\r\n\t\t\t\t\t<button \r\n\t\t\t\t\t\tclass=\"test-btn\" \r\n\t\t\t\t\t\t@click=\"sendTestMessage\"\r\n\t\t\t\t\t\t:loading=\"isTesting\">\r\n\t\t\t\t\t\t{{ isTesting ? '发送中...' : '📤 发送测试消息' }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\t// 订阅状态\r\n\t\t\tisSubscribed: false,\r\n\t\t\tisSubscribing: false,\r\n\t\t\t\r\n\t\t\t// 微信绑定状态（遵循项目规范增加状态管理）\r\n\t\t\thasOpenid: false,\r\n\t\t\tisBinding: false,\r\n\t\t\t\r\n\t\t\t// 测试消息状态\r\n\t\t\tisTesting: false,\r\n\t\t\t\r\n\t\t\t// 微信订阅消息配置\r\n\t\t\ttemplateId: 'sOwar1Xkzk4ApC2eQvvc4SZFH6UbFz_ZA8DZjHHPZf4' // 排课通知模板ID\r\n\t\t};\r\n\t},\r\n\t\r\n\t// 页面加载时执行\r\n\tonMounted() {\r\n\t\tconsole.log('🚀 订阅设置页面加载完成');\r\n\t\tthis.checkUserStatus();\r\n\t},\r\n\t\r\n\t// 页面显示时执行\r\n\tonShow() {\r\n\t\tconsole.log('👁️ 订阅设置页面显示');\r\n\t\tthis.checkUserStatus();\r\n\t},\r\n\t\r\n\tmethods: {\r\n\t\tgoBack() {\r\n\t\t\tuni.navigateBack();\r\n\t\t},\r\n\t\t\r\n\t\t// 检查用户状态（订阅状态和微信绑定状态）\r\n\t\tasync checkUserStatus() {\r\n\t\t\ttry {\r\n\t\t\t\t// 检查订阅状态\r\n\t\t\t\tconst localStatus = uni.getStorageSync('subscriptionStatus');\r\n\t\t\t\tif (localStatus && localStatus.isSubscribed) {\r\n\t\t\t\t\tthis.isSubscribed = true;\r\n\t\t\t\t\tconsole.log('✅ 本地订阅状态：已订阅');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.isSubscribed = false;\r\n\t\t\t\t\tconsole.log('❌ 本地订阅状态：未订阅');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 检查微信绑定状态\r\n\t\t\t\tconst openid = uni.getStorageSync('openid');\r\n\t\t\t\tif (openid) {\r\n\t\t\t\t\tthis.hasOpenid = true;\r\n\t\t\t\t\tconsole.log('✅ 微信已绑定:', openid);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.hasOpenid = false;\r\n\t\t\t\t\tconsole.log('❌ 微信未绑定');\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('检查用户状态失败:', error);\r\n\t\t\t\tthis.isSubscribed = false;\r\n\t\t\t\tthis.hasOpenid = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 订阅开关切换处理\r\n\t\tasync onSubscriptionToggle(event) {\r\n\t\t\tconst isOn = event.detail.value;\r\n\t\t\tconsole.log(`🔄 订阅开关切换: ${isOn ? '开启' : '关闭'}`);\r\n\t\t\t\r\n\t\t\tif (isOn) {\r\n\t\t\t\t// 开启订阅\r\n\t\t\t\tawait this.enableSubscription();\r\n\t\t\t} else {\r\n\t\t\t\t// 关闭订阅\r\n\t\t\t\tthis.disableSubscription();\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 开启订阅\r\n\t\tasync enableSubscription() {\r\n\t\t\tthis.isSubscribing = true;\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('🔐 请求订阅消息授权...');\r\n\t\t\t\t\r\n\t\t\t\t// 调用微信订阅消息授权接口\r\n\t\t\t\tconst authResult = await uni.requestSubscribeMessage({\r\n\t\t\t\t\ttmplIds: [this.templateId]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('📱 微信授权结果:', authResult);\r\n\t\t\t\t\r\n\t\t\t\tif (authResult[this.templateId] === 'accept') {\r\n\t\t\t\t\tconsole.log('✅ 用户接受订阅消息授权');\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 更新订阅状态\r\n\t\t\t\t\tthis.isSubscribed = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 保存到本地存储\r\n\t\t\t\t\tuni.setStorageSync('subscriptionStatus', {\r\n\t\t\t\t\t\tisSubscribed: true,\r\n\t\t\t\t\t\tstatus: 'accepted',\r\n\t\t\t\t\t\tlastUpdate: Date.now(),\r\n\t\t\t\t\t\tcacheExpiry: Date.now() + (365 * 24 * 60 * 60 * 1000) // 1年有效期\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 调用云函数同步授权状态到数据库（创建伪永久订阅记录）\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst openid = uni.getStorageSync('openid');\r\n\t\t\t\t\t\tif (openid) {\r\n\t\t\t\t\t\t\tconsole.log('📤 同步主订阅授权状态到云端数据库...');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst syncResult = await uniCloud.callFunction({\r\n\t\t\t\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: 'request-subscription',\r\n\t\t\t\t\t\t\t\t\topenid: openid,\r\n\t\t\t\t\t\t\t\t\ttemplateId: this.templateId,\r\n\t\t\t\t\t\t\t\t\tstatus: 'accepted'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconsole.log('✅ 主订阅云端数据库同步结果:', syncResult);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (syncResult.result.code === 200) {\r\n\t\t\t\t\t\t\t\tconsole.log('✅ 主订阅伪永久记录创建成功');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.log('⚠️ 主订阅伪永久记录创建失败:', syncResult.result.message);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('⚠️ 未找到openid，跳过云端同步');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (syncError) {\r\n\t\t\t\t\t\tconsole.error('同步主订阅授权状态到云端失败:', syncError);\r\n\t\t\t\t\t\t// 不影响本地授权状态\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '订阅成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (authResult[this.templateId] === 'reject') {\r\n\t\t\t\t\tconsole.log('❌ 用户拒绝订阅消息授权');\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 恢复开关状态\r\n\t\t\t\t\tthis.isSubscribed = false;\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '订阅被拒绝',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('⚠️ 订阅消息授权失败:', authResult[this.templateId]);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 恢复开关状态\r\n\t\t\t\t\tthis.isSubscribed = false;\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '授权失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('请求订阅授权失败:', error);\r\n\t\t\t\t\r\n\t\t\t\t// 恢复开关状态\r\n\t\t\t\tthis.isSubscribed = false;\r\n\t\t\t\t\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '授权失败',\r\n\t\t\t\t\tcontent: '无法获取订阅消息授权，请稍后重试。',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tconfirmText: '知道了'\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isSubscribing = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 关闭订阅\r\n\t\tdisableSubscription() {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('🔒 关闭订阅通知...');\r\n\t\t\t\t\r\n\t\t\t\t// 更新本地状态\r\n\t\t\t\tthis.isSubscribed = false;\r\n\t\t\t\t\r\n\t\t\t\t// 清除本地存储\r\n\t\t\t\tuni.removeStorageSync('subscriptionStatus');\r\n\t\t\t\t\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '已关闭订阅',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t});\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('关闭订阅失败:', error);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 处理微信绑定\r\n\t\tasync handleWechatBinding() {\r\n\t\t\tif (this.hasOpenid) {\r\n\t\t\t\t// 已绑定，可以重新绑定\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '重新绑定',\r\n\t\t\t\t\tcontent: '是否要重新绑定微信账号？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tthis.bindWechat();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// 未绑定，进行绑定\r\n\t\t\t\tthis.bindWechat();\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 绑定微信\r\n\t\tasync bindWechat() {\r\n\t\t\tif (this.isBinding) {\r\n\t\t\t\tconsole.log('正在绑定中，跳过重复操作');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tthis.isBinding = true;\r\n\t\t\t\t\r\n\t\t\t\t// 检查是否在微信小程序环境\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '正在绑定...'\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// 获取微信登录code\r\n\t\t\t\tconst loginResult = await uni.login({\r\n\t\t\t\t\tprovider: 'weixin'\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif (loginResult.code) {\r\n\t\t\t\t\t// 检查用户是否已登录\r\n\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo');\r\n\t\t\t\t\tif (!userInfo || !userInfo._id) {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '需要登录',\r\n\t\t\t\t\t\t\tcontent: '请先登录系统后再绑定微信',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 调用云函数绑定微信\r\n\t\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'auth-service',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\taction: 'bind-wechat',\r\n\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\tcode: loginResult.code,\r\n\t\t\t\t\t\t\t\tuserId: userInfo._id\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (res.result.code === 200) {\r\n\t\t\t\t\t\t// 保存openid\r\n\t\t\t\t\t\tuni.setStorageSync('openid', res.result.openid);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 更新状态\r\n\t\t\t\t\t\tthis.hasOpenid = true;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '微信绑定成功',\r\n\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst errorMsg = res.result.message || '绑定失败';\r\n\t\t\t\t\t\tconsole.error('微信绑定失败:', res.result);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '微信绑定失败',\r\n\t\t\t\t\t\t\tcontent: errorMsg,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '获取微信授权失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\t\r\n\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请在微信小程序中使用',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\t// #endif\r\n\t\t\t} catch (error) {\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\tconsole.error('绑定微信失败:', error);\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '绑定失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isBinding = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 发送测试消息（单次发送，遵循项目规范）\r\n\t\tasync sendTestMessage() {\r\n\t\t\tif (this.isTesting) return;\r\n\t\t\t\r\n\t\t\tthis.isTesting = true;\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('🧪 开始发送测试订阅消息...');\r\n\t\t\t\t\r\n\t\t\t\t// 显示加载提示\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '检查订阅状态...'\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// 先检查云端是否已有伪永久订阅记录\r\n\t\t\t\tconst openid = uni.getStorageSync('openid');\r\n\t\t\t\tif (!openid) {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '需要绑定微信',\r\n\t\t\t\t\t\tcontent: '请先绑定微信账号后再发送测试消息。',\r\n\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\tconfirmText: '知道了'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 检查云端伪永久订阅状态\r\n\t\t\t\t\tconsole.log('🔍 检查云端伪永久订阅状态...');\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst statusResult = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\taction: 'get-subscription-status',\r\n\t\t\t\t\t\t\topenid: openid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log('📊 云端订阅状态检查结果:', statusResult);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (statusResult.result.code === 200 && statusResult.result.data.isSubscribed) {\r\n\t\t\t\t\t\t// 已有伪永久订阅记录，直接发送测试消息\r\n\t\t\t\t\t\tconsole.log('✅ 发现伪永久订阅记录，直接发送测试消息（无需重新授权）');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 更新加载提示\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: '发送测试消息...'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 未找到伪永久订阅记录，需要重新授权（仅首次）\r\n\t\t\t\t\t\tconsole.log('⚠️ 未找到伪永久订阅记录，需要进行首次授权');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst authResult = await uni.requestSubscribeMessage({\r\n\t\t\t\t\t\t\ttmplIds: [this.templateId]\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('📱 首次授权结果:', authResult);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (authResult[this.templateId] !== 'accept') {\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '需要授权',\r\n\t\t\t\t\t\t\t\tcontent: '首次使用测试功能需要您授权订阅消息，授权后后续不需重复授权。',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\tconfirmText: '知道了'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 创建伪永久订阅记录\r\n\t\t\t\t\t\tconst syncResult = await uniCloud.callFunction({\r\n\t\t\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\taction: 'request-subscription',\r\n\t\t\t\t\t\t\t\topenid: openid,\r\n\t\t\t\t\t\t\t\ttemplateId: this.templateId,\r\n\t\t\t\t\t\t\t\tstatus: 'accepted'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (syncResult.result.code === 200) {\r\n\t\t\t\t\t\t\tconsole.log('✅ 伪永久订阅记录创建成功，后续测试无需重复授权');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: '发送测试消息...'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (checkError) {\r\n\t\t\t\t\tconsole.error('检查云端订阅状态失败:', checkError);\r\n\t\t\t\t\t// 如果检查失败，回退到重新授权流程\r\n\t\t\t\t\tconst authResult = await uni.requestSubscribeMessage({\r\n\t\t\t\t\t\ttmplIds: [this.templateId]\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (authResult[this.templateId] !== 'accept') {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '需要授权',\r\n\t\t\t\t\t\t\tcontent: '发送测试消息需要您授权订阅消息。',\r\n\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\tconfirmText: '知道了'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '发送测试消息...'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 生成测试消息内容\r\n\t\t\t\tconst now = new Date();\r\n\t\t\t\tconst tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);\r\n\t\t\t\t\r\n\t\t\t\t// 使用微信API标准时间格式\r\n\t\t\t\tconst year = tomorrow.getFullYear();\r\n\t\t\t\tconst month = tomorrow.getMonth() + 1;\r\n\t\t\t\tconst date = tomorrow.getDate();\r\n\t\t\t\tconst formattedDateTime = `${year}年${month}月${date}日 18:00`;\r\n\t\t\t\t\r\n\t\t\t\t// 生成唯一的测试消息内容\r\n\t\t\t\tconst uniqueId = now.getTime();\r\n\t\t\t\tconst messageData = {\r\n\t\t\t\t\tcourseName: `测试课程-${uniqueId}`,\r\n\t\t\t\t\tclassTime: formattedDateTime,\r\n\t\t\t\t\tremark: `测试教室-${now.getSeconds()}秒`,\r\n\t\t\t\t\tstudentName: '测试学员',\r\n\t\t\t\t\tpage: 'pages/schedule-tab/schedule-tab'\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('📤 即将发送的测试消息数据:', messageData);\r\n\t\t\t\t\r\n\t\t\t\t// 调用云函数发送测试消息\r\n\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'send-schedule-notification',\r\n\t\t\t\t\t\topenid: openid,\r\n\t\t\t\t\t\t...messageData\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('📥 测试消息发送结果:', result);\r\n\t\t\t\t\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\r\n\t\t\t\t// 详细检查发送结果\r\n\t\t\t\tif (result.success && result.result) {\r\n\t\t\t\t\tconst cloudResult = result.result;\r\n\t\t\t\t\tconsole.log('☁️ 云函数返回结果详情:', cloudResult);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 检查云函数执行结果\r\n\t\t\t\t\tif (cloudResult.code === 200) {\r\n\t\t\t\t\t\tconst msgid = cloudResult.data?.msgid;\r\n\t\t\t\t\t\tconst method = cloudResult.data?.method || 'pseudo_permanent';\r\n\t\t\t\t\t\tconst note = cloudResult.data?.note || '';\r\n\t\t\t\t\t\tconst originalError = cloudResult.data?.originalError;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('✅ 云函数执行成功:', {\r\n\t\t\t\t\t\t\tmsgid: msgid,\r\n\t\t\t\t\t\t\tmethod: method,\r\n\t\t\t\t\t\t\tnote: note,\r\n\t\t\t\t\t\t\toriginalError: originalError\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 检查是否有微信API错误（如43101）\r\n\t\t\t\t\t\tif (originalError && (originalError.errcode === '43101' || originalError.errcode === 43101)) {\r\n\t\t\t\t\t\t\t// 检查本地订阅状态，提供更准确的指导\r\n\t\t\t\t\t\t\tconst isLocalSubscribed = this.isSubscribed;\r\n\t\t\t\t\t\t\tconsole.log('🔍 43101错误分析:', {\r\n\t\t\t\t\t\t\t\tlocalSubscribed: isLocalSubscribed,\r\n\t\t\t\t\t\t\t\terrorCode: originalError.errcode,\r\n\t\t\t\t\t\t\t\terrorMsg: originalError.errmsg\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 伪永久订阅功能：即使43101错误，也保持订阅状态有效\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '📱 微信通知设置提醒',\r\n\t\t\t\t\t\t\t\tcontent: `您的订阅状态正常，但微信可能在系统层面限制了通知。\\n\\n✅ 伪永久订阅仍然有效\\n✅ 无需重新授权\\n✅ 可继续正常发送\\n\\n如需接收微信通知，请检查：\\n1. 微信-设置-通用-小程序-通知管理\\n2. 确保开启了本小程序的通知权限`,\r\n\t\t\t\t\t\t\t\tconfirmText: '知道了',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if (msgid) {\r\n\t\t\t\t\t\t\t// 真正发送成功\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '✅ 测试成功',\r\n\t\t\t\t\t\t\t\tcontent: `测试订阅消息发送成功！\\n\\n消息ID: ${msgid}\\n发送时间: ${new Date().toLocaleString()}\\n发送方式: ${method}\\n\\n${note ? '说明: ' + note + '\\n\\n' : ''}请检查微信是否收到通知。`,\r\n\t\t\t\t\t\t\t\tconfirmText: '知道了',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 没有msgid，可能是特殊处理模式\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '✅ 处理成功',\r\n\t\t\t\t\t\t\t\tcontent: `测试消息已处理！\\n\\n处理时间: ${new Date().toLocaleString()}\\n处理方式: ${method}\\n\\n${note ? '说明: ' + note : '消息已按特殊策略处理'}`,\r\n\t\t\t\t\t\t\t\tconfirmText: '知道了',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 云函数返回错误\r\n\t\t\t\t\t\tthrow new Error(cloudResult.message || '云函数执行失败');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 云函数调用失败\r\n\t\t\t\t\tthrow new Error('云函数调用失败');\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\tconsole.error('发送测试消息失败:', error);\r\n\t\t\t\t\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '测试失败',\r\n\t\t\t\t\tcontent: `测试消息发送失败：\\n\\n${error.message}\\n\\n请检查网络连接或稍后重试。`,\r\n\t\t\t\t\tconfirmText: '知道了',\r\n\t\t\t\t\tshowCancel: false\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isTesting = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.page-container {\r\n\theight: 100vh;\r\n\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.status-bar {\r\n\theight: var(--status-bar-height);\r\n\tbackground: transparent;\r\n}\r\n\r\n.top-bar {\r\n\tbackground: rgba(255, 255, 255, 0.95);\r\n\tbackdrop-filter: blur(10px);\r\n\tborder-bottom: 1px solid rgba(255, 255, 255, 0.2);\r\n}\r\n\r\n.top-nav {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tpadding: 20rpx 30rpx;\r\n\tposition: relative;\r\n}\r\n\r\n.back-btn {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tcolor: #333;\r\n\tfont-size: 16px;\r\n\tcursor: pointer;\r\n}\r\n\r\n.back-icon {\r\n\tfont-size: 20px;\r\n\tmargin-right: 8rpx;\r\n}\r\n\r\n.page-title {\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttransform: translateX(-50%);\r\n\tfont-size: 18px;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n}\r\n\r\n.content {\r\n\tflex: 1;\r\n\tpadding: 30rpx;\r\n\toverflow-y: auto;\r\n}\r\n\r\n/* 通用区域样式 */\r\n.subscription-section,\r\n.wechat-section,\r\n.test-section {\r\n\tbackground: rgba(255, 255, 255, 0.95);\r\n\tborder-radius: 20rpx;\r\n\tpadding: 40rpx;\r\n\tmargin-bottom: 30rpx;\r\n\tbox-shadow: 0 10rpx 40rpx rgba(0, 0, 0, 0.1);\r\n\tbackdrop-filter: blur(10px);\r\n}\r\n\r\n.section-title {\r\n\tfont-size: 22px;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tmargin-bottom: 15rpx;\r\n}\r\n\r\n.section-desc {\r\n\tfont-size: 14px;\r\n\tcolor: #666;\r\n\tmargin-bottom: 30rpx;\r\n\tline-height: 1.6;\r\n}\r\n\r\n/* 开关容器样式 */\r\n.switch-container {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tpadding: 20rpx 0;\r\n}\r\n\r\n.switch-label {\r\n\tflex: 1;\r\n}\r\n\r\n.switch-text {\r\n\tfont-size: 16px;\r\n\tcolor: #333;\r\n\tfont-weight: 500;\r\n\tdisplay: block;\r\n\tmargin-bottom: 8rpx;\r\n}\r\n\r\n.switch-status {\r\n\tfont-size: 12px;\r\n\tcolor: #999;\r\n}\r\n\r\n.subscription-switch {\r\n\ttransform: scale(1.2);\r\n}\r\n\r\n/* 按钮样式 */\r\n.wechat-action,\r\n.test-action {\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n}\r\n\r\n.wechat-btn,\r\n.test-btn {\r\n\twidth: 280rpx;\r\n\theight: 70rpx;\r\n\tborder: none;\r\n\tborder-radius: 35rpx;\r\n\tfont-size: 16px;\r\n\tfont-weight: 500;\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.wechat-btn {\r\n\tbackground: linear-gradient(135deg, #52C41A, #73D13D);\r\n\tcolor: white;\r\n\tbox-shadow: 0 6rpx 20rpx rgba(82, 196, 26, 0.3);\r\n}\r\n\r\n.wechat-btn.bound {\r\n\tbackground: linear-gradient(135deg, #52C41A, #389E0D);\r\n\tbox-shadow: 0 6rpx 20rpx rgba(82, 196, 26, 0.4);\r\n}\r\n\r\n.test-btn {\r\n\tbackground: linear-gradient(135deg, #1890FF, #096DD9);\r\n\tcolor: white;\r\n\tbox-shadow: 0 6rpx 20rpx rgba(24, 144, 255, 0.3);\r\n}\r\n\r\n.wechat-btn:active,\r\n.test-btn:active {\r\n\ttransform: scale(0.95);\r\n}\r\n\r\n.wechat-btn::after,\r\n.test-btn::after {\r\n\tborder: none;\r\n}\r\n</style>","import mod from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./subscription-settings.vue?vue&type=style&index=0&id=2075e12e&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./subscription-settings.vue?vue&type=style&index=0&id=2075e12e&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1759881831275\n      var cssReload = require(\"D:/hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}