{"version":3,"sources":["uni-app:///main.js",null,"webpack:///D:/代码/小程序项目/新欣火1/pages/test-permanent-subscription/test-permanent-subscription.vue?e3b1","webpack:///D:/代码/小程序项目/新欣火1/pages/test-permanent-subscription/test-permanent-subscription.vue?3fbb","webpack:///D:/代码/小程序项目/新欣火1/pages/test-permanent-subscription/test-permanent-subscription.vue?e6ab","uni-app:///pages/test-permanent-subscription/test-permanent-subscription.vue","webpack:///D:/代码/小程序项目/新欣火1/pages/test-permanent-subscription/test-permanent-subscription.vue?b5a3","webpack:///D:/代码/小程序项目/新欣火1/pages/test-permanent-subscription/test-permanent-subscription.vue?4b1a"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","openid","isLoggedIn","subscriptionStatus","isRequesting","isChecking","isSending","batchCountIndex","batchOptions","logs","onLoad","methods","init","checkLoginStatus","requestSubscription","uni","tmplIds","authResult","uniCloud","name","action","templateId","status","result","checkSubscriptionStatus","sendTestMessage","timestamp","courseName","classTime","remark","studentName","page","sendBatchMessages","count","i","onBatchCountChange","formatTime","addLog","time","message","type","console","clearLogs"],"mappings":"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","file":"pages/test-permanent-subscription/test-permanent-subscription.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/test-permanent-subscription/test-permanent-subscription.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./test-permanent-subscription.vue?vue&type=template&id=17233ef6&scoped=true&\"\nvar renderjs\nimport script from \"./test-permanent-subscription.vue?vue&type=script&lang=js&\"\nexport * from \"./test-permanent-subscription.vue?vue&type=script&lang=js&\"\nimport style0 from \"./test-permanent-subscription.vue?vue&type=style&index=0&id=17233ef6&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"17233ef6\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/test-permanent-subscription/test-permanent-subscription.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./test-permanent-subscription.vue?vue&type=template&id=17233ef6&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 =\n    _vm.subscriptionStatus && _vm.subscriptionStatus.isPermanent\n      ? _vm.formatTime(_vm.subscriptionStatus.permanentSince)\n      : null\n  var m1 =\n    _vm.subscriptionStatus && _vm.subscriptionStatus.lastSendTime\n      ? _vm.formatTime(_vm.subscriptionStatus.lastSendTime)\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n        m1: m1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./test-permanent-subscription.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./test-permanent-subscription.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"header\">\r\n\t\t\t<text class=\"title\">永久订阅消息测试</text>\r\n\t\t\t<text class=\"subtitle\">验证一次授权多次发送功能</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 用户信息 -->\r\n\t\t<view class=\"info-section\">\r\n\t\t\t<view class=\"info-item\">\r\n\t\t\t\t<text class=\"label\">用户OpenID:</text>\r\n\t\t\t\t<text class=\"value\">{{ openid || '未获取' }}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"info-item\">\r\n\t\t\t\t<text class=\"label\">登录状态:</text>\r\n\t\t\t\t<text class=\"value\" :class=\"isLoggedIn ? 'success' : 'error'\">\r\n\t\t\t\t\t{{ isLoggedIn ? '已登录' : '未登录' }}\r\n\t\t\t\t</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 订阅状态 -->\r\n\t\t<view class=\"status-section\">\r\n\t\t\t<view class=\"section-title\">订阅状态信息</view>\r\n\t\t\t<view class=\"status-card\" v-if=\"subscriptionStatus\">\r\n\t\t\t\t<view class=\"status-item\">\r\n\t\t\t\t\t<text class=\"label\">订阅状态:</text>\r\n\t\t\t\t\t<text class=\"value\" :class=\"subscriptionStatus.isPermanent ? 'success' : 'warning'\">\r\n\t\t\t\t\t\t{{ subscriptionStatus.statusDescription }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"status-item\">\r\n\t\t\t\t\t<text class=\"label\">是否永久:</text>\r\n\t\t\t\t\t<text class=\"value\" :class=\"subscriptionStatus.isPermanent ? 'success' : 'error'\">\r\n\t\t\t\t\t\t{{ subscriptionStatus.isPermanent ? '是' : '否' }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"status-item\" v-if=\"subscriptionStatus.isPermanent\">\r\n\t\t\t\t\t<text class=\"label\">永久授权时间:</text>\r\n\t\t\t\t\t<text class=\"value\">{{ formatTime(subscriptionStatus.permanentSince) }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"status-item\">\r\n\t\t\t\t\t<text class=\"label\">已发送次数:</text>\r\n\t\t\t\t\t<text class=\"value success\">{{ subscriptionStatus.sendCount || 0 }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"status-item\" v-if=\"subscriptionStatus.lastSendTime\">\r\n\t\t\t\t\t<text class=\"label\">最后发送时间:</text>\r\n\t\t\t\t\t<text class=\"value\">{{ formatTime(subscriptionStatus.lastSendTime) }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"status-card error\" v-else>\r\n\t\t\t\t<text>未获取到订阅状态信息</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 操作按钮 -->\r\n\t\t<view class=\"button-section\">\r\n\t\t\t<button \r\n\t\t\t\tclass=\"btn primary\" \r\n\t\t\t\t@click=\"requestSubscription\" \r\n\t\t\t\t:disabled=\"isRequesting\"\r\n\t\t\t>\r\n\t\t\t\t{{ isRequesting ? '授权中...' : '请求永久订阅授权' }}\r\n\t\t\t</button>\r\n\t\t\t\r\n\t\t\t<button \r\n\t\t\t\tclass=\"btn secondary\" \r\n\t\t\t\t@click=\"checkSubscriptionStatus\" \r\n\t\t\t\t:disabled=\"isChecking\"\r\n\t\t\t>\r\n\t\t\t\t{{ isChecking ? '检查中...' : '检查订阅状态' }}\r\n\t\t\t</button>\r\n\t\t\t\r\n\t\t\t<button \r\n\t\t\t\tclass=\"btn success\" \r\n\t\t\t\t@click=\"sendTestMessage\" \r\n\t\t\t\t:disabled=\"isSending || !subscriptionStatus?.isPermanent\"\r\n\t\t\t>\r\n\t\t\t\t{{ isSending ? '发送中...' : '发送测试消息' }}\r\n\t\t\t</button>\r\n\t\t</view>\r\n\r\n\t\t<!-- 批量测试 -->\r\n\t\t<view class=\"batch-section\" v-if=\"subscriptionStatus?.isPermanent\">\r\n\t\t\t<view class=\"section-title\">批量发送测试</view>\r\n\t\t\t<view class=\"batch-controls\">\r\n\t\t\t\t<text>发送次数:</text>\r\n\t\t\t\t<picker \r\n\t\t\t\t\tmode=\"selector\" \r\n\t\t\t\t\t:value=\"batchCountIndex\" \r\n\t\t\t\t\t:range=\"batchOptions\" \r\n\t\t\t\t\t@change=\"onBatchCountChange\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<view class=\"picker\">\r\n\t\t\t\t\t\t{{ batchOptions[batchCountIndex] }}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</picker>\r\n\t\t\t</view>\r\n\t\t\t<button \r\n\t\t\t\tclass=\"btn warning\" \r\n\t\t\t\t@click=\"sendBatchMessages\" \r\n\t\t\t\t:disabled=\"isSending\"\r\n\t\t\t>\r\n\t\t\t\t{{ isSending ? '批量发送中...' : `发送 ${batchOptions[batchCountIndex]} 条消息` }}\r\n\t\t\t</button>\r\n\t\t</view>\r\n\r\n\t\t<!-- 日志区域 -->\r\n\t\t<view class=\"log-section\">\r\n\t\t\t<view class=\"section-title\">操作日志</view>\r\n\t\t\t<scroll-view class=\"log-container\" scroll-y=\"true\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tclass=\"log-item\" \r\n\t\t\t\t\tv-for=\"(log, index) in logs\" \r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t:class=\"log.type\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<text class=\"log-time\">{{ log.time }}</text>\r\n\t\t\t\t\t<text class=\"log-message\">{{ log.message }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<button class=\"btn clear\" @click=\"clearLogs\">清空日志</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\topenid: '',\r\n\t\t\tisLoggedIn: false,\r\n\t\t\tsubscriptionStatus: null,\r\n\t\t\tisRequesting: false,\r\n\t\t\tisChecking: false,\r\n\t\t\tisSending: false,\r\n\t\t\tbatchCountIndex: 0,\r\n\t\t\tbatchOptions: ['1', '3', '5', '10'],\r\n\t\t\tlogs: []\r\n\t\t}\r\n\t},\r\n\t\r\n\tonLoad() {\r\n\t\tthis.init();\r\n\t},\r\n\t\r\n\tmethods: {\r\n\t\t// 初始化\r\n\t\tasync init() {\r\n\t\t\tthis.addLog('页面初始化', 'info');\r\n\t\t\tawait this.checkLoginStatus();\r\n\t\t\tif (this.isLoggedIn) {\r\n\t\t\t\tawait this.checkSubscriptionStatus();\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 检查登录状态\r\n\t\tcheckLoginStatus() {\r\n\t\t\tconst userInfo = uni.getStorageSync('userInfo');\r\n\t\t\tconst openid = uni.getStorageSync('openid');\r\n\t\t\t\r\n\t\t\tif (userInfo && openid) {\r\n\t\t\t\tthis.isLoggedIn = true;\r\n\t\t\t\tthis.openid = openid;\r\n\t\t\t\tthis.addLog(`用户已登录: ${openid}`, 'success');\r\n\t\t\t} else {\r\n\t\t\t\tthis.isLoggedIn = false;\r\n\t\t\t\tthis.addLog('用户未登录', 'error');\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 请求永久订阅授权\r\n\t\tasync requestSubscription() {\r\n\t\t\tif (!this.isLoggedIn) {\r\n\t\t\t\tthis.addLog('请先登录', 'error');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.isRequesting = true;\r\n\t\t\ttry {\r\n\t\t\t\tthis.addLog('开始请求永久订阅授权...', 'info');\r\n\t\t\t\t\r\n\t\t\t\t// 调用微信订阅消息授权接口\r\n\t\t\t\tconst authResult = await uni.requestSubscribeMessage({\r\n\t\t\t\t\ttmplIds: ['sOwar1Xkzk4ApC2eQvvc4SZFH6UbFz_ZA8DZjHHPZf4']\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tthis.addLog(`微信授权结果: ${JSON.stringify(authResult)}`, 'info');\r\n\t\t\t\t\r\n\t\t\t\tif (authResult['sOwar1Xkzk4ApC2eQvvc4SZFH6UbFz_ZA8DZjHHPZf4'] === 'accept') {\r\n\t\t\t\t\tthis.addLog('用户接受授权，记录到数据库...', 'success');\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 调用云函数记录永久订阅状态\r\n\t\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\taction: 'request-subscription',\r\n\t\t\t\t\t\t\topenid: this.openid,\r\n\t\t\t\t\t\t\ttemplateId: 'sOwar1Xkzk4ApC2eQvvc4SZFH6UbFz_ZA8DZjHHPZf4',\r\n\t\t\t\t\t\t\tstatus: 'accepted'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.result && result.result.code === 200) {\r\n\t\t\t\t\t\tconst data = result.result.data;\r\n\t\t\t\t\t\tthis.addLog(`永久订阅授权成功！支持多次发送: ${data.supportMultipleSends}`, 'success');\r\n\t\t\t\t\t\tawait this.checkSubscriptionStatus();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.addLog(`记录授权状态失败: ${result.result?.message}`, 'error');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.addLog('用户拒绝授权', 'error');\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.addLog(`授权失败: ${error.message}`, 'error');\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isRequesting = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 检查订阅状态\r\n\t\tasync checkSubscriptionStatus() {\r\n\t\t\tif (!this.isLoggedIn) {\r\n\t\t\t\tthis.addLog('请先登录', 'error');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.isChecking = true;\r\n\t\t\ttry {\r\n\t\t\t\tthis.addLog('检查订阅状态...', 'info');\r\n\t\t\t\t\r\n\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'get-subscription-status',\r\n\t\t\t\t\t\topenid: this.openid\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif (result.result && result.result.code === 200) {\r\n\t\t\t\t\tthis.subscriptionStatus = result.result.data;\r\n\t\t\t\t\tthis.addLog(`订阅状态: ${this.subscriptionStatus.statusDescription}`, 'success');\r\n\t\t\t\t\tthis.addLog(`发送次数: ${this.subscriptionStatus.sendCount || 0}`, 'info');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.addLog(`获取订阅状态失败: ${result.result?.message}`, 'error');\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.addLog(`检查订阅状态失败: ${error.message}`, 'error');\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isChecking = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 发送测试消息\r\n\t\tasync sendTestMessage() {\r\n\t\t\tif (!this.subscriptionStatus?.isPermanent) {\r\n\t\t\t\tthis.addLog('需要永久订阅授权才能发送消息', 'error');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.isSending = true;\r\n\t\t\ttry {\r\n\t\t\t\tconst timestamp = new Date().toLocaleString();\r\n\t\t\t\tthis.addLog(`发送测试消息... (${timestamp})`, 'info');\r\n\t\t\t\t\r\n\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'send-schedule-notification',\r\n\t\t\t\t\t\topenid: this.openid,\r\n\t\t\t\t\t\tcourseName: `测试课程-${timestamp}`,\r\n\t\t\t\t\t\tclassTime: timestamp,\r\n\t\t\t\t\t\tremark: '永久订阅测试教室',\r\n\t\t\t\t\t\tstudentName: '测试学员',\r\n\t\t\t\t\t\tpage: 'pages/test-permanent-subscription/test-permanent-subscription'\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif (result.result && result.result.code === 200) {\r\n\t\t\t\t\tconst data = result.result.data;\r\n\t\t\t\t\tthis.addLog(`消息发送成功！发送次数: ${data.sendCount}`, 'success');\r\n\t\t\t\t\t// 更新本地订阅状态\r\n\t\t\t\t\tawait this.checkSubscriptionStatus();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.addLog(`消息发送失败: ${result.result?.message}`, 'error');\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.addLog(`发送消息失败: ${error.message}`, 'error');\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isSending = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 批量发送消息\r\n\t\tasync sendBatchMessages() {\r\n\t\t\tif (!this.subscriptionStatus?.isPermanent) {\r\n\t\t\t\tthis.addLog('需要永久订阅授权才能批量发送消息', 'error');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst count = parseInt(this.batchOptions[this.batchCountIndex]);\r\n\t\t\tthis.isSending = true;\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tthis.addLog(`开始批量发送 ${count} 条消息...`, 'info');\r\n\t\t\t\t\r\n\t\t\t\tfor (let i = 1; i <= count; i++) {\r\n\t\t\t\t\tconst timestamp = new Date().toLocaleString();\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'subscription-message',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\taction: 'send-schedule-notification',\r\n\t\t\t\t\t\t\topenid: this.openid,\r\n\t\t\t\t\t\t\tcourseName: `批量测试课程-${i}`,\r\n\t\t\t\t\t\t\tclassTime: timestamp,\r\n\t\t\t\t\t\t\tremark: `永久订阅批量测试-第${i}条`,\r\n\t\t\t\t\t\t\tstudentName: '批量测试学员',\r\n\t\t\t\t\t\t\tpage: 'pages/test-permanent-subscription/test-permanent-subscription'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.result && result.result.code === 200) {\r\n\t\t\t\t\t\tthis.addLog(`第 ${i} 条消息发送成功`, 'success');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.addLog(`第 ${i} 条消息发送失败: ${result.result?.message}`, 'error');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 间隔1秒发送下一条，避免频率限制\r\n\t\t\t\t\tif (i < count) {\r\n\t\t\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.addLog(`批量发送完成，共发送 ${count} 条消息`, 'success');\r\n\t\t\t\tawait this.checkSubscriptionStatus();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.addLog(`批量发送失败: ${error.message}`, 'error');\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isSending = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 批量发送数量选择\r\n\t\tonBatchCountChange(e) {\r\n\t\t\tthis.batchCountIndex = e.detail.value;\r\n\t\t},\r\n\t\t\r\n\t\t// 格式化时间\r\n\t\tformatTime(timeStr) {\r\n\t\t\tif (!timeStr) return '无';\r\n\t\t\treturn new Date(timeStr).toLocaleString();\r\n\t\t},\r\n\t\t\r\n\t\t// 添加日志\r\n\t\taddLog(message, type = 'info') {\r\n\t\t\tconst log = {\r\n\t\t\t\ttime: new Date().toLocaleTimeString(),\r\n\t\t\t\tmessage,\r\n\t\t\t\ttype\r\n\t\t\t};\r\n\t\t\tthis.logs.unshift(log);\r\n\t\t\t\r\n\t\t\t// 限制日志数量\r\n\t\t\tif (this.logs.length > 50) {\r\n\t\t\t\tthis.logs = this.logs.slice(0, 50);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconsole.log(`[${type.toUpperCase()}] ${message}`);\r\n\t\t},\r\n\t\t\r\n\t\t// 清空日志\r\n\t\tclearLogs() {\r\n\t\t\tthis.logs = [];\r\n\t\t\tthis.addLog('日志已清空', 'info');\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n\tpadding: 20rpx;\r\n\tbackground-color: #f5f5f5;\r\n\tmin-height: 100vh;\r\n}\r\n\r\n.header {\r\n\ttext-align: center;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.title {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tdisplay: block;\r\n}\r\n\r\n.subtitle {\r\n\tfont-size: 28rpx;\r\n\tcolor: #666;\r\n\tmargin-top: 10rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.info-section, .status-section, .button-section, .batch-section, .log-section {\r\n\tbackground: white;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 30rpx;\r\n\tmargin-bottom: 30rpx;\r\n\tbox-shadow: 0 2rpx 10rpx rgba(0,0,0,0.1);\r\n}\r\n\r\n.section-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.info-item, .status-item {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 15rpx;\r\n\tpadding: 10rpx 0;\r\n\tborder-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.label {\r\n\tfont-size: 28rpx;\r\n\tcolor: #666;\r\n}\r\n\r\n.value {\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tfont-weight: 500;\r\n}\r\n\r\n.value.success {\r\n\tcolor: #52c41a;\r\n}\r\n\r\n.value.error {\r\n\tcolor: #ff4d4f;\r\n}\r\n\r\n.value.warning {\r\n\tcolor: #faad14;\r\n}\r\n\r\n.status-card {\r\n\tborder: 1rpx solid #e8e8e8;\r\n\tborder-radius: 8rpx;\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.status-card.error {\r\n\tborder-color: #ff4d4f;\r\n\tbackground-color: #fff2f0;\r\n\ttext-align: center;\r\n\tcolor: #ff4d4f;\r\n}\r\n\r\n.btn {\r\n\twidth: 100%;\r\n\tmargin-bottom: 20rpx;\r\n\tpadding: 24rpx;\r\n\tborder-radius: 8rpx;\r\n\tborder: none;\r\n\tfont-size: 30rpx;\r\n\tfont-weight: 500;\r\n}\r\n\r\n.btn.primary {\r\n\tbackground-color: #1890ff;\r\n\tcolor: white;\r\n}\r\n\r\n.btn.secondary {\r\n\tbackground-color: #52c41a;\r\n\tcolor: white;\r\n}\r\n\r\n.btn.success {\r\n\tbackground-color: #13c2c2;\r\n\tcolor: white;\r\n}\r\n\r\n.btn.warning {\r\n\tbackground-color: #faad14;\r\n\tcolor: white;\r\n}\r\n\r\n.btn.clear {\r\n\tbackground-color: #f5222d;\r\n\tcolor: white;\r\n\tmargin-bottom: 0;\r\n}\r\n\r\n.btn:disabled {\r\n\tbackground-color: #d9d9d9;\r\n\tcolor: #999;\r\n}\r\n\r\n.batch-controls {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.picker {\r\n\tmargin-left: 20rpx;\r\n\tpadding: 10rpx 20rpx;\r\n\tborder: 1rpx solid #d9d9d9;\r\n\tborder-radius: 4rpx;\r\n\tbackground-color: #fafafa;\r\n}\r\n\r\n.log-container {\r\n\theight: 400rpx;\r\n\tborder: 1rpx solid #e8e8e8;\r\n\tborder-radius: 8rpx;\r\n\tpadding: 20rpx;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.log-item {\r\n\tmargin-bottom: 15rpx;\r\n\tpadding: 10rpx;\r\n\tborder-radius: 4rpx;\r\n\tborder-left: 4rpx solid #d9d9d9;\r\n}\r\n\r\n.log-item.success {\r\n\tbackground-color: #f6ffed;\r\n\tborder-left-color: #52c41a;\r\n}\r\n\r\n.log-item.error {\r\n\tbackground-color: #fff2f0;\r\n\tborder-left-color: #ff4d4f;\r\n}\r\n\r\n.log-item.warning {\r\n\tbackground-color: #fffbe6;\r\n\tborder-left-color: #faad14;\r\n}\r\n\r\n.log-item.info {\r\n\tbackground-color: #f0f9ff;\r\n\tborder-left-color: #1890ff;\r\n}\r\n\r\n.log-time {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n\tdisplay: block;\r\n\tmargin-bottom: 5rpx;\r\n}\r\n\r\n.log-message {\r\n\tfont-size: 26rpx;\r\n\tcolor: #333;\r\n\tdisplay: block;\r\n}\r\n</style>","import mod from \"-!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./test-permanent-subscription.vue?vue&type=style&index=0&id=17233ef6&scoped=true&lang=css&\"; export default mod; export * from \"-!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\26683\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./test-permanent-subscription.vue?vue&type=style&index=0&id=17233ef6&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1756194875530\n      var cssReload = require(\"C:/Users/26683/Desktop/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}