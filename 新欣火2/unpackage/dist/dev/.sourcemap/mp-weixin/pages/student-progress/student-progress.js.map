{"version":3,"sources":["uni-app:///main.js","webpack:///D:/代码/小程序/新欣火1/pages/student-progress/student-progress.vue?05c6","webpack:///D:/代码/小程序/新欣火1/pages/student-progress/student-progress.vue?d01f","webpack:///D:/代码/小程序/新欣火1/pages/student-progress/student-progress.vue?812d","webpack:///D:/代码/小程序/新欣火1/pages/student-progress/student-progress.vue?8233","uni-app:///pages/student-progress/student-progress.vue","webpack:///D:/代码/小程序/新欣火1/pages/student-progress/student-progress.vue?52f2","webpack:///D:/代码/小程序/新欣火1/pages/student-progress/student-progress.vue?b070"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","activeTab","classList","one2oneList","tuochanshengList","selectedClass","classStudents","oneToOneStudents","tuochanshengStudents","filteredStudents","loading","classAvgRate","classProgressCount","classTotalCount","classPrevAvg","classLatestAvg","computed","currentClassList","onLoad","uni","title","icon","duration","setTimeout","methods","loadAllStudents","userInfo","teacherId","uniCloud","name","action","res","filter","classMap","group","stu","count","one2oneMap","tuochanshengMap","updateFilteredStudents","getGradeNum","getScoreSection","isProgress","students","filtered","studentId","subject","scoreRes","scores","entranceScore","progressRate","latestScore","prevScore","console","validStudents","prevScoreList","avgPrev","allLatestScoreList","avgLatest","progressCount","totalCount","switchTab","onClassChange","goBack","url","scoresLabel","parseClassName","grade","type"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,wBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyI;AACzI;AACoE;AACL;AACqC;;;AAGpG;AACgL;AAChL,gBAAgB,uLAAU;AAC1B,EAAE,sFAAM;AACR,EAAE,uGAAM;AACR,EAAE,gHAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,2GAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACzDA;AAAA;AAAA;AAAA;AAA8qB,CAAgB,4qBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eC6FlsB;EACAC;IACA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;IACA;EACA;;EACAC;IACAC;MACA;MACA;MACA;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;QACAJ;MACA;MACA;IACA;IAEA;EACA;EACAK;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBAAA;gBAEAC;gBACAC;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBACAR;kBAAAC;kBAAAC;gBAAA;gBAAA;cAAA;gBAAA;gBAAA,OAGAO;kBACAC;kBACA7B;oBACA8B;oBACAH;kBACA;gBACA;cAAA;gBANAI;gBAAA,MAOAA;kBAAA;kBAAA;gBAAA;gBACAZ;kBAAAC;kBAAAC;gBAAA;gBAAA;cAAA;gBAGA;gBACAf;gBACAC,2DACA;gBACAC,kEACAF,iDACAC,mBACAyB;kBAAA;gBAAA,IACA;gBACAC;gBACA3B;kBACA;kBACA;oBACA4B;kBACA;kBACAC;kBACA;kBACAF;gBACA;gBACA;kBAAA;oBAAAJ;oBAAAO;kBAAA;gBAAA;gBACA;gBACAC;gBACA9B;kBACA;kBACA4B;kBACA;kBACAE;gBACA;gBACA;kBAAA;oBAAAR;oBAAAO;kBAAA;gBAAA;gBACA;gBACAE;gBACA9B;kBACA;kBACA2B;kBACA;kBACAG;gBACA;gBACA;kBAAA;oBAAAT;oBAAAO;kBAAA;gBAAA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBAAA;gBAAA,OACA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAjB;kBAAAC;kBAAAC;gBAAA;cAAA;gBAEA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACAkB;MAAA;MAAA;QAAA,sHAoDAC,aAWAC,iBAeAC;QAAA;UAAA;YAAA;cAAA;gBAAAA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;oBACA;oBACA;oBACA;oBACA;kBACA;kBACA;kBACA;gBACA;gBAtCAD;kBACA;kBACA;oBACA;oBACA;oBACA;oBACA;kBACA;oBACA;oBACA;oBACA;oBACA;kBACA;kBACA;gBACA;gBAzBAD;kBACA;kBACA;kBACA;kBACA;kBACA;kBACA;oBAAA;oBAAA;oBAAA;oBAAA;oBAAA;oBAAA;oBAAA;oBAAA;oBAAA;kBAAA;kBACA;kBACA;kBACA;gBACA;gBA7DA;gBAEA,uEACA,4EACAG;gBACAC;kBAAA;gBAAA,IACA;gBAAA,uCACAA;gBAAA;gBAAA;cAAA;gBAAA;kBAAA;kBAAA;gBAAA;gBAAAT;gBAAA;gBAAA,OAEAP;kBACAC;kBACA7B;oBACA8B;oBACAe;oBACAC;kBACA;gBACA;cAAA;gBAPAC;gBAQAC,mEACA;gBACAA;kBACA;kBACA;kBACA;gBACA;gBACAC;gBACAC;gBACAC;gBACAC;gBACA;kBACAD;kBACAC;kBACA;oBACAF;kBACA;gBACA;kBACAC;kBACAC;kBACA;oBACA;oBACAF;kBACA;gBACA;gBACA;gBACAG;gBACAlB;gBACAA;gBACAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAEA;;gBAEA;gBAmDA;gBAEA;gBACAmB;kBAAA;gBAAA;gBACA3C;gBACAG;gBACAC;gBACA;kBACA;kBACAwC;oBAAA;kBAAA;oBAAA;kBAAA;kBACAC;oBAAA;kBAAA,qCACA;kBACAC;oBAAA;kBAAA;oBAAA;kBAAA;kBACAC;oBAAA;kBAAA;kBACA5C;kBACAC;kBACA;oBACAJ;kBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACAgD;kBAAA;gBAAA;gBACAC;gBACA;gBACA;gBACA;gBACA;gBACAP;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACAQ;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA5C;QACA6C;MACA;IACA;IACAC;MACA;MACA;QACA;MACA;MACA;IACA;IACAC;MACA;MACA;QAAAC;QAAArB;QAAAsB;MAAA;MACA;MACA;MACA;QACA;UACAD;UACArB;UACAsB;QACA;MACA;QACA;QACA;UAAAD;UAAArB;UAAAsB;QAAA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC/XA;AAAA;AAAA;AAAA;AAAm/B,CAAgB,68BAAG,EAAC,C;;;;;;;;;;;ACAvgC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/student-progress/student-progress.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/student-progress/student-progress.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./student-progress.vue?vue&type=template&id=ad9f9134&scoped=true&\"\nvar renderjs\nimport script from \"./student-progress.vue?vue&type=script&lang=js&\"\nexport * from \"./student-progress.vue?vue&type=script&lang=js&\"\nimport style0 from \"./student-progress.vue?vue&type=style&index=0&id=ad9f9134&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ad9f9134\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/student-progress/student-progress.vue\"\nexport default component.exports","export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./student-progress.vue?vue&type=template&id=ad9f9134&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.currentClassList, function (cls, __i0__) {\n    var $orig = _vm.__get_orig(cls)\n    var m0 = _vm.parseClassName(cls.name)\n    var m1 = _vm.parseClassName(cls.name)\n    var m2 = _vm.parseClassName(cls.name)\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1,\n      m2: m2,\n    }\n  })\n  var l1 = !_vm.loading\n    ? _vm.__map(_vm.filteredStudents, function (stu, __i1__) {\n        var $orig = _vm.__get_orig(stu)\n        var m3 = _vm.scoresLabel(stu)\n        return {\n          $orig: $orig,\n          m3: m3,\n        }\n      })\n    : null\n  var g0 =\n    !_vm.loading &&\n    _vm.classAvgRate !== null &&\n    _vm.activeTab === \"class\" &&\n    _vm.classTotalCount > 0\n      ? ((_vm.classProgressCount / _vm.classTotalCount) * 100).toFixed(1)\n      : null\n  var m4 =\n    !_vm.loading && _vm.classAvgRate !== null && _vm.activeTab === \"class\"\n      ? Number(_vm.classAvgRate)\n      : null\n  var m5 =\n    !_vm.loading && _vm.classAvgRate !== null && _vm.activeTab === \"class\"\n      ? Number(_vm.classAvgRate)\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1,\n        g0: g0,\n        m4: m4,\n        m5: m5,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./student-progress.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./student-progress.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"container\">\n    <view class=\"nav-bar\">\n      <text class=\"back-btn\" @click=\"goBack\">返回</text>\n      <view class=\"nav-title\">学生进步分析</view>\n    </view>\n    <!-- 顶部tab栏 -->\n    <view class=\"tab-bar\">\n      <view :class=\"['tab-item', activeTab==='class' ? 'active' : '']\" @click=\"switchTab('class')\">班课</view>\n      <view :class=\"['tab-item', activeTab==='one2one' ? 'active' : '']\" @click=\"switchTab('one2one')\">一对一</view>\n      <view :class=\"['tab-item', activeTab==='tuochansheng' ? 'active' : '']\" @click=\"switchTab('tuochansheng')\">脱产生</view>\n    </view>\n    <view class=\"main-content\">\n      <!-- 左侧分组栏 -->\n      <view class=\"sidebar\">\n        <view v-for=\"cls in currentClassList\" :key=\"cls.name\"\n          :class=\"['sidebar-item', selectedClass === cls.name ? 'active' : '']\"\n          @click=\"onClassChange(cls.name)\">\n          <view class=\"class-name\">\n            <view class=\"class-grade\">{{ parseClassName(cls.name).grade }}</view>\n            <view class=\"class-subject\">{{ parseClassName(cls.name).subject }}</view>\n            <view class=\"class-type\">{{ parseClassName(cls.name).type }}</view>\n          </view>\n          <view class=\"class-count\">（{{ cls.count }}人）</view>\n        </view>\n      </view>\n      <!-- 右侧内容区 -->\n      <view class=\"content-area\">\n        <view v-if=\"loading\" class=\"loading\">加载中...</view>\n        <view v-else>\n          <!-- 进步人数/总人数，始终显示 -->\n          <view class=\"class-avg-info\" v-if=\"activeTab !== 'one2one'\">\n            <text>\n              <span class=\"progress-count\">进步人数：{{ classProgressCount }}</span>\n              &nbsp;&nbsp;\n              <span class=\"total-count\">总人数：{{ classTotalCount }}</span>\n            </text>\n          </view>\n          <!-- 新增表头说明 -->\n          <view class=\"student-progress-header\">\n            <text class=\"header-name\">姓名</text>\n            <text class=\"header-prev-score\">上一次的成绩</text>\n            <text class=\"header-latest-score\">最新一次成绩</text>\n            <text class=\"header-progress-rate\">提升率</text>\n          </view>\n          <view v-for=\"stu in filteredStudents\" :key=\"stu._id\" class=\"student-progress-row\">\n            <text class=\"stu-name stu-name-colored\">{{ stu.studentName }}</text>\n            <text class=\"score score-first\">\n              {{ scoresLabel(stu) }}: {{ stu.prevScore !== null ? stu.prevScore : '无' }}\n            </text>\n            <text class=\"score score-second\">\n              最新: {{ stu.latestScore !== null ? stu.latestScore : '无' }}\n            </text>\n            <text :class=\"['progress-rate', stu.progressRate >= 0 ? 'positive' : 'negative']\">\n              {{ stu.progressRate !== null ? (stu.progressRate > 0 ? '+' : '') + stu.progressRate + '%' : '无' }}\n            </text>\n          </view>\n          <view v-if=\"classAvgRate !== null && activeTab === 'class'\" class=\"class-avg-row progress-summary-card\">\n            <view class=\"progress-title\">班级进步率</view>\n            <view class=\"progress-rate-box\">\n              <view class=\"progress-card\">\n                <view class=\"progress-card-title\">班级人数进步率</view>\n                <view class=\"progress-card-value\">\n                  <text :class=\"['progress-rate', classProgressCount > 0 ? 'positive' : 'negative']\">{{ classTotalCount > 0 ? ((classProgressCount/classTotalCount*100).toFixed(1)+'%') : '0%' }}</text>\n                </view>\n                <view class=\"progress-count-info progress-count-info-inline\">\n                  <text class=\"progress-count\">进步人数：{{ classProgressCount }}</text>\n                  <text class=\"progress-slash\"> / </text>\n                  <text class=\"total-count\">总人数：{{ classTotalCount }}</text>\n                </view>\n              </view>\n              <view class=\"progress-card\">\n                <view class=\"progress-card-title\">班级分数进步率</view>\n                <view class=\"progress-card-value\">\n                  <text :class=\"['progress-rate', Number(classAvgRate) >= 0 ? 'positive' : 'negative']\">{{ Number(classAvgRate) > 0 ? '+' : '' }}{{ classAvgRate }}%</text>\n                </view>\n                <view class=\"progress-avg-info\">\n                  <view><text class=\"avg-label\">上次均分：</text><text class=\"avg-value\">{{ classPrevAvg }}</text></view>\n                  <view style=\"margin-top:2px;\"><text class=\"avg-label\">最新均分：</text><text class=\"avg-value\">{{ classLatestAvg }}</text></view>\n                </view>\n              </view>\n            </view>\n            <view class=\"progress-tip\" style=\"margin-top: 8px; color: #888; font-size: 13px;\">\n              （无入门测成绩以及无最新一次成绩不计入总人数）\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      activeTab: 'class', // 'class' | 'one2one' | 'tuochansheng'\n      classList: [],\n      one2oneList: [],\n      tuochanshengList: [],\n      selectedClass: '',\n      classStudents: [],\n      oneToOneStudents: [],\n      tuochanshengStudents: [],\n      filteredStudents: [],\n      loading: false,\n      classAvgRate: null, // 班级平均进步率\n      classProgressCount: 0, // 进步人数\n      classTotalCount: 0, // 有最新成绩的总人数\n      classPrevAvg: '-', // 上次均分\n      classLatestAvg: '-', // 最新均分\n    }\n  },\n  computed: {\n    currentClassList() {\n      if (this.activeTab === 'class') return this.classList;\n      if (this.activeTab === 'one2one') return this.one2oneList;\n      return this.tuochanshengList;\n    }\n  },\n  onLoad() {\n    // 权限检查：教务管理员不能访问进步分析功能\n    const userInfo = uni.getStorageSync('userInfo');\n    const isAcademic = userInfo && (Array.isArray(userInfo.role) ? userInfo.role.includes('教务') : userInfo.role === '教务');\n    if (isAcademic) {\n      uni.showToast({ \n        title: '教务管理员无权限访问进步分析功能', \n        icon: 'none',\n        duration: 2000\n      });\n      setTimeout(() => {\n        uni.navigateBack();\n      }, 2000);\n      return;\n    }\n    \n    this.loadAllStudents();\n  },\n  methods: {\n    async loadAllStudents() {\n      this.loading = true;\n      try {\n        const userInfo = uni.getStorageSync('userInfo');\n        const teacherId = userInfo?._id;\n        if (!teacherId) {\n          uni.showToast({ title: '未登录', icon: 'none' });\n          return;\n        }\n        const res = await uniCloud.callFunction({\n          name: 'student-hours',\n          data: {\n            action: 'getMyClassStudentsByType',\n            teacherId\n          }\n        });\n        if (res.result.code !== 200) {\n          uni.showToast({ title: res.result.message, icon: 'none' });\n          return;\n        }\n        // 直接取云函数返回的classStudents和oneToOneStudents\n        const classStudents = res.result.data.classStudents || [];\n        const oneToOneStudents = res.result.data.oneToOneStudents || [];\n        // 脱产生学生\n        const tuochanshengStudents = [\n          ...classStudents,\n          ...oneToOneStudents\n        ].filter(stu => (stu.courseType || '').trim() === '脱产生');\n        // 统计班课分组（按className，如果为空则使用年级）\n        const classMap = {};\n        classStudents.forEach(stu => {\n          let group = (stu.className || '').trim();\n          if (!group) {\n            group = stu.grade || '未分组';\n          }\n          stu._group = group;\n          if (!classMap[group]) classMap[group] = 0;\n          classMap[group]++;\n        });\n        this.classList = Object.keys(classMap).map(name => ({ name, count: classMap[name] }));\n        // 统计一对一分组（按grade）\n        const one2oneMap = {};\n        oneToOneStudents.forEach(stu => {\n          const group = (stu.grade || '未分组').trim();\n          stu._group = group;\n          if (!one2oneMap[group]) one2oneMap[group] = 0;\n          one2oneMap[group]++;\n        });\n        this.one2oneList = Object.keys(one2oneMap).map(name => ({ name, count: one2oneMap[name] }));\n        // 统计脱产生分组（按grade）\n        const tuochanshengMap = {};\n        tuochanshengStudents.forEach(stu => {\n          const group = (stu.grade || '未分组').trim();\n          stu._group = group;\n          if (!tuochanshengMap[group]) tuochanshengMap[group] = 0;\n          tuochanshengMap[group]++;\n        });\n        this.tuochanshengList = Object.keys(tuochanshengMap).map(name => ({ name, count: tuochanshengMap[name] }));\n        this.classStudents = classStudents;\n        this.oneToOneStudents = oneToOneStudents;\n        this.tuochanshengStudents = tuochanshengStudents;\n        // 默认选中第一个tab和分组\n        this.activeTab = 'class';\n        this.selectedClass = this.classList.length ? this.classList[0].name : '';\n        await this.updateFilteredStudents();\n      } catch (e) {\n        uni.showToast({ title: '加载失败', icon: 'none' });\n      }\n      this.loading = false;\n    },\n    async updateFilteredStudents() {\n      this.loading = true;\n      let students;\n      if (this.activeTab === 'class') students = this.classStudents;\n      else if (this.activeTab === 'one2one') students = this.oneToOneStudents;\n      else students = this.tuochanshengStudents;\n      let filtered = students.filter(stu => (stu._group || '').trim() === this.selectedClass);\n      // 获取进步率\n      for (let stu of filtered) {\n        // 获取最近两次成绩，确保按 examDate（无则 createTime）降序\n        const scoreRes = await uniCloud.callFunction({\n          name: 'exam-scores',\n          data: {\n            action: 'getLatestTwoScores',\n            studentId: stu._id,\n            subject: stu.subject\n          }\n        });\n        let scores = scoreRes.result.code === 200 ? scoreRes.result.data : [];\n        // 手动排序，确保最新成绩在前\n        scores.sort((a, b) => {\n          const dateA = new Date(a.examDate || a.createTime || 0).getTime();\n          const dateB = new Date(b.examDate || b.createTime || 0).getTime();\n          return dateB - dateA;\n        });\n        let entranceScore = Number(stu.entranceTestScore);\n        let progressRate = null;\n        let latestScore = null;\n        let prevScore = null;\n        if (scores.length === 1) {\n          latestScore = Number(scores[0].score);\n          prevScore = entranceScore; // 只有一次成绩时，用入门测\n          if (!isNaN(entranceScore) && entranceScore > 0) {\n            progressRate = (((latestScore - entranceScore) / entranceScore) * 100).toFixed(1);\n          }\n        } else if (scores.length >= 2) {\n          latestScore = Number(scores[0].score);\n          prevScore = Number(scores[1].score); // 有两次成绩时，用上一次成绩\n          if (!isNaN(prevScore) && prevScore > 0) {\n            // 严格用 (最新-上一次)/上一次*100%\n            progressRate = (((latestScore - prevScore) / prevScore) * 100).toFixed(1);\n          }\n        }\n        // 调试输出\n        console.log('学生:', stu.studentName, 'entranceTestScore:', entranceScore, 'latestScore:', latestScore, 'prevScore:', prevScore, 'progressRate:', progressRate, 'scores:', scores);\n        stu.latestScore = latestScore;\n        stu.prevScore = prevScore;\n        stu.progressRate = (progressRate !== null && !isNaN(progressRate)) ? progressRate : null;\n      }\n      this.filteredStudents = filtered;\n\n      // ========== 新增：年级和分段判断函数 ==========\n      function getGradeNum(gradeStr) {\n        // 提取“X年级”中的X，返回数字\n        if (!gradeStr) return null;\n        const match = gradeStr.match(/(\\d+)/);\n        if (match) return parseInt(match[1]);\n        // 中文数字转阿拉伯数字\n        const cnNumMap = { '一':1, '二':2, '三':3, '四':4, '五':5, '六':6, '七':7, '八':8, '九':9 };\n        const cn = gradeStr.match(/([一二三四五六七八九])/);\n        if (cn) return cnNumMap[cn[1]];\n        return null;\n      }\n      function getScoreSection(gradeNum, score) {\n        // 返回分段：'high'|'upper'|'middle'|'low'\n        if (gradeNum >= 1 && gradeNum <= 6) {\n          if (score >= 95 && score <= 100) return 'high';\n          if (score >= 90 && score <= 94) return 'upper';\n          if (score >= 60 && score <= 89) return 'middle';\n          if (score >= 0 && score <= 59) return 'low';\n        } else if (gradeNum >= 7 && gradeNum <= 9) {\n          if (score >= 100 && score <= 120) return 'high';\n          if (score >= 90 && score < 100) return 'upper';\n          if (score >= 72 && score < 90) return 'middle';\n          if (score >= 0 && score < 72) return 'low';\n        }\n        return null;\n      }\n      function isProgress(stu) {\n        // 按新规则判断是否进步\n        const gradeNum = getGradeNum(stu.grade);\n        const latest = Number(stu.latestScore);\n        const prev = Number(stu.prevScore);\n        if (isNaN(gradeNum) || isNaN(latest) || isNaN(prev)) return false;\n        const latestSection = getScoreSection(gradeNum, latest);\n        const prevSection = getScoreSection(gradeNum, prev);\n        const sectionOrder = ['low', 'middle', 'upper', 'high'];\n        const latestIdx = sectionOrder.indexOf(latestSection);\n        const prevIdx = sectionOrder.indexOf(prevSection);\n        if (latestIdx === -1 || prevIdx === -1) return false;\n        // 分段提升，必算进步\n        if (latestIdx > prevIdx) return true;\n        // 分段持平，按原分段规则判断\n        if (latestIdx === prevIdx) {\n          if (latestSection === 'high') return true; // 高分段不掉出算进步\n          if (latestSection === 'upper' && latest >= prev) return true; // 中上分段分数不降算进步\n          if (latestSection === 'middle' && latest > prev) return true; // 中等分段分数提升才算进步\n          if (latestSection === 'low' && latest > prev) return true; // 低分段分数提升才算进步\n        }\n        // 分段下降，不算进步\n        return false;\n      }\n      // ========== END ==========\n\n      // 计算班级平均进步率和进步人数\n      const validStudents = filtered.filter(stu => stu.latestScore !== null && stu.prevScore !== null && !isNaN(Number(stu.latestScore)) && !isNaN(Number(stu.prevScore)) && Number(stu.prevScore) > 0);\n      let classAvgRate = null;\n      let classPrevAvg = '-';\n      let classLatestAvg = '-';\n      if (validStudents.length > 0) {\n        // 上次均分：有上一次成绩的学生的上一次成绩总和/人数\n        const prevScoreList = validStudents.filter(stu => stu.prevScore !== null && !isNaN(Number(stu.prevScore))).map(stu => Number(stu.prevScore));\n        const avgPrev = prevScoreList.length > 0 ? prevScoreList.reduce((a, b) => a + b, 0) / prevScoreList.length : null;\n        // 最新均分：所有有最新成绩的学生的最新成绩总和/人数（不只validStudents）\n        const allLatestScoreList = filtered.filter(stu => stu.latestScore !== null && !isNaN(Number(stu.latestScore))).map(stu => Number(stu.latestScore));\n        const avgLatest = allLatestScoreList.length > 0 ? allLatestScoreList.reduce((a, b) => a + b, 0) / allLatestScoreList.length : null;\n        classPrevAvg = avgPrev !== null ? avgPrev.toFixed(1) : '-';\n        classLatestAvg = avgLatest !== null ? avgLatest.toFixed(1) : '-';\n        if (avgPrev > 0) {\n          classAvgRate = (((avgLatest - avgPrev) / avgPrev) * 100).toFixed(1);\n        }\n      }\n      this.classAvgRate = classAvgRate;\n      this.classPrevAvg = classPrevAvg;\n      this.classLatestAvg = classLatestAvg;\n      // 进步人数和总人数（按新规则）\n      const progressCount = validStudents.filter(stu => isProgress(stu)).length;\n      const totalCount = validStudents.length;\n      this.classProgressCount = progressCount;\n      this.classTotalCount = totalCount;\n      this.loading = false;\n      // 调试输出\n      console.log('进步人数:', this.classProgressCount, '总人数:', this.classTotalCount, 'filteredStudents:', this.filteredStudents);\n    },\n    switchTab(tab) {\n      if (this.activeTab === tab) return;\n      this.activeTab = tab;\n      const list = this.currentClassList;\n      this.selectedClass = list.length ? list[0].name : '';\n      this.updateFilteredStudents();\n    },\n    onClassChange(clsName) {\n      this.selectedClass = clsName;\n      this.updateFilteredStudents();\n    },\n    goBack() {\n      uni.reLaunch({\n        url: '/pages/service/service'\n      });\n    },\n    scoresLabel(stu) {\n      // 如果只有一次成绩，prevScore 就是入门测，否则是上一次成绩\n      if (stu.prevScore === Number(stu.entranceTestScore)) {\n        return '入门测';\n      }\n      return '上一次';\n    },\n    parseClassName(name) {\n      // 支持“X年级XX科目XX班型”或“X年级XX科目”或“X年级”\n      if (!name) return { grade: '', subject: '', type: '' };\n      // 先匹配“X年级XX科目XX班型”\n      let match = name.match(/^(.*年级)([^班]+)?([\\u4e00-\\u9fa5]+班)?$/);\n      if (match) {\n        return {\n          grade: match[1] ? match[1].trim() : '',\n          subject: match[2] ? match[2].trim() : '',\n          type: match[3] ? match[3].trim() : ''\n        };\n      } else {\n        // 兜底：全部显示在年级\n        return { grade: name, subject: '', type: '' };\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n.nav-bar {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  padding: 20px;\n  text-align: center;\n  padding-top: 55px;\n  position: relative;\n}\n.nav-title {\n  color: white;\n  font-size: 18px;\n  font-weight: bold;\n}\n.back-btn {\n  position: absolute;\n  left: 16px;\n  top: 55px;\n  color: white;\n  font-size: 16px;\n  z-index: 10;\n}\n.tab-bar {\n  display: flex;\n  flex-direction: row;\n  background: #fff;\n  border-bottom: 1px solid #eee;\n  height: 44px;\n  align-items: center;\n}\n.tab-item {\n  flex: 1;\n  text-align: center;\n  font-size: 16px;\n  color: #666;\n  padding: 10px 0;\n  cursor: pointer;\n  border-bottom: 2px solid transparent;\n  transition: color 0.2s, border-color 0.2s;\n}\n.tab-item.active {\n  color: #667eea;\n  font-weight: bold;\n  border-bottom: 2px solid #667eea;\n  background: #f0f4ff;\n}\n.main-content {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n}\n.sidebar {\n  flex-shrink: 0;\n  width: 50px;\n  background: #fff;\n  border-right: 1px solid #eee;\n  padding: 6px 0 6px 0;\n}\n.sidebar-item {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  padding: 10px 0;\n  font-size: 13px;\n  color: #333;\n  cursor: pointer;\n  border-radius: 0 20px 20px 0;\n  margin-bottom: 8px;\n  background: transparent;\n  transition: background 0.2s, color 0.2s;\n}\n.sidebar-item.active {\n  background: #f0f4ff;\n  color: #667eea;\n  font-weight: bold;\n}\n.class-name {\n  font-size: 14px;\n  display: block;\n  line-height: 1.2em;\n  margin-bottom: 2px;\n}\n.class-grade, .class-subject, .class-type {\n  font-size: 14px;\n  line-height: 1.2em;\n  text-align: left;\n  min-height: 1.2em;\n}\n.class-count {\n  font-size: 12px;\n  color: #999;\n  margin-top: 2px;\n}\n.content-area {\n  flex: 1;\n  min-width: 0;\n  margin-left: 0px;\n  padding-right: 12px;\n}\n.my-class-progress {\n  background: white;\n  margin: 10px;\n  border-radius: 8px;\n  padding: 20px;\n}\n.section-title {\n  font-size: 16px;\n  font-weight: bold;\n  color: #667eea;\n  margin-bottom: 10px;\n}\n.student-progress-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 0;\n  border-bottom: 1px solid #eee;\n}\n.student-progress-row:last-child {\n  border-bottom: none;\n}\n.stu-name { font-size: 15px; color: #333; width: 80px; }\n/* 新增颜色样式 */\n.stu-name-colored { color: #2a4fa7; font-weight: bold; }\n.score { font-size: 13px; color: #666; width: 80px; }\n.score-first { color: #555; }\n.score-second { color: #3f51b5; } /* 蓝色 */\n.progress-rate { font-size: 15px; font-weight: bold; width: 80px; text-align: right; }\n.progress-rate.positive { color: #4caf50; }\n.progress-rate.negative { color: #f44336; }\n.progress-count { color: #2a4fa7; font-weight: bold; }\n.total-count { color: #ff9800; font-weight: bold; }\n.loading { text-align: center; color: #999; margin-top: 40px; }\n.class-avg-row {\n  background: #f8fafd;\n  border-top: 1px solid #eee;\n}\n.class-avg-info {\n  color: #444;\n  font-size: 13px;\n  margin: 0 0 10px 0;\n  padding-left: 10px;\n}\n.progress-summary-card {\n  background: #f8fafd;\n  border-radius: 10px;\n  margin: 18px 0 10px 0;\n  padding: 12px 10px 8px 10px;\n  box-shadow: 0 2px 8px rgba(102,126,234,0.06);\n}\n.progress-title {\n  font-size: 15px;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 12px;\n}\n.progress-rate-box {\n  display: flex;\n  flex-direction: row;\n  gap: 10px;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n}\n.progress-card {\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 1px 4px rgba(102,126,234,0.04);\n  padding: 10px 12px 8px 12px;\n  min-width: 120px;\n  max-width: 180px;\n  flex: 1 1 0;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n}\n.progress-card-title {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 6px;\n}\n.progress-card-value {\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 8px;\n}\n.progress-count-info {\n  font-size: 13px;\n  margin-bottom: 2px;\n}\n.progress-count {\n  color: #2a4fa7;\n  font-weight: bold;\n}\n.progress-slash {\n  color: #888;\n}\n.total-count {\n  color: #ff9800;\n  font-weight: bold;\n}\n.progress-tip {\n  font-size: 12px;\n  color: #aaa;\n  margin-top: 2px;\n}\n.progress-count-info-inline {\n  font-size: 13px;\n  margin-bottom: 2px;\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n}\n.progress-tip-inline {\n  font-size: 12px;\n  color: #aaa;\n  margin-left: 6px;\n  display: block;\n  text-align: left;\n  line-height: 1.4;\n  max-width: 90%;\n  word-break: break-all;\n  white-space: pre-line;\n}\n.progress-tip-multiline {\n  white-space: pre-line;\n}\n.progress-avg-info {\n  font-size: 13px;\n  color: #888;\n  margin-top: 2px;\n  text-align: left;\n}\n.avg-label {\n  color: #888;\n}\n.avg-value {\n  color: #2a4fa7;\n  font-weight: bold;\n  margin-right: 2px;\n}\n@media (max-width: 350px) {\n  .progress-rate-box {\n    flex-direction: column;\n    gap: 8px;\n  }\n  .progress-card {\n    max-width: 100%;\n    width: 100%;\n  }\n}\n.main-content, .progress-content, .progress-main, .main-panel {\n  margin-left: 0 !important;\n  padding-left: 0 !important;\n}\n/* 表头样式 */\n.student-progress-header {\n  display: flex;\n  align-items: center;\n  padding: 6px 12px 6px 0;\n  font-size: 13px;\n  color: #888;\n  font-weight: bold;\n}\n\n/* 表格行样式 */\n.student-progress-row {\n  display: flex;\n  align-items: center;\n  padding: 12px 12px 12px 0;\n  border-bottom: 1px solid #eee;\n}\n\n.student-progress-row:last-child {\n  border-bottom: none;\n}\n\n/* 列宽和对齐设置 */\n.student-progress-header text,\n.student-progress-row text {\n  display: inline-block;\n  text-align: center;\n  font-size: 15px;\n  width: 84px;\n  flex-shrink: 0;\n}\n\n/* 最后一列（提升率）右对齐 */\n.student-progress-header text:last-child,\n.student-progress-row text:last-child {\n  width: 88px;\n  text-align: right;\n  white-space: nowrap;\n}\n\n/* 移除之前的margin设置，确保列连续对齐 */\n.score-first,\n.score-second {\n  margin-right: 0;\n}\n</style> ","import mod from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./student-progress.vue?vue&type=style&index=0&id=ad9f9134&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./student-progress.vue?vue&type=style&index=0&id=ad9f9134&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1759881831277\n      var cssReload = require(\"D:/hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}