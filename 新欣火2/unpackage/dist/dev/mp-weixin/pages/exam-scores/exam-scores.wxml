<view class="container data-v-46a4f9b4"><view class="nav-bar data-v-46a4f9b4"><text data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="back-btn data-v-46a4f9b4" bindtap="__e">返回</text><view class="nav-title data-v-46a4f9b4">考试成绩管理</view></view><view class="tab-container data-v-46a4f9b4"><view data-event-opts="{{[['tap',[['switchTab',['input']]]]]}}" class="{{['tab-item','data-v-46a4f9b4',(activeTab==='input')?'active':'']}}" bindtap="__e">成绩录入</view><view data-event-opts="{{[['tap',[['switchTab',['list']]]]]}}" class="{{['tab-item','data-v-46a4f9b4',(activeTab==='list')?'active':'']}}" bindtap="__e">成绩列表</view></view><block wx:if="{{activeTab==='input'}}"><view class="form-outer data-v-46a4f9b4"><view class="form-container data-v-46a4f9b4" style="{{'min-height:'+('calc(100vh - 180px)')+';'}}"><view class="form-item data-v-46a4f9b4"><text class="label data-v-46a4f9b4">学生</text><view data-event-opts="{{[['tap',[['showStudentModal',['$event']]]]]}}" class="student-selector data-v-46a4f9b4" bindtap="__e"><view class="student-display data-v-46a4f9b4"><block wx:if="{{!formData.studentName}}"><text class="placeholder data-v-46a4f9b4">请选择学生</text></block><block wx:else><view class="selected-student data-v-46a4f9b4"><text class="student-text data-v-46a4f9b4">{{formData.studentName}}</text><text class="student-id data-v-46a4f9b4">{{formData.studentId}}</text></view></block></view><text class="arrow data-v-46a4f9b4">></text></view></view><view class="form-item data-v-46a4f9b4"><text class="label data-v-46a4f9b4">年级</text><picker class="picker data-v-46a4f9b4" range="{{gradeOptions}}" value="{{gradeIndex}}" data-event-opts="{{[['change',[['onGradeChange',['$event']]]]]}}" bindchange="__e"><view class="picker-text input-grade data-v-46a4f9b4">{{gradeOptions[gradeIndex]||'请选择年级'}}</view></picker></view><view class="form-item data-v-46a4f9b4"><text class="label data-v-46a4f9b4">考试日期和类型</text><view class="date-type-row data-v-46a4f9b4"><picker class="picker year-picker data-v-46a4f9b4" range="{{yearOptions}}" value="{{yearIndex}}" data-event-opts="{{[['change',[['onYearChange',['$event']]]]]}}" bindchange="__e"><view class="picker-text input-year data-v-46a4f9b4">{{yearOptions[yearIndex]||'年份'}}</view></picker><picker class="picker month-picker data-v-46a4f9b4" range="{{monthOptions}}" value="{{monthIndex}}" data-event-opts="{{[['change',[['onMonthChange',['$event']]]]]}}" bindchange="__e"><view class="picker-text input-month data-v-46a4f9b4">{{monthOptions[monthIndex]||'月份'}}</view></picker><picker class="picker exam-type-picker data-v-46a4f9b4" range="{{examTypeOptions}}" value="{{examTypeIndex}}" data-event-opts="{{[['change',[['onExamTypeChange',['$event']]]]]}}" bindchange="__e"><view class="picker-text input-examtype data-v-46a4f9b4">{{examTypeOptions[examTypeIndex]||'考试类型'}}</view></picker></view></view><view class="form-item data-v-46a4f9b4"><text class="label data-v-46a4f9b4">选择科目</text><view data-event-opts="{{[['tap',[['showSubjectModal',['$event']]]]]}}" class="subject-selector data-v-46a4f9b4" bindtap="__e"><view class="subject-display data-v-46a4f9b4"><block wx:if="{{$root.g0===0}}"><text class="placeholder data-v-46a4f9b4">请选择科目（可多选）</text></block><block wx:else><view class="selected-subjects data-v-46a4f9b4"><block wx:for="{{selectedSubjects}}" wx:for-item="subject" wx:for-index="__i0__" wx:key="*this"><view class="subject-tag data-v-46a4f9b4"><text class="subject-text data-v-46a4f9b4">{{subject}}</text><text data-event-opts="{{[['tap',[['removeSubject',['$0'],[[['selectedSubjects','',__i0__]]]]]]]}}" class="remove-subject data-v-46a4f9b4" catchtap="__e">×</text></view></block></view></block></view><text class="arrow data-v-46a4f9b4">></text></view></view><block wx:if="{{$root.g1>0}}"><view class="form-item data-v-46a4f9b4"><text class="label data-v-46a4f9b4">各科成绩</text><view class="scores-container data-v-46a4f9b4"><block wx:for="{{selectedSubjects}}" wx:for-item="subject" wx:for-index="__i1__" wx:key="*this"><view class="score-input-item data-v-46a4f9b4"><text class="score-label data-v-46a4f9b4">{{subject}}</text><input class="input score-input data-v-46a4f9b4" type="number" placeholder="{{subject+'成绩'}}" data-event-opts="{{[['input',[['__set_model',['$0','$1','$event',[]],['subjectScores',[['selectedSubjects','',__i1__]]]]]]]}}" value="{{subjectScores[subject]}}" bindinput="__e"/></view></block></view></view></block><view class="form-item data-v-46a4f9b4"><text class="label data-v-46a4f9b4">备注</text><textarea class="textarea small data-v-46a4f9b4" placeholder="备注信息" data-event-opts="{{[['input',[['__set_model',['$0','remark','$event',[]],['formData']]]]]}}" value="{{formData.remark}}" bindinput="__e"></textarea></view><button data-event-opts="{{[['tap',[['submitScore',['$event']]]]]}}" class="submit-btn card data-v-46a4f9b4" bindtap="__e">提交成绩</button></view></view></block><block wx:if="{{showStudentModalFlag}}"><view data-event-opts="{{[['tap',[['closeStudentModal',['$event']]]]]}}" class="student-modal data-v-46a4f9b4" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="student-modal-content data-v-46a4f9b4" catchtap="__e"><view class="modal-header data-v-46a4f9b4"><text class="modal-title data-v-46a4f9b4">选择学生</text><view data-event-opts="{{[['tap',[['closeStudentModal',['$event']]]]]}}" class="close-btn data-v-46a4f9b4" bindtap="__e"><text class="close-icon data-v-46a4f9b4">×</text></view></view><view class="modal-body data-v-46a4f9b4"><view class="search-container data-v-46a4f9b4"><input class="search-input data-v-46a4f9b4" placeholder="搜索学生姓名或学号" data-event-opts="{{[['input',[['__set_model',['','studentSearchKeyword','$event',[]]],['onStudentSearchInput',['$event']]]]]}}" value="{{studentSearchKeyword}}" bindinput="__e"/></view><view class="student-selection-list data-v-46a4f9b4"><block wx:for="{{$root.l0}}" wx:for-item="student" wx:for-index="__i2__" wx:key="_id"><view data-event-opts="{{[['tap',[['selectStudent',['$0'],[[['filteredStudents','_id',student.$orig._id]]]]]]]}}" class="{{['student-selection-item','data-v-46a4f9b4',(student.m0)?'selected':'']}}" bindtap="__e"><view class="student-avatar data-v-46a4f9b4"><text class="avatar-text data-v-46a4f9b4">{{student.g2}}</text></view><view class="student-info data-v-46a4f9b4"><text class="student-name data-v-46a4f9b4">{{student.$orig.name}}</text><text class="student-details data-v-46a4f9b4">{{student.$orig.studentId+" · "+student.$orig.grade}}</text></view><view class="{{['selection-indicator','data-v-46a4f9b4',(student.m1)?'selected':'']}}"><block wx:if="{{student.m2}}"><text class="check-icon data-v-46a4f9b4">✓</text></block></view></view></block><block wx:if="{{$root.g3===0}}"><view class="no-result data-v-46a4f9b4"><text class="no-result-text data-v-46a4f9b4">暂无匹配的学生</text></view></block></view></view><view class="modal-footer data-v-46a4f9b4"><button data-event-opts="{{[['tap',[['closeStudentModal',['$event']]]]]}}" class="cancel-btn data-v-46a4f9b4" bindtap="__e">取消</button><view class="confirm-btn-container data-v-46a4f9b4"><button data-event-opts="{{[['tap',[['confirmStudent',['$event']]]]]}}" class="confirm-btn data-v-46a4f9b4" bindtap="__e">确定</button></view></view></view></view></block><block wx:if="{{showSubjectModalFlag}}"><view data-event-opts="{{[['tap',[['closeSubjectModal',['$event']]]]]}}" class="subject-modal data-v-46a4f9b4" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="subject-modal-content data-v-46a4f9b4" catchtap="__e"><view class="modal-header data-v-46a4f9b4"><text class="modal-title data-v-46a4f9b4">选择科目</text><view data-event-opts="{{[['tap',[['closeSubjectModal',['$event']]]]]}}" class="close-btn data-v-46a4f9b4" bindtap="__e"><text class="close-icon data-v-46a4f9b4">×</text></view></view><view class="modal-body data-v-46a4f9b4"><view class="subject-selection-list data-v-46a4f9b4"><block wx:for="{{$root.l1}}" wx:for-item="subject" wx:for-index="__i3__" wx:key="$orig"><view data-event-opts="{{[['tap',[['toggleSubject',['$0'],[[['subjectOptions','',__i3__]]]]]]]}}" class="{{['subject-selection-item','data-v-46a4f9b4',(subject.m3)?'selected':'']}}" bindtap="__e"><text class="subject-name data-v-46a4f9b4">{{subject.$orig}}</text><view class="{{['selection-indicator','data-v-46a4f9b4',(subject.m4)?'selected':'']}}"><block wx:if="{{subject.m5}}"><text class="check-icon data-v-46a4f9b4">✓</text></block></view></view></block></view></view><view class="modal-footer data-v-46a4f9b4"><button data-event-opts="{{[['tap',[['closeSubjectModal',['$event']]]]]}}" class="cancel-btn data-v-46a4f9b4" bindtap="__e">取消</button><view class="confirm-btn-container data-v-46a4f9b4"><button data-event-opts="{{[['tap',[['confirmSubjects',['$event']]]]]}}" class="confirm-btn data-v-46a4f9b4" bindtap="__e">{{"确定 ("+$root.g4+")"}}</button></view></view></view></view></block><block wx:if="{{activeTab==='list'}}"><view class="list-container data-v-46a4f9b4"><view class="filter-container data-v-46a4f9b4"><view class="filter-item data-v-46a4f9b4"><picker class="filter-picker data-v-46a4f9b4" value="{{filterGradeIndex}}" range="{{gradeFilterList}}" data-event-opts="{{[['change',[['onFilterGradeChange',['$event']]]]]}}" bindchange="__e"><view class="filter-text data-v-46a4f9b4">{{''+(gradeFilterList[filterGradeIndex]||'全部年级')+''}}</view></picker></view><view class="filter-item data-v-46a4f9b4"><picker class="filter-picker data-v-46a4f9b4" value="{{filterSubjectIndex}}" range="{{subjects}}" data-event-opts="{{[['change',[['onFilterSubjectChange',['$event']]]]]}}" bindchange="__e"><view class="filter-text data-v-46a4f9b4">{{''+(subjects[filterSubjectIndex]||'全部科目')+''}}</view></picker></view></view><view class="score-list data-v-46a4f9b4"><block wx:for="{{$root.l2}}" wx:for-item="score" wx:for-index="__i4__" wx:key="_id"><view class="score-item data-v-46a4f9b4"><view data-event-opts="{{[['tap',[['editScore',['$0'],[[['filteredScores','_id',score.$orig._id]]]]]]]}}" class="score-content data-v-46a4f9b4" bindtap="__e"><view class="score-header data-v-46a4f9b4"><text class="grade-label data-v-46a4f9b4">{{score.$orig.grade}}</text></view><view class="score-header data-v-46a4f9b4"><text class="student-name data-v-46a4f9b4">{{score.$orig.studentName}}</text><text class="{{['data-v-46a4f9b4','score-value',score.m6]}}">{{'成绩：'+score.$orig.score+''}}</text></view><view class="score-info data-v-46a4f9b4"><text class="subject-label data-v-46a4f9b4">{{score.$orig.subject}}</text><text class="coursetype-label data-v-46a4f9b4">{{score.$orig.courseType}}</text><text class="examtype-label data-v-46a4f9b4">{{score.$orig.examType}}</text><text class="date-label data-v-46a4f9b4">{{"考试时间："+score.m7}}</text></view><block wx:if="{{score.$orig.remark}}"><view class="score-remark data-v-46a4f9b4"><text class="remark-text data-v-46a4f9b4">{{score.$orig.remark}}</text></view></block></view><view class="score-actions data-v-46a4f9b4"><view data-event-opts="{{[['tap',[['editScore',['$0'],[[['filteredScores','_id',score.$orig._id]]]]]]]}}" class="action-btn edit-btn data-v-46a4f9b4" catchtap="__e"><text class="action-text data-v-46a4f9b4">修改</text></view><view data-event-opts="{{[['tap',[['deleteScore',['$0'],[[['filteredScores','_id',score.$orig._id]]]]]]]}}" class="action-btn delete-btn data-v-46a4f9b4" catchtap="__e"><text class="action-text data-v-46a4f9b4">删除</text></view></view></view></block></view></view></block></view>