<view class="container data-v-4bb19190"><view class="custom-navbar data-v-4bb19190"><view class="navbar-content data-v-4bb19190"><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="navbar-left data-v-4bb19190" bindtap="__e"><text class="back-icon data-v-4bb19190">‹</text><text class="back-text data-v-4bb19190">返回</text></view><text class="navbar-title data-v-4bb19190">学生录入</text><view class="navbar-right data-v-4bb19190"></view></view></view><view class="form-container data-v-4bb19190"><view class="form-item data-v-4bb19190"><text class="label data-v-4bb19190">学生姓名 *</text><input class="input data-v-4bb19190" placeholder="请输入学生姓名" maxlength="20" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['formData']]]]]}}" value="{{formData.name}}" bindinput="__e"/></view><view class="form-item data-v-4bb19190"><text class="label data-v-4bb19190">年级 *</text><picker mode="selector" value="{{gradeIndex}}" range="{{gradeOptions}}" data-event-opts="{{[['change',[['onGradeChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb19190"><view class="picker data-v-4bb19190">{{''+(formData.grade||'请选择年级')+''}}<text class="arrow data-v-4bb19190">></text></view></picker></view><view class="form-item data-v-4bb19190"><text class="label data-v-4bb19190">所学科目 *</text><view data-event-opts="{{[['tap',[['showSubjectModal',['$event']]]]]}}" class="subject-selector data-v-4bb19190" bindtap="__e"><view class="subject-display data-v-4bb19190"><block wx:if="{{$root.g0===0}}"><text class="placeholder data-v-4bb19190">请选择科目</text></block><block wx:else><view class="selected-subjects data-v-4bb19190"><block wx:for="{{formData.subjects}}" wx:for-item="subject" wx:for-index="index" wx:key="index"><view class="subject-tag data-v-4bb19190"><text class="subject-text data-v-4bb19190">{{subject}}</text><text data-event-opts="{{[['tap',[['removeSubject',[index]]]]]}}" class="remove-btn data-v-4bb19190" catchtap="__e">×</text></view></block></view></block></view><text class="arrow data-v-4bb19190">></text></view></view><view class="form-item data-v-4bb19190"><text class="label data-v-4bb19190">班级</text><view data-event-opts="{{[['tap',[['showClassModal',['$event']]]]]}}" class="class-selector data-v-4bb19190" bindtap="__e"><view class="class-display data-v-4bb19190"><block wx:if="{{$root.g1===0}}"><text class="placeholder data-v-4bb19190">请选择班级（可选）</text></block><block wx:else><view class="selected-classes data-v-4bb19190"><block wx:for="{{formData.classes}}" wx:for-item="classItem" wx:for-index="index" wx:key="index"><view class="class-tag data-v-4bb19190"><text class="class-text data-v-4bb19190">{{classItem.className}}</text><text data-event-opts="{{[['tap',[['removeClass',[index]]]]]}}" class="remove-btn data-v-4bb19190" catchtap="__e">×</text></view></block></view></block></view><text class="arrow data-v-4bb19190">></text></view></view><view class="form-item data-v-4bb19190"><text class="label data-v-4bb19190">学校</text><input class="input data-v-4bb19190" placeholder="请输入学校名称（可选）" maxlength="50" data-event-opts="{{[['input',[['__set_model',['$0','school','$event',[]],['formData']]]]]}}" value="{{formData.school}}" bindinput="__e"/></view><view class="form-item data-v-4bb19190"><text class="label data-v-4bb19190">成绩录入</text><view class="score-input-container data-v-4bb19190"><block wx:for="{{formData.scores}}" wx:for-item="score" wx:for-index="index" wx:key="index"><view class="score-item data-v-4bb19190"><view class="score-subject data-v-4bb19190"><text class="score-label data-v-4bb19190">科目：</text><picker mode="selector" value="{{score.subjectIndex}}" range="{{allSubjects}}" data-event-opts="{{[['change',[['e0',['$event']]]]]}}" data-event-params="{{({index})}}" bindchange="__e" class="data-v-4bb19190"><view class="score-picker data-v-4bb19190">{{''+(score.subject||'请选择科目')+''}}<text class="arrow data-v-4bb19190">></text></view></picker></view><view class="score-value data-v-4bb19190"><text class="score-label data-v-4bb19190">成绩：</text><input class="score-input data-v-4bb19190" placeholder="请输入成绩" type="number" maxlength="3" data-event-opts="{{[['input',[['__set_model',['$0','score','$event',[]],[[['formData.scores','',index]]]]]]]}}" value="{{score.score}}" bindinput="__e"/></view><view class="score-actions data-v-4bb19190"><text data-event-opts="{{[['tap',[['removeScore',[index]]]]]}}" class="remove-score-btn data-v-4bb19190" bindtap="__e">删除</text></view></view></block><view data-event-opts="{{[['tap',[['addScore',['$event']]]]]}}" class="add-score-btn data-v-4bb19190" bindtap="__e"><text class="add-score-text data-v-4bb19190">+ 添加成绩</text></view></view></view></view><view class="preview-section data-v-4bb19190"><text class="preview-title data-v-4bb19190">学号预览</text><block wx:if="{{formData.name&&formData.grade}}"><view class="student-preview data-v-4bb19190"><view class="student-card data-v-4bb19190"><view class="student-info data-v-4bb19190"><text class="student-name data-v-4bb19190">{{formData.name}}</text><text class="student-id data-v-4bb19190">{{"学号："+generatedStudentId}}</text><text class="student-grade data-v-4bb19190">{{"年级："+formData.grade}}</text><text class="student-subjects data-v-4bb19190">{{"科目："+$root.g2}}</text><block wx:if="{{$root.g3>0}}"><text class="student-classes data-v-4bb19190">{{"班级："+$root.g4}}</text></block><block wx:if="{{formData.school}}"><text class="student-school data-v-4bb19190">{{"学校："+formData.school}}</text></block></view></view></view></block><block wx:else><view class="preview-placeholder data-v-4bb19190"><text class="data-v-4bb19190">请填写学生姓名和年级以预览学号</text></view></block></view><view class="button-container data-v-4bb19190"><button class="submit-btn data-v-4bb19190" disabled="{{!canSubmit}}" data-event-opts="{{[['tap',[['submitStudent',['$event']]]]]}}" bindtap="__e">确认录入</button></view><view class="batch-mode data-v-4bb19190"><view data-event-opts="{{[['tap',[['toggleBatchMode',['$event']]]]]}}" class="batch-toggle data-v-4bb19190" bindtap="__e"><text class="batch-text data-v-4bb19190">{{isBatchMode?'退出批量录入':'批量录入模式'}}</text><text class="batch-icon data-v-4bb19190">{{isBatchMode?'−':'+'}}</text></view><block wx:if="{{isBatchMode}}"><view class="batch-container data-v-4bb19190"><view class="batch-info data-v-4bb19190"><text class="data-v-4bb19190">{{"当前已录入 "+$root.g5+" 名学生"}}</text></view><block wx:if="{{$root.g6>0}}"><view class="batch-list data-v-4bb19190"><block wx:for="{{batchStudents}}" wx:for-item="student" wx:for-index="index" wx:key="index"><view class="batch-item data-v-4bb19190"><view class="batch-student-info data-v-4bb19190"><text class="batch-name data-v-4bb19190">{{student.name}}</text><text class="batch-id data-v-4bb19190">{{student.studentId}}</text></view><view class="batch-actions data-v-4bb19190"><button data-event-opts="{{[['tap',[['editBatchStudent',[index]]]]]}}" class="batch-edit-btn data-v-4bb19190" bindtap="__e">编辑</button><button data-event-opts="{{[['tap',[['removeBatchStudent',[index]]]]]}}" class="batch-delete-btn data-v-4bb19190" bindtap="__e">删除</button></view></view></block></view></block><view class="batch-actions data-v-4bb19190"><block wx:if="{{$root.g7>0}}"><button data-event-opts="{{[['tap',[['clearBatch',['$event']]]]]}}" class="batch-clear-btn data-v-4bb19190" bindtap="__e">清空列表</button></block><button class="batch-submit-btn data-v-4bb19190" disabled="{{$root.g8===0}}" data-event-opts="{{[['tap',[['submitBatch',['$event']]]]]}}" bindtap="__e">{{'批量提交 ('+$root.g9+')'}}</button></view></view></block></view><block wx:if="{{showSubjectModalFlag}}"><view data-event-opts="{{[['tap',[['closeSubjectModal',['$event']]]]]}}" class="subject-modal data-v-4bb19190" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="subject-modal-content data-v-4bb19190" catchtap="__e"><view class="modal-header data-v-4bb19190"><text class="modal-title data-v-4bb19190">选择科目</text><view data-event-opts="{{[['tap',[['closeSubjectModal',['$event']]]]]}}" class="close-btn data-v-4bb19190" bindtap="__e"><text class="close-icon data-v-4bb19190">×</text></view></view><view class="modal-body data-v-4bb19190"><view class="subject-grid data-v-4bb19190"><block wx:for="{{$root.l0}}" wx:for-item="subject" wx:for-index="__i0__" wx:key="$orig"><view data-event-opts="{{[['tap',[['toggleSubject',['$0'],[[['allSubjects','',__i0__]]]]]]]}}" class="{{['subject-item','data-v-4bb19190',(subject.g10)?'selected':'']}}" bindtap="__e"><text class="subject-name data-v-4bb19190">{{subject.$orig}}</text><block wx:if="{{subject.g11}}"><text class="check-icon data-v-4bb19190">✓</text></block></view></block></view></view><view class="modal-footer data-v-4bb19190"><button data-event-opts="{{[['tap',[['closeSubjectModal',['$event']]]]]}}" class="cancel-btn data-v-4bb19190" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['confirmSubjects',['$event']]]]]}}" class="confirm-btn data-v-4bb19190" bindtap="__e">确定</button></view></view></view></block><block wx:if="{{showClassModalFlag}}"><view data-event-opts="{{[['tap',[['closeClassModal',['$event']]]]]}}" class="class-modal data-v-4bb19190" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="class-modal-content data-v-4bb19190" catchtap="__e"><view class="modal-header data-v-4bb19190"><text class="modal-title data-v-4bb19190">选择班级</text><view data-event-opts="{{[['tap',[['closeClassModal',['$event']]]]]}}" class="close-btn data-v-4bb19190" bindtap="__e"><text class="close-icon data-v-4bb19190">×</text></view></view><view class="modal-body data-v-4bb19190"><view class="search-container data-v-4bb19190"><input class="search-input data-v-4bb19190" placeholder="🔍 输入班级名称或年级进行搜索" data-event-opts="{{[['input',[['__set_model',['','classSearchKeyword','$event',[]]],['filterClasses',['$event']]]]]}}" value="{{classSearchKeyword}}" bindinput="__e"/><text class="search-icon data-v-4bb19190">🔍</text></view><view class="class-list data-v-4bb19190"><block wx:for="{{$root.l1}}" wx:for-item="classItem" wx:for-index="__i1__" wx:key="_id"><view data-event-opts="{{[['tap',[['toggleClass',['$0'],[[['filteredClassList','_id',classItem.$orig._id]]]]]]]}}" class="{{['class-item','data-v-4bb19190',(classItem.m0)?'selected':'']}}" bindtap="__e"><view class="class-info data-v-4bb19190"><view class="class-header data-v-4bb19190"><text class="class-name data-v-4bb19190">{{classItem.$orig.className}}</text><text class="class-grade data-v-4bb19190">{{classItem.$orig.grade}}</text></view><view class="class-details data-v-4bb19190"><block wx:if="{{classItem.$orig.subject}}"><text class="class-subject data-v-4bb19190">{{classItem.$orig.subject}}</text></block><block wx:if="{{classItem.$orig.headTeacher}}"><text class="class-teacher data-v-4bb19190">{{"班主任："+classItem.$orig.headTeacher}}</text></block><block wx:if="{{classItem.$orig.studentCount!==undefined}}"><text class="class-student-count data-v-4bb19190">{{"学生数："+classItem.$orig.studentCount}}</text></block></view></view><block wx:if="{{classItem.m1}}"><text class="check-icon data-v-4bb19190">✓</text></block></view></block><block wx:if="{{$root.g12}}"><view class="no-result data-v-4bb19190"><text class="no-result-text data-v-4bb19190">未找到匹配的班级</text></view></block></view></view><view class="modal-footer data-v-4bb19190"><button data-event-opts="{{[['tap',[['closeClassModal',['$event']]]]]}}" class="cancel-btn data-v-4bb19190" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['confirmClasses',['$event']]]]]}}" class="confirm-btn data-v-4bb19190" bindtap="__e">确定</button></view></view></view></block></view>