<view class="container data-v-76a5fae8"><view class="custom-navbar data-v-76a5fae8"><view class="navbar-content data-v-76a5fae8"><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="navbar-left data-v-76a5fae8" bindtap="__e"><text class="back-icon data-v-76a5fae8">‹</text><text class="back-text data-v-76a5fae8">返回</text></view><text class="navbar-title data-v-76a5fae8">档案管理</text><view class="navbar-right data-v-76a5fae8"></view></view></view><view class="search-container data-v-76a5fae8"><view class="search-bar data-v-76a5fae8"><text class="search-icon data-v-76a5fae8">🔍</text><input class="search-input data-v-76a5fae8" placeholder="搜索学生姓名、学号或班级" data-event-opts="{{[['input',[['__set_model',['','searchKeyword','$event',[]]],['onSearchInput',['$event']]]]]}}" value="{{searchKeyword}}" bindinput="__e"/><block wx:if="{{searchKeyword}}"><view data-event-opts="{{[['tap',[['clearSearch',['$event']]]]]}}" class="clear-btn data-v-76a5fae8" bindtap="__e"><text class="clear-icon data-v-76a5fae8">×</text></view></block></view></view><view class="category-tabs data-v-76a5fae8"><view data-event-opts="{{[['tap',[['switchTab',['all']]]]]}}" class="{{['category-tab','data-v-76a5fae8',(activeTab==='all')?'active':'']}}" bindtap="__e">全部</view><view data-event-opts="{{[['tap',[['switchTab',['students']]]]]}}" class="{{['category-tab','data-v-76a5fae8',(activeTab==='students')?'active':'']}}" bindtap="__e">学生档案</view><view data-event-opts="{{[['tap',[['switchTab',['classes']]]]]}}" class="{{['category-tab','data-v-76a5fae8',(activeTab==='classes')?'active':'']}}" bindtap="__e">班级档案</view></view><block wx:if="{{!isEditMode}}"><view class="edit-mode-toggle data-v-76a5fae8"><view data-event-opts="{{[['tap',[['enterEditMode',['$event']]]]]}}" class="edit-mode-btn data-v-76a5fae8" bindtap="__e"><image class="edit-icon data-v-76a5fae8" src="/static/745 (1).png" mode="aspectFit"></image></view></view></block><block wx:if="{{localCache.isLoadingBackground}}"><view class="background-loading-indicator data-v-76a5fae8"><view class="loading-progress data-v-76a5fae8"><text class="loading-text data-v-76a5fae8">{{"正在后台加载更多数据... "+localCache.backgroundLoadProgress+"%"}}</text><view class="progress-bar data-v-76a5fae8"><view class="progress-fill data-v-76a5fae8" style="{{'width:'+(localCache.backgroundLoadProgress+'%')+';'}}"></view></view></view></view></block><view class="filter-container data-v-76a5fae8"><view class="filter-row data-v-76a5fae8"><view class="filter-item data-v-76a5fae8"><text class="filter-label data-v-76a5fae8">年级筛选：</text><picker mode="selector" value="{{gradeFilterIndex}}" range="{{gradeOptions}}" data-event-opts="{{[['change',[['onGradeFilterChange',['$event']]]]]}}" bindchange="__e" class="data-v-76a5fae8"><view class="filter-picker data-v-76a5fae8">{{''+(gradeFilter||'全部年级')+''}}<text class="picker-arrow data-v-76a5fae8">▼</text></view></picker></view><view class="filter-item data-v-76a5fae8"><text class="filter-label data-v-76a5fae8">排序方式：</text><picker mode="selector" value="{{sortIndex}}" range="{{sortOptions}}" data-event-opts="{{[['change',[['onSortChange',['$event']]]]]}}" bindchange="__e" class="data-v-76a5fae8"><view class="filter-picker data-v-76a5fae8">{{''+sortOptions[sortIndex]+''}}<text class="picker-arrow data-v-76a5fae8">▼</text></view></picker></view></view></view><view class="data-container data-v-76a5fae8"><block wx:if="{{loading}}"><view class="loading-container data-v-76a5fae8"><text class="loading-text data-v-76a5fae8">加载中...</text></view></block><block wx:if="{{activeTab==='all'||activeTab==='students'}}"><view class="section data-v-76a5fae8"><view class="section-title data-v-76a5fae8"><text class="title-text data-v-76a5fae8">{{"学生档案 ("+studentsTotal+")"}}</text></view><block wx:if="{{$root.g0}}"><view class="empty-state data-v-76a5fae8"><text class="empty-text data-v-76a5fae8">暂无学生档案</text></view></block><block wx:if="{{showStudentsPagination}}"><view class="pagination-container data-v-76a5fae8"><view class="pagination-info data-v-76a5fae8"><text class="pagination-text data-v-76a5fae8">{{"第 "+studentsPage+" 页，共 "+studentsTotalPages+" 页"}}</text></view><view class="pagination-buttons data-v-76a5fae8"><button class="pagination-btn prev-btn data-v-76a5fae8" disabled="{{studentsPage<=1}}" data-event-opts="{{[['tap',[['prevPage',['students']]]]]}}" bindtap="__e">上一页</button><button class="pagination-btn next-btn data-v-76a5fae8" disabled="{{!hasMoreStudents}}" data-event-opts="{{[['tap',[['nextPage',['students']]]]]}}" bindtap="__e">下一页</button></view></view></block><block wx:if="{{$root.g1>0}}"><view class="student-list data-v-76a5fae8"><block wx:for="{{$root.l0}}" wx:for-item="student" wx:for-index="__i0__" wx:key="_id"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({student:student.$orig})}}" class="{{['student-card','data-v-76a5fae8',(student.m0)?'selected':'']}}" bindtap="__e"><block wx:if="{{isEditMode}}"><view class="selection-checkbox data-v-76a5fae8"><view class="{{['checkbox','data-v-76a5fae8',(student.m1)?'checked':'']}}"><block wx:if="{{student.m2}}"><text class="check-icon data-v-76a5fae8">✓</text></block></view></view></block><view class="student-avatar data-v-76a5fae8"><text class="avatar-text data-v-76a5fae8">{{student.g2}}</text></view><view class="student-info data-v-76a5fae8"><view class="student-header data-v-76a5fae8"><text class="student-name data-v-76a5fae8">{{student.$orig.name}}</text><text class="student-id data-v-76a5fae8">{{student.$orig.studentId}}</text></view><view class="student-details data-v-76a5fae8"><text class="student-grade data-v-76a5fae8">{{student.$orig.grade}}</text><text class="student-subjects data-v-76a5fae8">{{student.g3}}</text><block wx:if="{{student.$orig.school}}"><text class="student-school data-v-76a5fae8">{{student.$orig.school}}</text></block></view><view class="student-meta data-v-76a5fae8"><text class="create-time data-v-76a5fae8">{{student.m3}}</text></view></view><view class="student-actions data-v-76a5fae8"><block wx:if="{{!isEditMode}}"><text class="action-icon data-v-76a5fae8">›</text></block><block wx:else><view class="edit-actions data-v-76a5fae8"><button data-event-opts="{{[['tap',[['showDeleteConfirm',['$0','student'],[[['paginatedStudents','_id',student.$orig._id]]]]]]]}}" class="delete-btn data-v-76a5fae8" catchtap="__e">删除</button></view></block></view></view></block></view></block></view></block><block wx:if="{{activeTab==='all'||activeTab==='classes'}}"><view class="section data-v-76a5fae8"><view class="section-title data-v-76a5fae8"><text class="title-text data-v-76a5fae8">{{"班级档案 ("+classesTotal+")"}}</text></view><block wx:if="{{$root.g4}}"><view class="empty-state data-v-76a5fae8"><text class="empty-text data-v-76a5fae8">暂无班级档案</text></view></block><block wx:if="{{showClassesPagination}}"><view class="pagination-container data-v-76a5fae8"><view class="pagination-info data-v-76a5fae8"><text class="pagination-text data-v-76a5fae8">{{"第 "+classesPage+" 页，共 "+classesTotalPages+" 页"}}</text></view><view class="pagination-buttons data-v-76a5fae8"><button class="pagination-btn prev-btn data-v-76a5fae8" disabled="{{classesPage<=1}}" data-event-opts="{{[['tap',[['prevPage',['classes']]]]]}}" bindtap="__e">上一页</button><button class="pagination-btn next-btn data-v-76a5fae8" disabled="{{!hasMoreClasses}}" data-event-opts="{{[['tap',[['nextPage',['classes']]]]]}}" bindtap="__e">下一页</button></view></view></block><block wx:if="{{$root.g5>0}}"><view class="class-list data-v-76a5fae8"><block wx:for="{{$root.l1}}" wx:for-item="classItem" wx:for-index="__i1__" wx:key="_id"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" data-event-params="{{({classItem:classItem.$orig})}}" class="{{['class-card','data-v-76a5fae8',(classItem.m4)?'selected':'']}}" bindtap="__e"><block wx:if="{{isEditMode}}"><view class="selection-checkbox data-v-76a5fae8"><view class="{{['checkbox','data-v-76a5fae8',(classItem.m5)?'checked':'']}}"><block wx:if="{{classItem.m6}}"><text class="check-icon data-v-76a5fae8">✓</text></block></view></view></block><view class="class-icon data-v-76a5fae8"><text class="class-icon-text data-v-76a5fae8">班</text></view><view class="class-info data-v-76a5fae8"><view class="class-header data-v-76a5fae8"><text class="class-name data-v-76a5fae8">{{classItem.$orig.className}}</text><text class="class-code data-v-76a5fae8">{{classItem.$orig.classCode}}</text></view><view class="class-details data-v-76a5fae8"><text class="class-grade data-v-76a5fae8">{{classItem.$orig.grade}}</text><text class="class-teacher data-v-76a5fae8">{{"班主任："+classItem.$orig.teacherName}}</text><text class="class-student-count data-v-76a5fae8">{{"学生数："+(classItem.$orig.studentCount||0)}}</text></view><view class="class-meta data-v-76a5fae8"><text class="create-time data-v-76a5fae8">{{classItem.m7}}</text></view></view><view class="class-actions data-v-76a5fae8"><block wx:if="{{!isEditMode}}"><text class="action-icon data-v-76a5fae8">›</text></block><block wx:else><view class="edit-actions data-v-76a5fae8"><button data-event-opts="{{[['tap',[['showDeleteConfirm',['$0','class'],[[['paginatedClasses','_id',classItem.$orig._id]]]]]]]}}" class="delete-btn data-v-76a5fae8" catchtap="__e">删除</button></view></block></view></view></block></view></block></view></block></view><block wx:if="{{isEditMode}}"><view class="batch-toolbar-fixed data-v-76a5fae8"><view class="toolbar-left data-v-76a5fae8"><view data-event-opts="{{[['tap',[['toggleSelectAll',['$event']]]]]}}" class="select-all-btn data-v-76a5fae8" bindtap="__e"><text class="select-all-text data-v-76a5fae8">{{isAllSelected?'取消全选':'全选'}}</text></view><text class="selected-count data-v-76a5fae8">{{"已选择 "+$root.g6+" 项"}}</text></view><view class="toolbar-right data-v-76a5fae8"><button class="batch-delete-btn data-v-76a5fae8" disabled="{{$root.g7===0}}" data-event-opts="{{[['tap',[['showBatchDeleteConfirm',['$event']]]]]}}" bindtap="__e">批量删除</button><button data-event-opts="{{[['tap',[['exitEditMode',['$event']]]]]}}" class="exit-edit-btn data-v-76a5fae8" bindtap="__e">完成</button></view></view></block><block wx:if="{{showDeleteModal}}"><view data-event-opts="{{[['tap',[['closeDeleteModal',['$event']]]]]}}" class="delete-modal data-v-76a5fae8" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="delete-modal-content data-v-76a5fae8" catchtap="__e"><view class="delete-header data-v-76a5fae8"><text class="delete-title data-v-76a5fae8">确认删除</text></view><view class="delete-body data-v-76a5fae8"><text class="delete-message data-v-76a5fae8">{{deleteMessage}}</text></view><view class="delete-footer data-v-76a5fae8"><button data-event-opts="{{[['tap',[['closeDeleteModal',['$event']]]]]}}" class="cancel-delete-btn data-v-76a5fae8" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['confirmDelete',['$event']]]]]}}" class="confirm-delete-btn data-v-76a5fae8" bindtap="__e">确认删除</button></view></view></view></block></view>