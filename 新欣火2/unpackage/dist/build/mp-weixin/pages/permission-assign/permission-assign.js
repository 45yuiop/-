(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/permission-assign/permission-assign"],{"108d":function(e,t,r){"use strict";r.r(t);var n=r("765e"),a=r("f62d");for(var i in a)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(i);r("799d");var s=r("828b"),u=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,"3268cbaf",null,!1,n["a"],void 0);t["default"]=u.exports},"1b05":function(e,t,r){"use strict";(function(e,t){var n=r("47a9");r("a226"),r("861b");n(r("3240"));var a=n(r("108d"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(a.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},2997:function(e,t,r){"use strict";(function(e,n){var a=r("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r("7eb4")),s=a(r("af34")),u=a(r("ee10")),o=a(r("5fe4")),c={data:function(){return{memberList:[],selectedMember:null,memberFeatures:[],saveLoading:!1,isAdmin:!1,allAssignableFeatures:o.default.filter((function(e){return e.assignable}))}},onShow:function(){var t=e.getStorageSync("userInfo");this.isAdmin=t&&("管理员"===t.permission||Array.isArray(t.role)&&t.role.includes("管理员")||"superadmin"===t.permission),this.initData()},methods:{goBack:function(){getCurrentPages().length>1?e.navigateBack():e.reLaunch({url:"/pages/home/home"})},initData:function(){var t=this;return(0,u.default)(i.default.mark((function r(){var a,s;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.getStorageSync("userInfo"),r.next=3,n.callFunction({name:"user-center",data:{action:"get-accounts"}});case 3:s=r.sent,s.result&&200===s.result.code&&(t.memberList=s.result.data.filter((function(e){var t=e.role&&(Array.isArray(e.role)?e.role.includes("家长"):"家长"===e.role),r=e.role&&(Array.isArray(e.role)?e.role.includes("管理员"):"管理员"===e.role),n="管理员"===e.permission||"superadmin"===e.permission,i=e._id===a._id;return!t&&!i&&!r&&!n}))),t.selectedMember=null,t.memberFeatures=[];case 7:case"end":return r.stop()}}),r)})))()},onMemberChange:function(e){var t=e.detail.value;this.selectedMember=this.memberList[t],this.memberFeatures=Array.isArray(this.selectedMember.featureList)?(0,s.default)(this.selectedMember.featureList):[]},onFeatureChange:function(e){this.memberFeatures=e.detail.value},saveFeatures:function(){var t=this;return(0,u.default)(i.default.mark((function r(){var a,s;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.selectedMember){r.next=2;break}return r.abrupt("return");case 2:return t.saveLoading=!0,a=Array.isArray(t.memberFeatures)?Array.from(t.memberFeatures):[],console.log("即将保存的功能权限:",a),console.log("目标账号ID:",t.selectedMember._id),r.next=8,n.callFunction({name:"user-center",data:{action:"update-account",params:{id:t.selectedMember._id,featureList:a}}});case 8:s=r.sent,console.log("云函数返回:",s),t.saveLoading=!1,e.showToast({title:"保存成功",icon:"success"}),t.initData();case 13:case"end":return r.stop()}}),r)})))()}}};t.default=c}).call(this,r("df3c")["default"],r("861b")["uniCloud"])},"765e":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){}));var n=function(){var e=this.$createElement;this._self._c},a=[]},"799d":function(e,t,r){"use strict";var n=r("f909"),a=r.n(n);a.a},f62d:function(e,t,r){"use strict";r.r(t);var n=r("2997"),a=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},f909:function(e,t,r){}},[["1b05","common/runtime","common/vendor"]]]);