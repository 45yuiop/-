(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscription-settings/subscription-settings"],{"123f":function(e,t,n){},"2e0b":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){}));var o=function(){var e=this.$createElement;this._self._c},s=[]},5835:function(e,t,n){"use strict";n.r(t);var o=n("da21"),s=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=s.a},"5fc1":function(e,t,n){"use strict";var o=n("123f"),s=n.n(o);s.a},ba80:function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("a226"),n("861b");o(n("3240"));var s=o(n("e431"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},da21:function(e,t,n){"use strict";(function(e,o){var s=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=s(n("7eb4")),a=s(n("7ca3")),r=s(n("ee10"));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={data:function(){return{isSubscribed:!1,isSubscribing:!1,hasOpenid:!1,isBinding:!1,isTesting:!1,templateId:"sOwar1Xkzk4ApC2eQvvc4SZFH6UbFz_ZA8DZjHHPZf4"}},onMounted:function(){console.log("ðŸš€ è®¢é˜…è®¾ç½®é¡µé¢åŠ è½½å®Œæˆ"),this.checkUserStatus()},onShow:function(){console.log("ðŸ‘ï¸ è®¢é˜…è®¾ç½®é¡µé¢æ˜¾ç¤º"),this.checkUserStatus()},methods:{goBack:function(){e.navigateBack()},checkUserStatus:function(){var t=this;return(0,r.default)(c.default.mark((function n(){var o,s;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:try{o=e.getStorageSync("subscriptionStatus"),o&&o.isSubscribed?(t.isSubscribed=!0,console.log("âœ… æœ¬åœ°è®¢é˜…çŠ¶æ€ï¼šå·²è®¢é˜…")):(t.isSubscribed=!1,console.log("âŒ æœ¬åœ°è®¢é˜…çŠ¶æ€ï¼šæœªè®¢é˜…")),s=e.getStorageSync("openid"),s?(t.hasOpenid=!0,console.log("âœ… å¾®ä¿¡å·²ç»‘å®š:",s)):(t.hasOpenid=!1,console.log("âŒ å¾®ä¿¡æœªç»‘å®š"))}catch(c){console.error("æ£€æŸ¥ç”¨æˆ·çŠ¶æ€å¤±è´¥:",c),t.isSubscribed=!1,t.hasOpenid=!1}case 1:case"end":return n.stop()}}),n)})))()},onSubscriptionToggle:function(e){var t=this;return(0,r.default)(c.default.mark((function n(){var o;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.detail.value,console.log("ðŸ”„ è®¢é˜…å¼€å…³åˆ‡æ¢: ".concat(o?"å¼€å¯":"å…³é—­")),!o){n.next=7;break}return n.next=5,t.enableSubscription();case 5:n.next=8;break;case 7:t.disableSubscription();case 8:case"end":return n.stop()}}),n)})))()},enableSubscription:function(){var t=this;return(0,r.default)(c.default.mark((function n(){var s,a,r;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.isSubscribing=!0,n.prev=1,console.log("ðŸ” è¯·æ±‚è®¢é˜…æ¶ˆæ¯æŽˆæƒ..."),n.next=5,e.requestSubscribeMessage({tmplIds:[t.templateId]});case 5:if(s=n.sent,console.log("ðŸ“± å¾®ä¿¡æŽˆæƒç»“æžœ:",s),"accept"!==s[t.templateId]){n.next=31;break}if(console.log("âœ… ç”¨æˆ·æŽ¥å—è®¢é˜…æ¶ˆæ¯æŽˆæƒ"),t.isSubscribed=!0,e.setStorageSync("subscriptionStatus",{isSubscribed:!0,status:"accepted",lastUpdate:Date.now(),cacheExpiry:Date.now()+31536e6}),n.prev=11,a=e.getStorageSync("openid"),!a){n.next=22;break}return console.log("ðŸ“¤ åŒæ­¥ä¸»è®¢é˜…æŽˆæƒçŠ¶æ€åˆ°äº‘ç«¯æ•°æ®åº“..."),n.next=17,o.callFunction({name:"subscription-message",data:{action:"request-subscription",openid:a,templateId:t.templateId,status:"accepted"}});case 17:r=n.sent,console.log("âœ… ä¸»è®¢é˜…äº‘ç«¯æ•°æ®åº“åŒæ­¥ç»“æžœ:",r),200===r.result.code?console.log("âœ… ä¸»è®¢é˜…ä¼ªæ°¸ä¹…è®°å½•åˆ›å»ºæˆåŠŸ"):console.log("âš ï¸ ä¸»è®¢é˜…ä¼ªæ°¸ä¹…è®°å½•åˆ›å»ºå¤±è´¥:",r.result.message),n.next=23;break;case 22:console.log("âš ï¸ æœªæ‰¾åˆ°openidï¼Œè·³è¿‡äº‘ç«¯åŒæ­¥");case 23:n.next=28;break;case 25:n.prev=25,n.t0=n["catch"](11),console.error("åŒæ­¥ä¸»è®¢é˜…æŽˆæƒçŠ¶æ€åˆ°äº‘ç«¯å¤±è´¥:",n.t0);case 28:e.showToast({title:"è®¢é˜…æˆåŠŸ",icon:"success"}),n.next=32;break;case 31:"reject"===s[t.templateId]?(console.log("âŒ ç”¨æˆ·æ‹’ç»è®¢é˜…æ¶ˆæ¯æŽˆæƒ"),t.isSubscribed=!1,e.showToast({title:"è®¢é˜…è¢«æ‹’ç»",icon:"none"})):(console.log("âš ï¸ è®¢é˜…æ¶ˆæ¯æŽˆæƒå¤±è´¥:",s[t.templateId]),t.isSubscribed=!1,e.showToast({title:"æŽˆæƒå¤±è´¥",icon:"none"}));case 32:n.next=39;break;case 34:n.prev=34,n.t1=n["catch"](1),console.error("è¯·æ±‚è®¢é˜…æŽˆæƒå¤±è´¥:",n.t1),t.isSubscribed=!1,e.showModal({title:"æŽˆæƒå¤±è´¥",content:"æ— æ³•èŽ·å–è®¢é˜…æ¶ˆæ¯æŽˆæƒï¼Œè¯·ç¨åŽé‡è¯•ã€‚",showCancel:!1,confirmText:"çŸ¥é“äº†"});case 39:return n.prev=39,t.isSubscribing=!1,n.finish(39);case 42:case"end":return n.stop()}}),n,null,[[1,34,39,42],[11,25]])})))()},disableSubscription:function(){try{console.log("ðŸ”’ å…³é—­è®¢é˜…é€šçŸ¥..."),this.isSubscribed=!1,e.removeStorageSync("subscriptionStatus"),e.showToast({title:"å·²å…³é—­è®¢é˜…",icon:"success"})}catch(t){console.error("å…³é—­è®¢é˜…å¤±è´¥:",t)}},handleWechatBinding:function(){var t=this;return(0,r.default)(c.default.mark((function n(){return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.hasOpenid?e.showModal({title:"é‡æ–°ç»‘å®š",content:"æ˜¯å¦è¦é‡æ–°ç»‘å®šå¾®ä¿¡è´¦å·ï¼Ÿ",success:function(e){e.confirm&&t.bindWechat()}}):t.bindWechat();case 1:case"end":return n.stop()}}),n)})))()},bindWechat:function(){var t=this;return(0,r.default)(c.default.mark((function n(){var s,a,r,i;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.isBinding){n.next=3;break}return console.log("æ­£åœ¨ç»‘å®šä¸­ï¼Œè·³è¿‡é‡å¤æ“ä½œ"),n.abrupt("return");case 3:return n.prev=3,t.isBinding=!0,e.showLoading({title:"æ­£åœ¨ç»‘å®š..."}),n.next=8,e.login({provider:"weixin"});case 8:if(s=n.sent,!s.code){n.next=22;break}if(a=e.getStorageSync("userInfo"),a&&a._id){n.next=15;break}return e.hideLoading(),e.showModal({title:"éœ€è¦ç™»å½•",content:"è¯·å…ˆç™»å½•ç³»ç»ŸåŽå†ç»‘å®šå¾®ä¿¡",showCancel:!1}),n.abrupt("return");case 15:return n.next=17,o.callFunction({name:"auth-service",data:{action:"bind-wechat",params:{code:s.code,userId:a._id}}});case 17:r=n.sent,e.hideLoading(),200===r.result.code?(e.setStorageSync("openid",r.result.openid),t.hasOpenid=!0,e.showToast({title:"å¾®ä¿¡ç»‘å®šæˆåŠŸ",icon:"success"})):(i=r.result.message||"ç»‘å®šå¤±è´¥",console.error("å¾®ä¿¡ç»‘å®šå¤±è´¥:",r.result),e.showModal({title:"å¾®ä¿¡ç»‘å®šå¤±è´¥",content:i,showCancel:!1})),n.next=24;break;case 22:e.hideLoading(),e.showToast({title:"èŽ·å–å¾®ä¿¡æŽˆæƒå¤±è´¥",icon:"none"});case 24:n.next=31;break;case 26:n.prev=26,n.t0=n["catch"](3),e.hideLoading(),console.error("ç»‘å®šå¾®ä¿¡å¤±è´¥:",n.t0),e.showToast({title:"ç»‘å®šå¤±è´¥",icon:"none"});case 31:return n.prev=31,t.isBinding=!1,n.finish(31);case 34:case"end":return n.stop()}}),n,null,[[3,26,31,34]])})))()},sendTestMessage:function(){var t=this;return(0,r.default)(c.default.mark((function n(){var s,a,r,i,u,d,b,p,f,g,h,w,m,v,x,S,k,O,T,y,I,M,L,_;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.isTesting){n.next=2;break}return n.abrupt("return");case 2:if(t.isTesting=!0,n.prev=3,console.log("ðŸ§ª å¼€å§‹å‘é€æµ‹è¯•è®¢é˜…æ¶ˆæ¯..."),e.showLoading({title:"æ£€æŸ¥è®¢é˜…çŠ¶æ€..."}),s=e.getStorageSync("openid"),s){n.next=11;break}return e.hideLoading(),e.showModal({title:"éœ€è¦ç»‘å®šå¾®ä¿¡",content:"è¯·å…ˆç»‘å®šå¾®ä¿¡è´¦å·åŽå†å‘é€æµ‹è¯•æ¶ˆæ¯ã€‚",showCancel:!1,confirmText:"çŸ¥é“äº†"}),n.abrupt("return");case 11:return n.prev=11,console.log("ðŸ” æ£€æŸ¥äº‘ç«¯ä¼ªæ°¸ä¹…è®¢é˜…çŠ¶æ€..."),n.next=15,o.callFunction({name:"subscription-message",data:{action:"get-subscription-status",openid:s}});case 15:if(a=n.sent,console.log("ðŸ“Š äº‘ç«¯è®¢é˜…çŠ¶æ€æ£€æŸ¥ç»“æžœ:",a),200!==a.result.code||!a.result.data.isSubscribed){n.next=22;break}console.log("âœ… å‘çŽ°ä¼ªæ°¸ä¹…è®¢é˜…è®°å½•ï¼Œç›´æŽ¥å‘é€æµ‹è¯•æ¶ˆæ¯ï¼ˆæ— éœ€é‡æ–°æŽˆæƒï¼‰"),e.showLoading({title:"å‘é€æµ‹è¯•æ¶ˆæ¯..."}),n.next=36;break;case 22:return console.log("âš ï¸ æœªæ‰¾åˆ°ä¼ªæ°¸ä¹…è®¢é˜…è®°å½•ï¼Œéœ€è¦è¿›è¡Œé¦–æ¬¡æŽˆæƒ"),n.next=25,e.requestSubscribeMessage({tmplIds:[t.templateId]});case 25:if(r=n.sent,console.log("ðŸ“± é¦–æ¬¡æŽˆæƒç»“æžœ:",r),"accept"===r[t.templateId]){n.next=31;break}return e.hideLoading(),e.showModal({title:"éœ€è¦æŽˆæƒ",content:"é¦–æ¬¡ä½¿ç”¨æµ‹è¯•åŠŸèƒ½éœ€è¦æ‚¨æŽˆæƒè®¢é˜…æ¶ˆæ¯ï¼ŒæŽˆæƒåŽåŽç»­ä¸éœ€é‡å¤æŽˆæƒã€‚",showCancel:!1,confirmText:"çŸ¥é“äº†"}),n.abrupt("return");case 31:return n.next=33,o.callFunction({name:"subscription-message",data:{action:"request-subscription",openid:s,templateId:t.templateId,status:"accepted"}});case 33:i=n.sent,200===i.result.code&&console.log("âœ… ä¼ªæ°¸ä¹…è®¢é˜…è®°å½•åˆ›å»ºæˆåŠŸï¼ŒåŽç»­æµ‹è¯•æ— éœ€é‡å¤æŽˆæƒ"),e.showLoading({title:"å‘é€æµ‹è¯•æ¶ˆæ¯..."});case 36:n.next=49;break;case 38:return n.prev=38,n.t0=n["catch"](11),console.error("æ£€æŸ¥äº‘ç«¯è®¢é˜…çŠ¶æ€å¤±è´¥:",n.t0),n.next=43,e.requestSubscribeMessage({tmplIds:[t.templateId]});case 43:if(u=n.sent,"accept"===u[t.templateId]){n.next=48;break}return e.hideLoading(),e.showModal({title:"éœ€è¦æŽˆæƒ",content:"å‘é€æµ‹è¯•æ¶ˆæ¯éœ€è¦æ‚¨æŽˆæƒè®¢é˜…æ¶ˆæ¯ã€‚",showCancel:!1,confirmText:"çŸ¥é“äº†"}),n.abrupt("return");case 48:e.showLoading({title:"å‘é€æµ‹è¯•æ¶ˆæ¯..."});case 49:return d=new Date,b=new Date(d.getTime()+864e5),p=b.getFullYear(),f=b.getMonth()+1,g=b.getDate(),h="".concat(p,"å¹´").concat(f,"æœˆ").concat(g,"æ—¥ 18:00"),w=d.getTime(),m={courseName:"æµ‹è¯•è¯¾ç¨‹-".concat(w),classTime:h,remark:"æµ‹è¯•æ•™å®¤-".concat(d.getSeconds(),"ç§’"),studentName:"æµ‹è¯•å­¦å‘˜",page:"pages/schedule-tab/schedule-tab"},console.log("ðŸ“¤ å³å°†å‘é€çš„æµ‹è¯•æ¶ˆæ¯æ•°æ®:",m),n.next=60,o.callFunction({name:"subscription-message",data:l({action:"send-schedule-notification",openid:s},m)});case 60:if(v=n.sent,console.log("ðŸ“¥ æµ‹è¯•æ¶ˆæ¯å‘é€ç»“æžœ:",v),e.hideLoading(),!v.success||!v.result){n.next=78;break}if(x=v.result,console.log("â˜ï¸ äº‘å‡½æ•°è¿”å›žç»“æžœè¯¦æƒ…:",x),200!==x.code){n.next=75;break}y=null===(S=x.data)||void 0===S?void 0:S.msgid,I=(null===(k=x.data)||void 0===k?void 0:k.method)||"pseudo_permanent",M=(null===(O=x.data)||void 0===O?void 0:O.note)||"",L=null===(T=x.data)||void 0===T?void 0:T.originalError,console.log("âœ… äº‘å‡½æ•°æ‰§è¡ŒæˆåŠŸ:",{msgid:y,method:I,note:M,originalError:L}),!L||"43101"!==L.errcode&&43101!==L.errcode?y?e.showModal({title:"âœ… æµ‹è¯•æˆåŠŸ",content:"æµ‹è¯•è®¢é˜…æ¶ˆæ¯å‘é€æˆåŠŸï¼\n\næ¶ˆæ¯ID: ".concat(y,"\nå‘é€æ—¶é—´: ").concat((new Date).toLocaleString(),"\nå‘é€æ–¹å¼: ").concat(I,"\n\n").concat(M?"è¯´æ˜Ž: "+M+"\n\n":"","è¯·æ£€æŸ¥å¾®ä¿¡æ˜¯å¦æ”¶åˆ°é€šçŸ¥ã€‚"),confirmText:"çŸ¥é“äº†",showCancel:!1}):e.showModal({title:"âœ… å¤„ç†æˆåŠŸ",content:"æµ‹è¯•æ¶ˆæ¯å·²å¤„ç†ï¼\n\nå¤„ç†æ—¶é—´: ".concat((new Date).toLocaleString(),"\nå¤„ç†æ–¹å¼: ").concat(I,"\n\n").concat(M?"è¯´æ˜Ž: "+M:"æ¶ˆæ¯å·²æŒ‰ç‰¹æ®Šç­–ç•¥å¤„ç†"),confirmText:"çŸ¥é“äº†",showCancel:!1}):(_=t.isSubscribed,console.log("ðŸ” 43101é”™è¯¯åˆ†æž:",{localSubscribed:_,errorCode:L.errcode,errorMsg:L.errmsg}),e.showModal({title:"ðŸ“± å¾®ä¿¡é€šçŸ¥è®¾ç½®æé†’",content:"æ‚¨çš„è®¢é˜…çŠ¶æ€æ­£å¸¸ï¼Œä½†å¾®ä¿¡å¯èƒ½åœ¨ç³»ç»Ÿå±‚é¢é™åˆ¶äº†é€šçŸ¥ã€‚\n\nâœ… ä¼ªæ°¸ä¹…è®¢é˜…ä»ç„¶æœ‰æ•ˆ\nâœ… æ— éœ€é‡æ–°æŽˆæƒ\nâœ… å¯ç»§ç»­æ­£å¸¸å‘é€\n\nå¦‚éœ€æŽ¥æ”¶å¾®ä¿¡é€šçŸ¥ï¼Œè¯·æ£€æŸ¥ï¼š\n1. å¾®ä¿¡-è®¾ç½®-é€šç”¨-å°ç¨‹åº-é€šçŸ¥ç®¡ç†\n2. ç¡®ä¿å¼€å¯äº†æœ¬å°ç¨‹åºçš„é€šçŸ¥æƒé™",confirmText:"çŸ¥é“äº†",showCancel:!1})),n.next=76;break;case 75:throw new Error(x.message||"äº‘å‡½æ•°æ‰§è¡Œå¤±è´¥");case 76:n.next=79;break;case 78:throw new Error("äº‘å‡½æ•°è°ƒç”¨å¤±è´¥");case 79:n.next=86;break;case 81:n.prev=81,n.t1=n["catch"](3),e.hideLoading(),console.error("å‘é€æµ‹è¯•æ¶ˆæ¯å¤±è´¥:",n.t1),e.showModal({title:"æµ‹è¯•å¤±è´¥",content:"æµ‹è¯•æ¶ˆæ¯å‘é€å¤±è´¥ï¼š\n\n".concat(n.t1.message,"\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•ã€‚"),confirmText:"çŸ¥é“äº†",showCancel:!1});case 86:return n.prev=86,t.isTesting=!1,n.finish(86);case 89:case"end":return n.stop()}}),n,null,[[3,81,86,89],[11,38]])})))()}}};t.default=u}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},e431:function(e,t,n){"use strict";n.r(t);var o=n("2e0b"),s=n("5835");for(var c in s)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(c);n("5fc1");var a=n("828b"),r=Object(a["a"])(s["default"],o["b"],o["c"],!1,null,"63ee5c25",null,!1,o["a"],void 0);t["default"]=r.exports}},[["ba80","common/runtime","common/vendor"]]]);