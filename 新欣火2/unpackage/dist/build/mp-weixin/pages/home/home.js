(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/home"],{"05d0":function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){}));var s=function(){var t=this,e=t.$createElement,n=(t._self._c,t.filteredFeatures.length),s=t.__map(t.filteredFeatures,(function(e,n){var s=t.__get_orig(e),r=n<8?t.getLightColor(e.color,e.bgAlpha||.15):null;return{$orig:s,m0:r}})),r=t.__map(t.newsList,(function(e,n){var s=t.__get_orig(e),r=t.getNewsSnippet(e),a=e.contentBlocks&&e.contentBlocks.length>0,i=a?e.contentBlocks.filter((function(t){return"image"===t.type})).slice(0,1):null,o=t.formatTime(e.time);return{$orig:s,m1:r,g1:a,l1:i,m2:o}}));t.$mp.data=Object.assign({},{$root:{g0:n,l0:s,l2:r}})},r=[]},"1a6e":function(t,e,n){},"66e8":function(t,e,n){"use strict";(function(t,e){var s=n("47a9");n("a226"),n("861b");s(n("3240"));var r=s(n("cd68"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},9563:function(t,e,n){"use strict";var s=n("1a6e"),r=n.n(s);r.a},a2bd:function(t,e,n){"use strict";n.r(e);var s=n("a736"),r=n.n(s);for(var a in s)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(a);e["default"]=r.a},a736:function(t,e,n){"use strict";(function(t,s){var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(n("7eb4")),i=r(n("ee10")),o=r(n("af34"));var c={data:function(){return{announcementText:"重要通知：老师课程表已更新，请各位老师及时查看。",bannerList:["/static/jj.png","/static/j.png"],showSubscriptionBanner:!1,subscriptionBannerTitle:"",subscriptionBannerDesc:"",subscriptionBannerBtnText:"",quickActions:[{text:"教师课程表",icon:"/static/bbb.png",page:"/pages/admin-teacher-schedule/admin-teacher-schedule",color:"#64B5F6"},{text:"我的课表",icon:"/static/d.png",page:"/pages/teacher-courses/teacher-courses",color:"#FFF3CD",bgAlpha:.8},{text:"教师排课",icon:"/static/bb.png",page:"/pages/teacher-schedule/teacher-schedule",color:"#7C4DFF"},{text:"课时统计",icon:"/static/b.png",page:"/pages/salary-statistics/salary-statistics",color:"#FF8A65"},{text:"注册账号",icon:"/static/aaa.png",page:"/pages/register/register",color:"#4FC3F7"},{text:"账号管理",icon:"/static/c.png",page:"/pages/account-manage/account-manage",color:"#FFD600"},{text:"我的班级",icon:"/static/教室.png",page:"/pages/my-class/my-class",color:"#9C27B0"},{text:"权限分配",icon:"/static/dd.png",page:"/pages/permission-assign/index",color:"#BA68C8",bgAlpha:1},{text:"调课审批",icon:"/static/e.png",page:"/pages/course-change-approval/course-change-approval",color:"#FFB300"},{text:"系统设置",icon:"/static/cc.png",page:"/pages/system-setting/system-setting",color:"#42A5F5"},{text:"更多",icon:"/static/f.png",page:"/pages/service/service",color:"#e0e0e0"},{text:"学生档案",icon:"/static/gongju.png",page:"/pages/archive/archive",color:"#42A5F5"},{text:"学生录入",icon:"/static/1234.png",page:"/pages/student-input/student-input",color:"#4FC3F7"},{text:"班级管理",icon:"/static/222.png",page:"/pages/class-management/class-management",color:"#9C27B0"},{text:"成绩",icon:"/static/1.png",page:"/pages/exam-scores/exam-scores",color:"#FF6B6B"},{text:"进步分析",icon:"/static/ii.png",page:"/pages/student-progress/student-progress",color:"#4ECDC4"},{text:"教室",icon:"/static/2.png",page:"/pages/classroom/classroom",color:"#1976D2"},{text:"师资力量",icon:"/static/user.png",page:"/pages/faculty-strength/faculty-strength",color:"#FF9800"},{text:"试卷分析",icon:"/static/22.png",page:"/pages/exam-analysis/exam-analysis",color:"#E91E63"}],newsList:[{id:"1",title:"公司荣获XX奖项11",content:"近日，公司在教育领域取得了重大突破，荣获XX奖项。这是对我们专注教育、点亮成长理念的肯定。",time:"2024-06-01"},{id:"2",title:"新产品发布",content:"我们推出了全新的教育管理系统，为学生和老师提供更好的服务体验。",time:"2024-05-28"}]}},computed:{isAdmin:function(){var e=t.getStorageSync("userInfo");return e&&("管理员"===e.permission||"superadmin"===e.permission)},isAcademic:function(){var e=t.getStorageSync("userInfo");return e&&(Array.isArray(e.role)?e.role.includes("教务"):"教务"===e.role)},filteredFeatures:function(){var e=this,n=t.getStorageSync("userInfo");if(!n)return[];var s="superadmin"===n.permission,r="管理员"===n.permission||s||Array.isArray(n.role)&&n.role.includes("管理员"),a=Array.isArray(n.role)?n.role.includes("教师"):"教师"===n.role,i=Array.isArray(n.role)?n.role.includes("家长"):"parent"===n.role,c=this.isAcademic,u=(c&&n.permission,a&&r),l=(0,o.default)(this.quickActions),p=l.filter((function(t){if(s)return!0;if(c){if("教师课程表"===t.text||"学生档案"===t.text||"教室"===t.text||"成绩"===t.text||"注册账号"===t.text||"教师排课"===t.text||"权限分配"===t.text||"班级管理"===t.text||"学生录入"===t.text||"试卷分析"===t.text||"更多"===t.text)return!0;if(n.featureList&&Array.isArray(n.featureList)){var o=e.getFeatureKey(t.text);return n.featureList.includes(o)}return!1}return(!u||"学生课时录入"!==t.text)&&((!s||"我的课表"!==t.text)&&(r?"师资力量"!==t.text:i?"教师课程表"===t.text||"师资力量"===t.text:!!a&&("我的课表"===t.text||"课时统计"===t.text||"教室"===t.text||"成绩"===t.text||"进步分析"===t.text||"试卷分析"===t.text||"我的班级"===t.text||"更多"===t.text)))}));c&&(p=p.filter((function(t){return"我的课表"!==t.text&&"我的班级"!==t.text&&"进步分析"!==t.text&&"试卷分析"!==t.text&&"教师排课"!==t.text&&"权限分配"!==t.text&&"课时统计"!==t.text&&"师资力量"!==t.text&&"系统设置"!==t.text&&"账号管理"!==t.text}))),p=p.filter((function(t){return"更多"!==t.text})),p.length>8&&(p=p.slice(0,7));var g=l.find((function(t){return"更多"===t.text}));return g&&p.push(g),p}},methods:{goTo:function(e){"更多"===e.text?t.switchTab({url:e.page}):t.navigateTo({url:e.page})},goToSearch:function(){t.navigateTo({url:"/pages/search-page/search-page"})},openNewsEditor:function(){var e=t.getStorageSync("userInfo");!e||"管理员"!==e.permission&&"superadmin"!==e.permission?t.showToast({title:"只有管理员可以发布新闻",icon:"none"}):t.navigateTo({url:"/pages/news-edit/news-edit"})},viewNewsDetail:function(e){t.navigateTo({url:"/pages/news-detail/news-detail?id=".concat(e.id)})},getLightColor:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;if(!t)return"rgba(200,200,200,".concat(e,")");t=t.replace("#",""),3===t.length&&(t=t.split("").map((function(t){return t+t})).join(""));var n=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);return"rgba(".concat(n,",").concat(s,",").concat(r,",").concat(e,")")},getFeatureKey:function(t){return{"注册账号":"register","账号管理":"user_manage","教师排课":"schedule","课时统计":"salary","教师课程表":"admin_teacher_schedule","我的课表":"teacher_courses","权限分配":"permission_assign","系统设置":"system_setting","学生课时":"student_hours_query","学生课时录入":"student_hours","我的班级":"my_class","师资力量":"faculty_strength","试卷分析":"exam_analysis","教室":"classroom","成绩":"exam_scores","进步分析":"student_progress","订阅通知":"subscription_notification"}[t]||t},onLoad:function(){this.loadNewsFromCloud()},onShow:function(){this.loadNewsFromCloud(),this.checkAndPromptSubscription()},checkAndPromptSubscription:function(){var e=this;return(0,i.default)(a.default.mark((function n(){var s,r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,s=t.getStorageSync("openid"),s){n.next=6;break}return e.setSubscriptionBanner("微信绑定","为了及时接收课程通知，建议先绑定微信账号","立即绑定"),setTimeout((function(){e.showSubscriptionPrompt("微信绑定","为了及时接收课程通知，建议先绑定微信账号")}),2e3),n.abrupt("return");case 6:r=t.getStorageSync("subscriptionStatus"),r&&"accepted"===r.status?e.showSubscriptionBanner=!1:(e.setSubscriptionBanner("订阅通知","开通订阅通知，及时接收课程安排、调课等重要信息","立即开通"),setTimeout((function(){e.showSubscriptionPrompt("订阅通知","开通订阅通知，及时接收课程安排、调课等重要信息")}),2e3)),n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),console.error("检查订阅状态失败:",n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},setSubscriptionBanner:function(t,e,n){this.subscriptionBannerTitle=t,this.subscriptionBannerDesc=e,this.subscriptionBannerBtnText=n,this.showSubscriptionBanner=!0},goToSubscription:function(){t.navigateTo({url:"/pages/subscription-settings/subscription-settings"})},showSubscriptionPrompt:function(e,n){t.showModal({title:"💡 ".concat(e),content:n,confirmText:"立即开通",cancelText:"稍后再说",success:function(e){e.confirm&&t.navigateTo({url:"/pages/subscription-settings/subscription-settings"})}})},onReady:function(){t.$on("newsUpdated",this.handleNewsUpdated),t.$on("subscriptionStatusChanged",this.handleSubscriptionStatusChanged),t.$on("wechatBoundSuccess",this.handleWechatBoundSuccess)},onUnload:function(){t.$off("newsUpdated",this.handleNewsUpdated),t.$off("subscriptionStatusChanged",this.handleSubscriptionStatusChanged),t.$off("wechatBoundSuccess",this.handleWechatBoundSuccess)},loadNewsFromCloud:function(){var e=this;return(0,i.default)(a.default.mark((function n(){var r,i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s.callFunction({name:"news-service",data:{action:"listNews",page:1,pageSize:50}});case 3:if(r=n.sent,!r||!r.result||0!==r.result.code){n.next=7;break}return e.newsList=r.result.data.map((function(t){return{id:t._id||t.id,title:t.title,content:t.content,time:t.time,contentBlocks:t.contentBlocks||[]}})),n.abrupt("return");case 7:n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](0),console.error("云端加载新闻失败，回退本地:",n.t0);case 12:i=t.getStorageSync("newsList"),i&&Array.isArray(i)&&(e.newsList=i);case 14:case"end":return n.stop()}}),n,null,[[0,9]])})))()},handleNewsUpdated:function(){this.loadNewsFromCloud()},handleSubscriptionStatusChanged:function(t){this.showSubscriptionBanner="accepted"===t.status,this.subscriptionBannerTitle=t.title,this.subscriptionBannerDesc=t.desc,this.subscriptionBannerBtnText=t.btnText},handleWechatBoundSuccess:function(){this.checkAndPromptSubscription()},getNewsSnippet:function(t){if(!t.content)return"";if(t.contentBlocks&&t.contentBlocks.length>0){var e=t.contentBlocks.filter((function(t){return"text"===t.type})).map((function(t){return t.content})).join(" ");if(e.trim()){return e.length<=80?e:e.substring(0,80)+"..."}}return t.content.length<=80?t.content:t.content.substring(0,80)+"..."},formatTime:function(t){if(!t)return"";var e=new Date(t),n=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0");return"".concat(n,"-").concat(s,"-").concat(r)}}};e.default=c}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},cd68:function(t,e,n){"use strict";n.r(e);var s=n("05d0"),r=n("a2bd");for(var a in r)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n("9563");var i=n("828b"),o=Object(i["a"])(r["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);e["default"]=o.exports}},[["66e8","common/runtime","common/vendor"]]]);