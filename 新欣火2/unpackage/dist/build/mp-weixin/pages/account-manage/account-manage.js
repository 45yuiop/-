(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/account-manage/account-manage"],{1040:function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("a226"),i("861b");n(i("3240"));var s=n(i("665d"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(s.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"53a3":function(e,t,i){"use strict";var n=i("f3ea"),s=i.n(n);s.a},"665d":function(e,t,i){"use strict";i.r(t);var n=i("c32c"),s=i("66f8");for(var o in s)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(o);i("53a3");var r=i("828b"),d=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=d.exports},"66f8":function(e,t,i){"use strict";i.r(t);var n=i("bf3f"),s=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=s.a},bf3f:function(e,t,i){"use strict";(function(e,n){var s=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(i("7eb4")),r=s(i("ee10")),d={data:function(){return{showEdit:!1,editOriginUsername:"",editUsername:"",editPassword:"",editTeacherName:"",editRoleOptions:["教师","家长","教务"],editRoleIndex:0,editSubjectOptions:["语文","数学","英语","物理","化学"],editSubjectIndex:0,editDepartmentOptions:["小学部","初中部"],editDepartmentIndex:-1,editWorkTypeOptions:["全职","兼职"],editWorkTypeIndex:0,editPermissionOptions:["普通用户","管理员"],editPermissionIndex:0,editSupervisorList:[],editSelectedSupervisor:null,editShowSupervisorPicker:!1,showDeleteModal:!1,deleteUsername:"",deleteUid:"",searchText:"",accountList:[]}},computed:{editShowSubjectSelect:function(){var e=this.editRoleOptions[this.editRoleIndex];return"教师"===e},editShowPermissionSelect:function(){var e=this.editRoleOptions[this.editRoleIndex];return"家长"!==e},editShowSupervisorSelect:function(){var e=this.editRoleOptions[this.editRoleIndex];return"教师"===e||"教务"===e},filteredAccountList:function(){var e=this;return this.accountList.filter((function(t){return t.teacherName&&t.teacherName.includes(e.searchText)||t.role.includes(e.searchText)||t.subject&&t.subject.includes(e.searchText)}))}},onShow:function(){this.fetchAccountList()},methods:{fetchAccountList:function(){var t=this;e.callFunction({name:"user-center",data:{action:"get-accounts"},success:function(e){e.result&&200===e.result.code&&(t.accountList=e.result.data)},fail:function(e){console.error("获取账号列表失败",e)}})},fetchEditSupervisorList:function(t){var i=this;return(0,r.default)(o.default.mark((function n(){var s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("教师"===t||"教务"===t){n.next=3;break}return i.editSupervisorList=[],n.abrupt("return");case 3:return n.prev=3,n.next=6,e.callFunction({name:"user-center",data:{action:"getSupervisors",params:{role:t}}});case 6:s=n.sent,200===s.result.code?i.editSupervisorList=s.result.data:i.editSupervisorList=[],n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](3),i.editSupervisorList=[];case 13:case"end":return n.stop()}}),n,null,[[3,10]])})))()},selectEditSupervisor:function(e){this.editSelectedSupervisor=e,this.editShowSupervisorPicker=!1},openDelete:function(e){this.deleteUsername=e.username,this.deleteUid=e._id,this.showDeleteModal=!0},doDeleteAccount:function(){var t=this;e.callFunction({name:"user-center",data:{action:"delete-account",params:{id:this.deleteUid}},success:function(e){var i=e.result;200===i.code?(t.fetchAccountList(),t.showDeleteModal=!1,n.showToast({title:"账号已删除",icon:"success"})):n.showToast({title:i.message||"删除账号失败",icon:"none"})},fail:function(e){console.error("删除账号请求失败",e),n.showToast({title:"删除账号失败",icon:"none"})}})},openEdit:function(e){if(this.editOriginUsername=e.username,this.editUid=e._id,this.editUsername=e.username,this.editPassword="",this.editTeacherName=e.teacherName||"",this.editRoleIndex=this.editRoleOptions.indexOf(e.role)>-1?this.editRoleOptions.indexOf(e.role):0,this.editSubjectIndex=this.editSubjectOptions.indexOf(e.subject)>-1?this.editSubjectOptions.indexOf(e.subject):0,this.editDepartmentIndex=e.department&&this.editDepartmentOptions.indexOf(e.department)>-1?this.editDepartmentOptions.indexOf(e.department):-1,this.editWorkTypeIndex=this.editWorkTypeOptions.indexOf(e.workType)>-1?this.editWorkTypeOptions.indexOf(e.workType):0,this.editPermissionIndex=this.editPermissionOptions.indexOf(e.permission)>-1?this.editPermissionOptions.indexOf(e.permission):0,this.editSelectedSupervisor=null,this.fetchEditSupervisorList(e.role),e.supervisor){var t=this.editSupervisorList.find((function(t){return t._id===e.supervisor}));this.editSelectedSupervisor=t||{_id:e.supervisor,teacherName:"已选上级",username:""}}this.showEdit=!0},onEditRoleChange:function(e){this.editRoleIndex=e;var t=this.editRoleOptions[e];this.fetchEditSupervisorList(t),this.editSelectedSupervisor=null},onEditSubjectChange:function(e){this.editSubjectIndex=e},onEditDepartmentChange:function(e){this.editDepartmentIndex=e},onEditWorkTypeChange:function(e){this.editWorkTypeIndex=e},onEditPermissionChange:function(e){this.editPermissionIndex=e},saveEdit:function(){var t=this;if(this.editUsername){var i=this.editRoleOptions[this.editRoleIndex],s="",o="",r="",d="";"家长"!==i&&(s=this.editPermissionOptions[this.editPermissionIndex]),"教师"===i&&(o=this.editSubjectOptions[this.editSubjectIndex]),"教师"===i&&(o=this.editSubjectOptions[this.editSubjectIndex],d=this.editWorkTypeOptions[this.editWorkTypeIndex],this.editDepartmentIndex>=0&&(r=this.editDepartmentOptions[this.editDepartmentIndex]));var c={id:this.editUid,username:this.editUsername,teacherName:this.editTeacherName,role:i,permission:s,subject:o,department:r,workType:d,supervisor:this.editSelectedSupervisor?this.editSelectedSupervisor._id:""};this.editPassword&&(c.password=this.editPassword),e.callFunction({name:"user-center",data:{action:"update-account",params:c},success:function(e){var i=e.result;200===i.code?(t.fetchAccountList(),t.showEdit=!1,n.showToast({title:"修改成功",icon:"success"})):n.showToast({title:i.message||"修改账号失败",icon:"none"})},fail:function(e){console.error("修改账号请求失败",e),n.showToast({title:"修改账号失败",icon:"none"})}})}else n.showToast({title:"账号不能为空",icon:"none"})},goBack:function(){n.navigateBack()},searchAccounts:function(){},resetPassword:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",i=0;i<8;i++)t+=e.charAt(Math.floor(Math.random()*e.length));this.editPassword=t,n.showModal({title:"密码已重设",content:"新密码：".concat(t,"\n\n请将此密码告知用户，建议用户登录后及时修改密码。"),showCancel:!1,confirmText:"确定"})}}};t.default=d}).call(this,i("861b")["uniCloud"],i("df3c")["default"])},c32c:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.showEdit&&e.editShowSupervisorPicker?e.editSupervisorList.length:null);e._isMounted||(e.e0=function(t){e.editShowSupervisorPicker=!0},e.e1=function(t){e.editShowSupervisorPicker=!1},e.e2=function(t){e.editShowSupervisorPicker=!1},e.e3=function(t){e.showEdit=!1},e.e4=function(t){e.showDeleteModal=!1}),e.$mp.data=Object.assign({},{$root:{g0:i}})},s=[]},f3ea:function(e,t,i){}},[["1040","common/runtime","common/vendor"]]]);