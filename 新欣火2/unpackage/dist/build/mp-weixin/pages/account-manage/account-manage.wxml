<view class="account-manage-page"><view class="register-title">账号管理</view><view class="search-bar"><input class="search-input" placeholder="搜索姓名/角色/科目" data-event-opts="{{[['confirm',[['searchAccounts',['$event']]]],['input',[['__set_model',['','searchText','$event',[]]]]]]}}" value="{{searchText}}" bindconfirm="__e" bindinput="__e"/><button data-event-opts="{{[['tap',[['searchAccounts',['$event']]]]]}}" class="search-btn" bindtap="__e">搜索</button></view><block wx:for="{{filteredAccountList}}" wx:for-item="acc" wx:for-index="__i0__" wx:key="username"><view class="account-item"><view class="account-info"><text class="account-name">{{acc.teacherName||'未设置姓名'}}</text><text class="account-role">{{acc.role}}</text><view class="account-tags"><block wx:if="{{acc.subject}}"><text class="tag tag-subject">{{acc.subject}}</text></block><block wx:if="{{acc.department}}"><text class="tag tag-department">{{acc.department}}</text></block><block wx:if="{{acc.workType}}"><text class="tag tag-worktype">{{acc.workType}}</text></block><text class="tag tag-permission">{{acc.permission||'无权限'}}</text></view></view><view class="account-actions"><button data-event-opts="{{[['tap',[['openEdit',['$0'],[[['filteredAccountList','username',acc.username]]]]]]]}}" class="edit-btn beautify-btn" bindtap="__e">修改</button><button data-event-opts="{{[['tap',[['openDelete',['$0'],[[['filteredAccountList','username',acc.username]]]]]]]}}" class="delete-btn beautify-btn" bindtap="__e">删除</button></view></view></block><view class="fixed-bottom-bar"><button data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="back-btn" bindtap="__e">返回</button></view><block wx:if="{{showEdit}}"><view class="edit-modal"><view class="edit-modal-content"><view class="edit-title">修改账号信息</view><view class="edit-label">账号</view><input class="edit-input" placeholder="账号" data-event-opts="{{[['input',[['__set_model',['','editUsername','$event',[]]]]]]}}" value="{{editUsername}}" bindinput="__e"/><view class="edit-label">密码</view><input class="edit-input" placeholder="留空则不修改密码" data-event-opts="{{[['input',[['__set_model',['','editPassword','$event',[]]]]]]}}" value="{{editPassword}}" bindinput="__e"/><view class="edit-label">姓名</view><input class="edit-input" placeholder="姓名" data-event-opts="{{[['input',[['__set_model',['','editTeacherName','$event',[]]]]]]}}" value="{{editTeacherName}}" bindinput="__e"/><view class="edit-label">角色</view><view class="edit-role-select"><block wx:for="{{editRoleOptions}}" wx:for-item="role" wx:for-index="idx" wx:key="*this"><view data-event-opts="{{[['tap',[['onEditRoleChange',[idx]]]]]}}" class="{{['role-btn',[(editRoleIndex===idx)?'active':'']]}}" bindtap="__e">{{role}}</view></block></view><block wx:if="{{editShowSubjectSelect}}"><view class="edit-label">教学科目</view></block><block wx:if="{{editShowSubjectSelect}}"><view class="edit-subject-select"><block wx:for="{{editSubjectOptions}}" wx:for-item="subject" wx:for-index="idx" wx:key="*this"><view data-event-opts="{{[['tap',[['onEditSubjectChange',[idx]]]]]}}" class="{{['subject-btn',[(editSubjectIndex===idx)?'active':'']]}}" bindtap="__e">{{subject}}</view></block></view></block><block wx:if="{{editShowSubjectSelect}}"><view class="edit-label">所属部门</view></block><block wx:if="{{editShowSubjectSelect}}"><view class="edit-department-select"><block wx:for="{{editDepartmentOptions}}" wx:for-item="dept" wx:for-index="idx" wx:key="*this"><view data-event-opts="{{[['tap',[['onEditDepartmentChange',[idx]]]]]}}" class="{{['department-btn',[(editDepartmentIndex===idx)?'active':'']]}}" bindtap="__e">{{dept}}</view></block></view></block><block wx:if="{{editShowSubjectSelect}}"><view class="edit-label">工作类型</view></block><block wx:if="{{editShowSubjectSelect}}"><view class="edit-worktype-select"><block wx:for="{{editWorkTypeOptions}}" wx:for-item="type" wx:for-index="idx" wx:key="*this"><view data-event-opts="{{[['tap',[['onEditWorkTypeChange',[idx]]]]]}}" class="{{['worktype-btn',[(editWorkTypeIndex===idx)?'active':'']]}}" bindtap="__e">{{type}}</view></block></view></block><block wx:if="{{editShowPermissionSelect}}"><view class="edit-label">权限</view></block><block wx:if="{{editShowPermissionSelect}}"><view class="edit-permission-select"><block wx:for="{{editPermissionOptions}}" wx:for-item="permission" wx:for-index="idx" wx:key="*this"><view data-event-opts="{{[['tap',[['onEditPermissionChange',[idx]]]]]}}" class="{{['permission-btn',[(editPermissionIndex===idx)?'active':'']]}}" bindtap="__e">{{permission}}</view></block></view></block><block wx:if="{{editShowSupervisorSelect}}"><view class="edit-label">直属上级（可选）</view></block><block wx:if="{{editShowSupervisorSelect}}"><view class="edit-supervisor-select"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="supervisor-placeholder" bindtap="__e"><block wx:if="{{editSelectedSupervisor}}"><text>{{editSelectedSupervisor.teacherName+" ("+editSelectedSupervisor.username+")"}}</text></block><block wx:else><text class="placeholder-text">请选择上级领导</text></block><text class="arrow-down">▼</text></view></view></block><block wx:if="{{editShowSupervisorPicker}}"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="supervisor-picker-overlay" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="supervisor-picker-content" catchtap="__e"><view class="picker-header"><text class="picker-title">选择上级领导</text><text data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="picker-close" bindtap="__e">×</text></view><view class="supervisor-list"><block wx:for="{{editSupervisorList}}" wx:for-item="supervisor" wx:for-index="__i1__" wx:key="_id"><view data-event-opts="{{[['tap',[['selectEditSupervisor',['$0'],[[['editSupervisorList','_id',supervisor._id]]]]]]]}}" class="supervisor-item" bindtap="__e"><text class="supervisor-name">{{supervisor.teacherName}}</text><text class="supervisor-username">{{supervisor.username}}</text></view></block><block wx:if="{{$root.g0===0}}"><view class="no-supervisor"><text>暂无可选的上级领导</text></view></block></view></view></view></block><view class="edit-modal-btns"><button data-event-opts="{{[['tap',[['saveEdit',['$event']]]]]}}" class="register-btn" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" class="cancel-btn" bindtap="__e">取消</button></view></view></view></block><block wx:if="{{showDeleteModal}}"><view class="edit-modal"><view class="delete-modal-content"><view class="delete-title">确认删除</view><view class="delete-content">确定要删除该账号吗？此操作不可恢复。</view><view class="edit-modal-btns"><button data-event-opts="{{[['tap',[['e4',['$event']]]]]}}" class="cancel-btn" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['doDeleteAccount',['$event']]]]]}}" class="confirm-delete-btn" bindtap="__e">确认</button></view></view></view></block></view>