(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my-class/my-class"],{1680:function(e,t,s){"use strict";var n=s("a4d9"),a=s.n(n);a.a},"3a93":function(e,t,s){"use strict";(function(e,n){var a=s("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(s("7eb4")),c=a(s("af34")),o=a(s("ee10")),u=a(s("7ca3"));function l(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?l(Object(s),!0).forEach((function(t){(0,u.default)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var f={data:function(){return{statusBarHeight:0,students:[],leftList:[],selectedLeft:"",userInfo:null,classStatusMap:{},myClasses:[],showMyClasses:!1,teacherSubject:"",typeList:["班级","学生"],selectedType:"班级"}},computed:{filteredStudents:function(){var e=this;if("班级"===this.selectedType)return this.myClasses.map((function(e){return{_id:e._id,name:e.className,grade:e.grade,studentCount:e.classStudents.length,isClass:!0}}));var t=this.myClasses.find((function(t){return t.className===e.selectedLeft}));return t?t.classStudents.map((function(s){var n=null;return s.latestScore&&e.teacherSubject&&s.latestScore.subject===e.teacherSubject&&(n=s.latestScore),i(i({},s),{},{className:t.className,grade:s.grade,latestScore:n,isClass:!1})})):[]}},onLoad:function(){this.statusBarHeight=e.getSystemInfoSync().statusBarHeight,this.userInfo=e.getStorageSync("userInfo"),this.teacherSubject=this.userInfo.subject||this.userInfo.teacherSubject||"",this.loadMyClasses()},methods:{getScoreColor:function(e,t){if(!t||isNaN(t))return"score-default";var s=e.match(/(\d+)/);if(!s)return"score-default";var n=parseInt(s[1]);return n>=1&&n<=6?t>=95&&t<=100||t>=90&&t<=94?"score-green":t>=60&&t<=89?"score-yellow":"score-red":n>=7&&n<=9?t>=100&&t<=120||t>=90&&t<=99?"score-green":t>=72&&t<=89?"score-yellow":"score-red":"score-default"},goBack:function(){getCurrentPages().length>1?e.navigateBack():e.switchTab({url:"/pages/home/home"})},selectType:function(e){this.selectedType=e,this.updateLeftList()},selectLeft:function(e){this.selectedLeft=e,"学生"===this.selectedType&&this.$forceUpdate()},loadMyStudents:function(){var t=this;return(0,o.default)(r.default.mark((function s(){var a;return r.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.userInfo){s.next=3;break}return e.showToast({title:"请先登录",icon:"none"}),s.abrupt("return");case 3:return s.prev=3,e.showLoading({title:"加载中..."}),s.next=7,n.callFunction({name:"student-hours",data:{action:"getMyStudents",teacherId:t.userInfo._id||t.userInfo.uid}});case 7:a=s.sent,a.result.success?(t.students=a.result.data||[],t.updateLeftList()):e.showToast({title:a.result.message||"加载失败",icon:"none"}),s.next=15;break;case 11:s.prev=11,s.t0=s["catch"](3),console.error("加载我的学生失败:",s.t0),e.showToast({title:"加载失败，请重试",icon:"none"});case 15:return s.prev=15,e.hideLoading(),s.finish(15);case 18:case"end":return s.stop()}}),s,null,[[3,11,15,18]])})))()},loadMyClasses:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var s,a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.userInfo){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,console.log("用户信息:",e.userInfo),console.log("用户信息所有字段:",Object.keys(e.userInfo)),s=e.userInfo._id||e.userInfo.uid||e.userInfo.id||e.userInfo.teacherId,console.log("使用的teacherId:",s),t.next=9,n.callFunction({name:"class-management",data:{action:"getMyClasses",teacherId:s}});case 9:a=t.sent,0===a.result.code?(e.myClasses=a.result.data||[],console.log("加载的班级数据:",e.myClasses),e.updateLeftList()):console.log("加载班级失败:",a.result.message),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](2),console.error("加载我的班级失败:",t.t0);case 16:case"end":return t.stop()}}),t,null,[[2,13]])})))()},updateLeftList:function(){var e=this;if(this.leftList=[],this.classStatusMap={},this.selectedLeft="","班级"===this.selectedType)console.log("班级tab：左侧列表为空");else if("学生"===this.selectedType){var t=this.myClasses.map((function(e){return e.className}));this.leftList=(0,c.default)(new Set(t)),console.log("学生tab：更新左侧列表:",this.leftList),this.myClasses.forEach((function(t){e.classStatusMap[t.className]={total:t.classStudents.length,inRead:t.classStudents.length,isOver:!1,isMyClass:!0}})),this.leftList.length>0&&(this.selectedLeft=this.leftList[0]),console.log("学生tab：选中的班级:",this.selectedLeft)}},showStudentDetail:function(t){if(t.isClass){var s="班级名称：".concat(t.name,"\n年级：").concat(t.grade,"\n班级数量：").concat(t.studentCount,"个");e.showModal({title:"班级详情",content:s,showCancel:!1,confirmText:"确定"})}else{var n="姓名：".concat(t.name,"\n年级：").concat(t.grade,"\n学号：").concat(t.studentId).concat(t.latestScore?"\n最近成绩：".concat(t.latestScore.score,"分（").concat(t.latestScore.subject,"）\n考试日期：").concat(t.latestScore.examDate):"");e.showModal({title:"学生详情",content:n,showCancel:!1,confirmText:"确定"})}}}};t.default=f}).call(this,s("df3c")["default"],s("861b")["uniCloud"])},"4b0e":function(e,t,s){"use strict";s.r(t);var n=s("3a93"),a=s.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){s.d(t,e,(function(){return n[e]}))}(r);t["default"]=a.a},"6ad4":function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return a})),s.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,s=(e._self._c,e.leftList.length),n=e.filteredStudents.length,a=n>0?e.__map(e.filteredStudents,(function(t,s){var n=e.__get_orig(t),a=!t.isClass&&t.latestScore?e.getScoreColor(t.grade,t.latestScore.score):null;return{$orig:n,m0:a}})):null;e.$mp.data=Object.assign({},{$root:{g0:s,g1:n,l0:a}})},a=[]},"80b7":function(e,t,s){"use strict";s.r(t);var n=s("6ad4"),a=s("4b0e");for(var r in a)["default"].indexOf(r)<0&&function(e){s.d(t,e,(function(){return a[e]}))}(r);s("1680");var c=s("828b"),o=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,"90b3230a",null,!1,n["a"],void 0);t["default"]=o.exports},a4d9:function(e,t,s){},b1d3:function(e,t,s){"use strict";(function(e,t){var n=s("47a9");s("a226"),s("861b");n(s("3240"));var a=n(s("80b7"));e.__webpack_require_UNI_MP_PLUGIN__=s,t(a.default)}).call(this,s("3223")["default"],s("df3c")["createPage"])}},[["b1d3","common/runtime","common/vendor"]]]);