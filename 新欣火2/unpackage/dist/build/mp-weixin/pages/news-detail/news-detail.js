(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/news-detail/news-detail"],{"0df0":function(e,t,n){"use strict";n.r(t);var a=n("b6e4"),r=n("4e77");for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("9e11");var i=n("828b"),c=Object(i["a"])(r["default"],a["b"],a["c"],!1,null,"2ae471b1",null,!1,a["a"],void 0);t["default"]=c.exports},"1bed":function(e,t,n){},"4e77":function(e,t,n){"use strict";n.r(t);var a=n("78e9"),r=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=r.a},"78e9":function(e,t,n){"use strict";(function(e,a){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("7eb4")),i=r(n("7ca3")),c=r(n("ee10"));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={data:function(){return{statusBarHeight:0,newsId:"",newsData:null,loading:!0}},computed:{isAdmin:function(){var t=e.getStorageSync("userInfo");return t&&("管理员"===t.permission||"superadmin"===t.permission)}},onLoad:function(t){t.id?(this.newsId=t.id,this.loadNewsDetail()):(e.showToast({title:"缺少新闻ID",icon:"none"}),setTimeout((function(){return e.navigateBack()}),1500));var n=e.getSystemInfoSync();this.statusBarHeight=n.statusBarHeight||20;var a=e.getStorageSync("userInfo");a||console.log("用户未登录，跳转到登录页面")},methods:{goBack:function(){e.navigateBack()},loadNewsDetail:function(){var t=this;return(0,c.default)(o.default.mark((function n(){var r,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a.callFunction({name:"news-service",data:{action:"getNewsById",id:t.newsId}});case 3:if(r=n.sent,!(r&&r.result&&0===r.result.code&&r.result.data)){n.next=9;break}i=r.result.data,t.newsData={id:i._id||i.id,title:i.title,content:i.content,time:i.time,author:i.author,isPinned:i.isPinned||!1,contentBlocks:Array.isArray(i.contentBlocks)?i.contentBlocks:[{type:"text",content:i.content||""}]},n.next=11;break;case 9:return n.next=11,t.loadNewsFromStorage();case 11:n.next=17;break;case 13:n.prev=13,n.t0=n["catch"](0),console.error("加载新闻详情失败:",n.t0),e.showToast({title:"加载失败",icon:"none"});case 17:return n.prev=17,t.loading=!1,n.finish(17);case 20:case"end":return n.stop()}}),n,null,[[0,13,17,20]])})))()},loadNewsFromStorage:function(){var t=this;return(0,c.default)(o.default.mark((function n(){var a,r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.getStorageSync("newsList")||[],r=a.find((function(e){return e.id===t.newsId})),!r){n.next=6;break}t.newsData=u(u({},r),{},{isPinned:r.isPinned||!1,contentBlocks:r.contentBlocks||[{type:"text",content:r.content}]}),n.next=8;break;case 6:return n.next=8,t.loadMockNewsDetail();case 8:case"end":return n.stop()}}),n)})))()},loadMockNewsDetail:function(){var e=this;return(0,c.default)(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){return setTimeout(e,500)}));case 2:e.newsData={id:e.newsId,title:"公司荣获XX奖项11",content:"近日，公司在教育领域取得了重大突破，荣获XX奖项。这是对我们专注教育、点亮成长理念的肯定。我们将继续努力，为教育事业贡献更多力量。\n\n获奖项目包括：\n• 创新教学方法\n• 学生成长跟踪系统\n• 家长沟通平台\n\n感谢所有同事的辛勤付出，让我们一起为更美好的教育未来而努力！",time:"2024-06-01",author:"新欣火教育中心",images:[],contentBlocks:[{type:"text",content:"近日，公司在教育领域取得了重大突破，荣获XX奖项。这是对我们专注教育、点亮成长理念的肯定。我们将继续努力，为教育事业贡献更多力量。\n\n获奖项目包括：\n• 创新教学方法\n• 学生成长跟踪系统\n• 家长沟通平台\n\n感谢所有同事的辛勤付出，让我们一起为更美好的教育未来而努力！"},{type:"image",imageUrl:"/static/news/news1.jpg",caption:"图片1"},{type:"text",content:"这是我们的团队，他们为教育事业贡献了巨大的努力。"},{type:"image",imageUrl:"/static/news/news2.jpg",caption:"图片2"},{type:"text",content:"我们的愿景是成为教育领域的领导者，为每个孩子提供最好的教育。"}]};case 3:case"end":return t.stop()}}),t)})))()},formatTime:function(e){if(!e)return"";var t=new Date(e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r)},previewImage:function(t,n){if(t&&0!==t.length){var a=t.filter((function(e){return e&&e.trim()}));0!==a.length&&e.previewImage({urls:a,current:a[n]||a[0]})}},editNews:function(){e.navigateTo({url:"/pages/news-edit/news-edit?id=".concat(this.newsId)})},deleteNews:function(){var t=this;e.showModal({title:"确认删除",content:"确定要删除这条新闻吗？删除后无法恢复。",confirmText:"删除",confirmColor:"#ff4444",success:function(e){e.confirm&&t.performDelete()}})},performDelete:function(){var t=this;return(0,c.default)(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a.callFunction({name:"news-service",data:{action:"deleteNews",id:t.newsId}});case 3:e.$emit("newsUpdated"),e.showToast({title:"删除成功",icon:"success"}),setTimeout((function(){e.navigateBack()}),1500),n.next=12;break;case 8:n.prev=8,n.t0=n["catch"](0),console.error("删除新闻失败:",n.t0),e.showToast({title:"删除失败",icon:"none"});case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))()},togglePin:function(){var t=this;return(0,c.default)(o.default.mark((function n(){var r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a.callFunction({name:"news-service",data:{action:"togglePin",id:t.newsId}});case 3:r=n.sent,r&&r.result&&0===r.result.code?(t.newsData.isPinned=r.result.data.isPinned,e.$emit("newsUpdated"),e.showToast({title:r.result.message,icon:"success"})):e.showToast({title:"操作失败",icon:"none"}),n.next=11;break;case 7:n.prev=7,n.t0=n["catch"](0),console.error("置顶操作失败:",n.t0),e.showToast({title:"操作失败",icon:"none"});case 11:case"end":return n.stop()}}),n,null,[[0,7]])})))()}}};t.default=l}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},8600:function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("a226"),n("861b");a(n("3240"));var r=a(n("0df0"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"9e11":function(e,t,n){"use strict";var a=n("1bed"),r=n.n(a);r.a},b6e4:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.newsData?e.formatTime(e.newsData.time):null),a=e.newsData?e.newsData.contentBlocks&&e.newsData.contentBlocks.length>0:null,r=e.newsData?e.newsData.images&&e.newsData.images.length>0:null;e.$mp.data=Object.assign({},{$root:{m0:n,g0:a,g1:r}})},r=[]}},[["8600","common/runtime","common/vendor"]]]);