(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/exam-analysis/exam-analysis-list"],{"23c5":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.loading?null:e.analysisList.length),a=e.loading||0===n?null:e.__map(e.analysisList,(function(t,n){var a=e.__get_orig(t),s=e.formatTime(t.createTime),i=t.analysisText?t.analysisText.substring(0,50):null,o=t.analysisText?t.analysisText.length:null,l=t.examImages&&t.examImages.length>0,r=l?e.__map(t.examImages.slice(0,3),(function(n,a){var s=e.__get_orig(n),i=2===a&&t.examImages.length>3,o=i?t.examImages.length:null;return{$orig:s,g4:i,g5:o}})):null;return{$orig:a,m0:s,g1:i,g2:o,g3:l,l0:r}}));e.$mp.data=Object.assign({},{$root:{g0:n,l1:a}})},s=[]},4808:function(e,t,n){"use strict";n.r(t);var a=n("ee93"),s=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=s.a},5735:function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("a226"),n("861b");a(n("3240"));var s=a(n("99c4"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},7516:function(e,t,n){"use strict";var a=n("7f86"),s=n.n(a);s.a},"7f86":function(e,t,n){},"99c4":function(e,t,n){"use strict";n.r(t);var a=n("23c5"),s=n("4808");for(var i in s)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i);n("7516");var o=n("828b"),l=Object(o["a"])(s["default"],a["b"],a["c"],!1,null,"4de4aae2",null,!1,a["a"],void 0);t["default"]=l.exports},ee93:function(e,t,n){"use strict";(function(e,a){var s=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(n("7eb4")),o=s(n("ee10")),l={components:{ImageZoomViewer:function(){n.e("components/ImageZoomViewer").then(function(){return resolve(n("f9eb"))}.bind(null,n)).catch(n.oe)}},data:function(){return{yearList:[],yearIndex:0,selectedYear:"全部",monthList:["全部","1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthIndex:0,selectedMonth:"全部",examTypeList:["全部","期中","元调","二调","四调","中考","月考","期末"],examTypeIndex:0,selectedExamType:"全部",analysisList:[],loading:!1,currentPage:1,pageSize:10,total:0,totalPages:0,showImageZoom:!1,currentImages:[],currentImageIndex:0}},computed:{totalPages:function(){return Math.ceil(this.total/this.pageSize)}},onLoad:function(){var t=this,n=e.getStorageSync("userInfo");console.log("exam-analysis-list onLoad - userInfo:",n),this.initYearList(),this.$nextTick((function(){t.setDefaultFilters(),t.loadAnalysisList()}))},onPullDownRefresh:function(){this.loadAnalysisList()},methods:{initYearList:function(){this.yearList=["全部"];for(var e=(new Date).getFullYear(),t=e-5;t<=e+1;t++)this.yearList.push(t+"年")},setDefaultFilters:function(){this.$set(this,"selectedYear","全部"),this.$set(this,"yearIndex",0),this.$set(this,"selectedMonth","全部"),this.$set(this,"monthIndex",0),this.$set(this,"selectedExamType","全部"),this.$set(this,"examTypeIndex",0),console.log("setDefaultFilters - 设置完成:",{selectedYear:this.selectedYear,selectedMonth:this.selectedMonth,selectedExamType:this.selectedExamType,yearIndex:this.yearIndex,monthIndex:this.monthIndex,examTypeIndex:this.examTypeIndex})},onYearChange:function(e){this.yearIndex=e.detail.value,this.selectedYear=this.yearList[this.yearIndex],console.log("onYearChange - 选择年份:",{yearIndex:this.yearIndex,selectedYear:this.selectedYear}),this.currentPage=1,this.loadAnalysisList()},onMonthChange:function(e){this.monthIndex=e.detail.value,this.selectedMonth=this.monthList[this.monthIndex],console.log("onMonthChange - 选择月份:",{monthIndex:this.monthIndex,selectedMonth:this.selectedMonth}),this.currentPage=1,this.loadAnalysisList()},onExamTypeChange:function(e){this.examTypeIndex=e.detail.value,this.selectedExamType=this.examTypeList[this.examTypeIndex],console.log("onExamTypeChange - 选择考试类型:",{examTypeIndex:this.examTypeIndex,selectedExamType:this.selectedExamType}),this.currentPage=1,this.loadAnalysisList()},resetFilter:function(){this.selectedYear="全部",this.selectedMonth="全部",this.selectedExamType="全部",this.yearIndex=0,this.monthIndex=0,this.examTypeIndex=0,this.currentPage=1,this.loadAnalysisList()},searchAnalysis:function(){this.currentPage=1,this.loadAnalysisList()},loadAnalysisList:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var s,o,l;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.loading=!0,n.prev=1,s=e.getStorageSync("userInfo"),console.log("loadAnalysisList - userInfo:",s),s){n.next=7;break}return e.showToast({title:"请先登录",icon:"none"}),n.abrupt("return");case 7:return o={userId:s._id,userRole:s.role,page:t.currentPage,pageSize:t.pageSize},t.selectedYear&&"全部"!==t.selectedYear&&(o.year=t.selectedYear),t.selectedMonth&&"全部"!==t.selectedMonth&&(o.month=t.selectedMonth),t.selectedExamType&&"全部"!==t.selectedExamType&&(o.examType=t.selectedExamType),console.log("loadAnalysisList - 发送参数:",o),n.next=14,a.callFunction({name:"exam-analysis",data:{action:"getList",data:o}});case 14:l=n.sent,console.log("loadAnalysisList - 返回结果:",l),0===l.result.code?(t.analysisList=l.result.data.list,t.total=l.result.data.total,console.log("loadAnalysisList - 设置数据:",{list:t.analysisList.length,total:t.total})):(console.error("loadAnalysisList - 返回错误:",l.result),e.showToast({title:l.result.message||"加载失败",icon:"none"})),n.next=23;break;case 19:n.prev=19,n.t0=n["catch"](1),console.error("加载失败:",n.t0),e.showToast({title:"加载失败，请重试",icon:"none"});case 23:return n.prev=23,t.loading=!1,e.stopPullDownRefresh(),n.finish(23);case 27:case"end":return n.stop()}}),n,null,[[1,19,23,27]])})))()},viewDetail:function(t){e.navigateTo({url:"/pages/exam-analysis/exam-analysis-detail?id=".concat(t._id)})},editAnalysis:function(t){e.navigateTo({url:"/pages/exam-analysis/exam-analysis?id=".concat(t._id)})},deleteAnalysis:function(t){var n=this;e.showModal({title:"确认删除",content:"确定要删除这条试卷分析吗？",success:function(){var s=(0,o.default)(i.default.mark((function s(o){var l,r;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!o.confirm){s.next=13;break}return s.prev=1,l=e.getStorageSync("userInfo"),s.next=5,a.callFunction({name:"exam-analysis",data:{action:"delete",data:{id:t._id,userId:l._id,userRole:l.role}}});case 5:r=s.sent,0===r.result.code?(e.showToast({title:"删除成功",icon:"success"}),n.loadAnalysisList()):e.showToast({title:r.result.message||"删除失败",icon:"none"}),s.next=13;break;case 9:s.prev=9,s.t0=s["catch"](1),console.error("删除失败:",s.t0),e.showToast({title:"删除失败，请重试",icon:"none"});case 13:case"end":return s.stop()}}),s,null,[[1,9]])})));return function(e){return s.apply(this,arguments)}}()})},addAnalysis:function(){e.navigateTo({url:"/pages/exam-analysis/exam-analysis"})},changePage:function(e){this.currentPage=e,this.loadAnalysisList()},formatTime:function(e){if(!e)return"";var t=new Date(e);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")," ").concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"))},goBack:function(){e.navigateBack()},viewStudentDetail:function(t){t.studentId?e.navigateTo({url:"/pages/student-hours-detail/student-hours-detail?id=".concat(t.studentId)}):e.showToast({title:"学生信息不完整",icon:"none"})},viewUserDetail:function(t){t.userId?e.showToast({title:"用户详情功能开发中",icon:"none"}):e.showToast({title:"用户信息不完整",icon:"none"})},openImageZoom:function(t,n){t&&0!==t.length?(this.currentImages=t,this.currentImageIndex=n,this.showImageZoom=!0):e.showToast({title:"没有图片可预览",icon:"none"})},closeImageZoom:function(){this.showImageZoom=!1,this.currentImages=[],this.currentImageIndex=0},switchImage:function(e){this.currentImageIndex=e}}};t.default=l}).call(this,n("df3c")["default"],n("861b")["uniCloud"])}},[["5735","common/runtime","common/vendor"]]]);