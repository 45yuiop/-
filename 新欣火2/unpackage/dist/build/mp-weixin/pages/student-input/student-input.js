(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/student-input/student-input"],{"2c84":function(t,e,a){"use strict";(function(t,e){var s=a("47a9");a("a226"),a("861b");s(a("3240"));var n=s(a("c1f6"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(n.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"488a":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var s=function(){var t=this,e=t.$createElement,a=(t._self._c,t.formData.subjects.length),s=t.formData.classes.length,n=t.formData.name&&t.formData.grade?t.formData.subjects.join("、")||"未选择":null,r=t.formData.name&&t.formData.grade?t.formData.classes.length:null,o=t.formData.name&&t.formData.grade&&r>0?t.formData.classes.map((function(t){return t.className})).join("、"):null,c=t.isBatchMode?t.batchStudents.length:null,i=t.isBatchMode?t.batchStudents.length:null,u=t.isBatchMode?t.batchStudents.length:null,l=t.isBatchMode?t.batchStudents.length:null,d=t.isBatchMode?t.batchStudents.length:null,f=t.showSubjectModalFlag?t.__map(t.allSubjects,(function(e,a){var s=t.__get_orig(e),n=t.formData.subjects.includes(e),r=t.formData.subjects.includes(e);return{$orig:s,g10:n,g11:r}})):null,h=t.showClassModalFlag?t.__map(t.filteredClassList,(function(e,a){var s=t.__get_orig(e),n=t.isClassSelected(e),r=t.isClassSelected(e);return{$orig:s,m0:n,m1:r}})):null,m=t.showClassModalFlag?0===t.filteredClassList.length&&t.classSearchKeyword:null;t._isMounted||(t.e0=function(e,a){var s=[],n=arguments.length-2;while(n-- >0)s[n]=arguments[n+2];var r=s[s.length-1].currentTarget.dataset,o=r.eventParams||r["event-params"];a=o.index;return t.onScoreSubjectChange(a,e.detail.value)}),t.$mp.data=Object.assign({},{$root:{g0:a,g1:s,g2:n,g3:r,g4:o,g5:c,g6:i,g7:u,g8:l,g9:d,l0:f,l1:h,g12:m}})},n=[]},"6674b":function(t,e,a){"use strict";(function(t,s){var n=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(a("7eb4")),o=n(a("ee10")),c=n(a("af34")),i={data:function(){return{formData:{name:"",grade:"",subjects:[],classes:[],school:"",scores:[]},gradeIndex:0,gradeOptions:["一年级","二年级","三年级","四年级","五年级","六年级","七年级","八年级","九年级","高一","高二","高三"],allSubjects:["语文","数学","英语","物理","化学"],showSubjectModalFlag:!1,showClassModalFlag:!1,classList:[],filteredClassList:[],classSearchKeyword:"",isBatchMode:!1,batchStudents:[],isLoading:!1}},onLoad:function(){this.loadClassList()},computed:{generatedStudentId:function(){if(!this.formData.name||!this.formData.grade)return"";var t=this.getGradeCode(this.formData.grade),e=this.getNameCode(this.formData.name),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return"".concat(t).concat(e).concat(a)},canSubmit:function(){return this.formData.name.trim()&&this.formData.grade&&this.formData.subjects.length>0&&!this.isLoading}},methods:{goBack:function(){t.navigateBack()},onGradeChange:function(t){this.gradeIndex=t.detail.value,this.formData.grade=this.gradeOptions[t.detail.value],this.formData.classes=[],this.filterClassesByGrade()},showSubjectModal:function(){this.showSubjectModalFlag=!0},closeSubjectModal:function(){this.showSubjectModalFlag=!1},toggleSubject:function(t){var e=this.formData.subjects.indexOf(t);e>-1?this.formData.subjects.splice(e,1):this.formData.subjects.push(t)},removeSubject:function(t){this.formData.subjects.splice(t,1),this.formData.classes=[],this.filterClasses()},confirmSubjects:function(){this.showSubjectModalFlag=!1,this.formData.classes=[],this.filterClasses()},showClassModal:function(){this.showClassModalFlag=!0,this.classSearchKeyword="",this.filterClasses()},closeClassModal:function(){this.showClassModalFlag=!1,this.classSearchKeyword=""},filterClasses:function(){var t=this,e=(0,c.default)(this.classList);if(this.formData.grade&&(e=e.filter((function(e){return e.grade===t.formData.grade}))),this.formData.subjects&&this.formData.subjects.length>0&&(e=e.filter((function(e){var a=(e.className||"").toLowerCase();return t.formData.subjects.some((function(t){return a.includes(t.toLowerCase())}))}))),this.classSearchKeyword.trim()){var a=this.classSearchKeyword.toLowerCase().trim();e=e.filter((function(t){var e=(t.className||"").toLowerCase(),s=(t.grade||"").toLowerCase();return e.includes(a)||s.includes(a)}))}this.filteredClassList=e},filterClassesByGrade:function(){this.filterClasses()},toggleClass:function(t){var e=this.formData.classes.findIndex((function(e){return e._id===t._id}));e>-1?this.formData.classes.splice(e,1):this.formData.classes.push(t)},removeClass:function(t){this.formData.classes.splice(t,1)},confirmClasses:function(){this.showClassModalFlag=!1},isClassSelected:function(t){return this.formData.classes.some((function(e){return e._id===t._id}))},loadClassList:function(){var t=this;return(0,o.default)(r.default.mark((function e(){var a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.callFunction({name:"class-management",data:{action:"getClasses",page:1,pageSize:1e3}});case 3:a=e.sent,0===a.result.code?(t.classList=a.result.data,console.log("班级列表加载成功，数量:",t.classList.length),console.log("班级列表数据:",t.classList),t.filterClasses()):console.error("加载班级列表失败:",a.result.message),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("加载班级列表失败:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getGradeCode:function(t){return{"一年级":"01","二年级":"02","三年级":"03","四年级":"04","五年级":"05","六年级":"06","七年级":"07","八年级":"08","九年级":"09","高一":"10","高二":"11","高三":"12"}[t]||"00"},getNameCode:function(t){for(var e={a:"A",b:"B",c:"C",d:"D",e:"E",f:"F",g:"G",h:"H",i:"I",j:"J",k:"K",l:"L",m:"M",n:"N",o:"O",p:"P",q:"Q",r:"R",s:"S",t:"T",u:"U",v:"V",w:"W",x:"X",y:"Y",z:"Z"},a="",s=0;s<Math.min(t.length,2);s++){var n=t[s].toLowerCase();a+=e[n]?e[n]:String.fromCharCode(65+n.charCodeAt(0)%26)}return a.padEnd(2,"X")},toggleBatchMode:function(){this.isBatchMode=!this.isBatchMode,this.isBatchMode||this.resetForm()},resetForm:function(){this.formData={name:"",grade:"",subjects:[],classes:[],school:"",scores:[]},this.gradeIndex=0},submitStudent:function(){var e=this;return(0,o.default)(r.default.mark((function a(){var s;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.canSubmit){a.next=2;break}return a.abrupt("return");case 2:if(e.isLoading=!0,a.prev=3,s={name:e.formData.name.trim(),grade:e.formData.grade,subjects:e.formData.subjects,classes:e.formData.classes,classIds:e.formData.classes.map((function(t){return t._id})),school:e.formData.school.trim(),scores:e.formData.scores.filter((function(t){return t.subject&&t.score})),studentId:e.generatedStudentId,createTime:(new Date).toISOString()},!e.isBatchMode){a.next=11;break}e.batchStudents.push(s),t.showToast({title:"已添加到批量列表",icon:"success"}),e.resetForm(),a.next=16;break;case 11:return a.next=13,e.saveStudent(s);case 13:t.showToast({title:"录入成功",icon:"success"}),e.resetForm(),e.updateArchiveCache();case 16:a.next=22;break;case 18:a.prev=18,a.t0=a["catch"](3),console.error("提交失败:",a.t0),t.showToast({title:"录入失败，请重试",icon:"error"});case 22:return a.prev=22,e.isLoading=!1,a.finish(22);case 25:case"end":return a.stop()}}),a,null,[[3,18,22,25]])})))()},addScore:function(){this.formData.scores.push({subject:"",subjectIndex:0,score:""})},removeScore:function(t){this.formData.scores.splice(t,1)},onScoreSubjectChange:function(t,e){this.formData.scores[t].subjectIndex=e,this.formData.scores[t].subject=this.allSubjects[e]},saveStudent:function(t){return(0,o.default)(r.default.mark((function e(){var a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.callFunction({name:"student-manager",data:{action:"addStudent",studentData:t}});case 2:if(a=e.sent,0===a.result.code){e.next=5;break}throw new Error(a.result.message||"保存失败");case 5:return e.abrupt("return",a.result);case 6:case"end":return e.stop()}}),e)})))()},updateArchiveCache:function(){try{var t=getApp();t.globalData&&t.globalData.updateArchiveCache?(t.globalData.updateArchiveCache(),console.log("已通知档案管理页面更新缓存")):console.log("档案管理页面未加载，无法更新缓存")}catch(e){console.error("更新档案管理缓存失败:",e)}},editBatchStudent:function(t){var e=this.batchStudents[t];this.formData={name:e.name,grade:e.grade,subjects:(0,c.default)(e.subjects),classes:(0,c.default)(e.classes||[]),school:e.school},this.gradeIndex=this.gradeOptions.indexOf(e.grade),this.isBatchMode=!1},removeBatchStudent:function(e){var a=this;t.showModal({title:"确认删除",content:"确定要删除学生 ".concat(this.batchStudents[e].name," 吗？"),success:function(s){s.confirm&&(a.batchStudents.splice(e,1),t.showToast({title:"已删除",icon:"success"}))}})},clearBatch:function(){var e=this;t.showModal({title:"确认清空",content:"确定要清空所有学生信息吗？",success:function(a){a.confirm&&(e.batchStudents=[],t.showToast({title:"已清空",icon:"success"}))}})},submitBatch:function(){var e=this;return(0,o.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(0!==e.batchStudents.length){a.next=2;break}return a.abrupt("return");case 2:return e.isLoading=!0,a.prev=3,a.next=6,s.callFunction({name:"student-manager",data:{action:"addBatchStudents",studentsData:e.batchStudents}});case 6:if(n=a.sent,0!==n.result.code){a.next=14;break}t.showToast({title:"成功录入 ".concat(e.batchStudents.length," 名学生"),icon:"success"}),e.batchStudents=[],e.isBatchMode=!1,e.updateArchiveCache(),a.next=15;break;case 14:throw new Error(n.result.message||"批量录入失败");case 15:a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](3),console.error("批量提交失败:",a.t0),t.showToast({title:"批量录入失败，请重试",icon:"error"});case 21:return a.prev=21,e.isLoading=!1,a.finish(21);case 24:case"end":return a.stop()}}),a,null,[[3,17,21,24]])})))()}}};e.default=i}).call(this,a("df3c")["default"],a("861b")["uniCloud"])},"6c52":function(t,e,a){"use strict";a.r(e);var s=a("6674b"),n=a.n(s);for(var r in s)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return s[t]}))}(r);e["default"]=n.a},b149:function(t,e,a){},b364:function(t,e,a){"use strict";var s=a("b149"),n=a.n(s);n.a},c1f6:function(t,e,a){"use strict";a.r(e);var s=a("488a"),n=a("6c52");for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);a("b364");var o=a("828b"),c=Object(o["a"])(n["default"],s["b"],s["c"],!1,null,"6962f6f4",null,!1,s["a"],void 0);e["default"]=c.exports}},[["2c84","common/runtime","common/vendor"]]]);