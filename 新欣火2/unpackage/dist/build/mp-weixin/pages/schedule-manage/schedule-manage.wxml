<view class="page-container"><block wx:if="{{!isTeacher}}"><view class="form-item"><picker value="{{userIndex}}" range="{{filteredUserList}}" range-key="displayName" data-event-opts="{{[['change',[['onUserChange',['$event']]]]]}}" bindchange="__e"><view class="picker"><text>{{$root.g0>0?filteredUserList[userIndex].displayName:'无匹配用户'}}</text><text class="picker-arrow">▼</text></view></picker><input class="search-input" placeholder="🔍 搜索教师姓名" data-event-opts="{{[['input',[['__set_model',['','searchKeyword','$event',['trim']]]]],['blur',[['$forceUpdate']]]]}}" value="{{searchKeyword}}" bindinput="__e" bindblur="__e"/></view></block><view class="date-selector"><view data-event-opts="{{[['tap',[['changeDay',[-1]]]]]}}" class="nav-arrow" bindtap="__e"><text>‹</text></view><view data-event-opts="{{[['tap',[['toggleMultiDateMode',['$event']]]]]}}" class="date-display-wrapper" bindtap="__e"><text class="date-text">{{isMultiDateMode?'已选择'+$root.g1+'个日期':dayDisplay}}</text><text class="multi-date-hint">{{isMultiDateMode?'点击切换':'点击多选'}}</text></view><view data-event-opts="{{[['tap',[['changeDay',[1]]]]]}}" class="nav-arrow" bindtap="__e"><text>›</text></view></view><block wx:if="{{isMultiDateMode}}"><view class="multi-date-selector"><view class="multi-date-header"><text class="multi-date-title">选择要排课的日期：</text><view class="multi-date-actions"><view data-event-opts="{{[['tap',[['selectAllWeekdays',['$event']]]]]}}" class="action-btn" bindtap="__e">选择工作日</view><view data-event-opts="{{[['tap',[['clearSelectedDates',['$event']]]]]}}" class="action-btn" bindtap="__e">清空选择</view></view></view><view class="week-navigation"><view data-event-opts="{{[['tap',[['changeWeek',[-1]]]]]}}" class="week-nav-btn" bindtap="__e"><text class="week-nav-icon">‹</text><text class="week-nav-text">上一周</text></view><view data-event-opts="{{[['tap',[['showWeekPicker',['$event']]]]]}}" class="week-display" bindtap="__e"><text class="week-text">{{$root.m0}}</text><text class="week-picker-hint">点击选择周</text></view><view data-event-opts="{{[['tap',[['changeWeek',[1]]]]]}}" class="week-nav-btn" bindtap="__e"><text class="week-nav-text">下一周</text><text class="week-nav-icon">›</text></view></view><scroll-view class="date-scroll-container" scroll-x="{{true}}" scroll-left="{{scrollLeft}}" data-event-opts="{{[['scroll',[['onDateScroll',['$event']]]]]}}" bindscroll="__e"><view class="date-scroll-content"><block wx:for="{{$root.l0}}" wx:for-item="date" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({date:date.$orig})}}" class="{{['date-item',(date.m1)?'selected':'',(date.m2)?'month-start':'',(date.m3)?'different-month':'']}}" bindtap="__e"><text class="date-text">{{date.m4}}</text><text class="weekday-text">{{date.m5}}</text><block wx:if="{{date.m6}}"><text class="month-label">{{date.m7}}</text></block></view></block></view></scroll-view></view></block><block wx:if="{{showWeekPickerModal}}"><view data-event-opts="{{[['tap',[['hideWeekPicker',['$event']]]]]}}" class="week-picker-modal" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="week-picker-content" catchtap="__e"><view class="week-picker-header"><text class="week-picker-title">选择周</text><view data-event-opts="{{[['tap',[['hideWeekPicker',['$event']]]]]}}" class="close-btn" bindtap="__e"><text class="close-icon">×</text></view></view><scroll-view class="week-picker-list" scroll-y="{{true}}"><block wx:for="{{$root.l1}}" wx:for-item="week" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" data-event-params="{{({week})}}" class="{{['week-option',(week.weekOffset===weekOffset)?'selected':'']}}" bindtap="__e"><text class="week-option-text">{{week.label}}</text><block wx:if="{{week.weekOffset===weekOffset}}"><text class="check-icon">✓</text></block></view></block></scroll-view></view></view></block><scroll-view class="schedule-scroll-view" scroll-y="{{true}}"><block wx:if="{{isLoading}}"><view class="loading-container"><view class="loading-text">课表加载中...</view></view></block><block wx:else><block wx:if="{{!daySchedule}}"><view class="empty-state"><view class="empty-text">今天没有课程安排<view class="date-in-empty">{{dayDisplay}}</view></view></view></block><block wx:else><view class="week-schedule-container"><view class="day-card"><view class="schedule-grid"><block wx:for="{{$root.l2}}" wx:for-item="slot" wx:for-index="__i0__" wx:key="$orig"><view class="schedule-row"><view class="lesson-header"><view class="session-label">{{"第"+slot.$orig+"节课"}}</view><view class="time-label">{{slot.m8}}</view></view><view class="course-cell"><view class="course-row"><input class="course-input" type="text" placeholder="课程名称" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.courses']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.courses[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/><picker class="type-picker" value="{{slot.m9}}" range="{{courseTypes}}" data-event-opts="{{[['change',[['onTypeChange',[slot.$orig-1,'$event']]]]]}}" bindchange="__e"><view class="type-display"><text>{{slot.m10}}</text><text class="type-arrow">▼</text></view></picker><input class="location-input" type="text" placeholder="地点" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.locations']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.locations[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/><input class="class-input" type="text" placeholder="班级" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.classes']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.classes[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/></view><input class="remark-input" type="text" placeholder="备注（可选）" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.remarks']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.remarks[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/></view></view></block></view></view></view></block></block></scroll-view><view class="bottom-actions-fixed"><view class="day-navigator"><view data-event-opts="{{[['tap',[['saveSchedule',['$event']]]]]}}" class="nav-btn save-btn" bindtap="__e">💾 保存排课</view><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="nav-btn return-btn" bindtap="__e">返回首页</view></view></view></view>