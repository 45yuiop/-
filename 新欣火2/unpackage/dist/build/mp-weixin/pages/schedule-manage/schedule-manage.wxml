<view class="page-container"><block wx:if="{{!isTeacher}}"><view class="form-item"><picker value="{{userIndex}}" range="{{filteredUserList}}" range-key="displayName" data-event-opts="{{[['change',[['onUserChange',['$event']]]]]}}" bindchange="__e"><view class="picker"><text>{{$root.g0>0?filteredUserList[userIndex].displayName:'æ— åŒ¹é…ç”¨æˆ·'}}</text><text class="picker-arrow">â–¼</text></view></picker><input class="search-input" placeholder="ğŸ” æœç´¢æ•™å¸ˆå§“å" data-event-opts="{{[['input',[['__set_model',['','searchKeyword','$event',['trim']]]]],['blur',[['$forceUpdate']]]]}}" value="{{searchKeyword}}" bindinput="__e" bindblur="__e"/></view></block><view class="date-selector"><view data-event-opts="{{[['tap',[['changeDay',[-1]]]]]}}" class="nav-arrow" bindtap="__e"><text>â€¹</text></view><view data-event-opts="{{[['tap',[['toggleMultiDateMode',['$event']]]]]}}" class="date-display-wrapper" bindtap="__e"><text class="date-text">{{isMultiDateMode?'å·²é€‰æ‹©'+$root.g1+'ä¸ªæ—¥æœŸ':dayDisplay}}</text><text class="multi-date-hint">{{isMultiDateMode?'ç‚¹å‡»åˆ‡æ¢':'ç‚¹å‡»å¤šé€‰'}}</text></view><view data-event-opts="{{[['tap',[['changeDay',[1]]]]]}}" class="nav-arrow" bindtap="__e"><text>â€º</text></view></view><block wx:if="{{isMultiDateMode}}"><view class="multi-date-selector"><view class="multi-date-header"><text class="multi-date-title">é€‰æ‹©è¦æ’è¯¾çš„æ—¥æœŸï¼š</text><view class="multi-date-actions"><view data-event-opts="{{[['tap',[['selectAllWeekdays',['$event']]]]]}}" class="action-btn" bindtap="__e">é€‰æ‹©å·¥ä½œæ—¥</view><view data-event-opts="{{[['tap',[['clearSelectedDates',['$event']]]]]}}" class="action-btn" bindtap="__e">æ¸…ç©ºé€‰æ‹©</view></view></view><view class="week-navigation"><view data-event-opts="{{[['tap',[['changeWeek',[-1]]]]]}}" class="week-nav-btn" bindtap="__e"><text class="week-nav-icon">â€¹</text><text class="week-nav-text">ä¸Šä¸€å‘¨</text></view><view data-event-opts="{{[['tap',[['showWeekPicker',['$event']]]]]}}" class="week-display" bindtap="__e"><text class="week-text">{{$root.m0}}</text><text class="week-picker-hint">ç‚¹å‡»é€‰æ‹©å‘¨</text></view><view data-event-opts="{{[['tap',[['changeWeek',[1]]]]]}}" class="week-nav-btn" bindtap="__e"><text class="week-nav-text">ä¸‹ä¸€å‘¨</text><text class="week-nav-icon">â€º</text></view></view><scroll-view class="date-scroll-container" scroll-x="{{true}}" scroll-left="{{scrollLeft}}" data-event-opts="{{[['scroll',[['onDateScroll',['$event']]]]]}}" bindscroll="__e"><view class="date-scroll-content"><block wx:for="{{$root.l0}}" wx:for-item="date" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({date:date.$orig})}}" class="{{['date-item',(date.m1)?'selected':'',(date.m2)?'month-start':'',(date.m3)?'different-month':'']}}" bindtap="__e"><text class="date-text">{{date.m4}}</text><text class="weekday-text">{{date.m5}}</text><block wx:if="{{date.m6}}"><text class="month-label">{{date.m7}}</text></block></view></block></view></scroll-view></view></block><block wx:if="{{showWeekPickerModal}}"><view data-event-opts="{{[['tap',[['hideWeekPicker',['$event']]]]]}}" class="week-picker-modal" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="week-picker-content" catchtap="__e"><view class="week-picker-header"><text class="week-picker-title">é€‰æ‹©å‘¨</text><view data-event-opts="{{[['tap',[['hideWeekPicker',['$event']]]]]}}" class="close-btn" bindtap="__e"><text class="close-icon">Ã—</text></view></view><scroll-view class="week-picker-list" scroll-y="{{true}}"><block wx:for="{{$root.l1}}" wx:for-item="week" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" data-event-params="{{({week})}}" class="{{['week-option',(week.weekOffset===weekOffset)?'selected':'']}}" bindtap="__e"><text class="week-option-text">{{week.label}}</text><block wx:if="{{week.weekOffset===weekOffset}}"><text class="check-icon">âœ“</text></block></view></block></scroll-view></view></view></block><scroll-view class="schedule-scroll-view" scroll-y="{{true}}"><block wx:if="{{isLoading}}"><view class="loading-container"><view class="loading-text">è¯¾è¡¨åŠ è½½ä¸­...</view></view></block><block wx:else><block wx:if="{{!daySchedule}}"><view class="empty-state"><view class="empty-text">ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’<view class="date-in-empty">{{dayDisplay}}</view></view></view></block><block wx:else><view class="week-schedule-container"><view class="day-card"><view class="schedule-grid"><block wx:for="{{$root.l2}}" wx:for-item="slot" wx:for-index="__i0__" wx:key="$orig"><view class="schedule-row"><view class="lesson-header"><view class="session-label">{{"ç¬¬"+slot.$orig+"èŠ‚è¯¾"}}</view><view class="time-label">{{slot.m8}}</view></view><view class="course-cell"><view class="course-row"><input class="course-input" type="text" placeholder="è¯¾ç¨‹åç§°" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.courses']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.courses[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/><picker class="type-picker" value="{{slot.m9}}" range="{{courseTypes}}" data-event-opts="{{[['change',[['onTypeChange',[slot.$orig-1,'$event']]]]]}}" bindchange="__e"><view class="type-display"><text>{{slot.m10}}</text><text class="type-arrow">â–¼</text></view></picker><input class="location-input" type="text" placeholder="åœ°ç‚¹" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.locations']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.locations[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/><input class="class-input" type="text" placeholder="ç­çº§" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.classes']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.classes[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/></view><input class="remark-input" type="text" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" disabled="{{false}}" readonly="{{false}}" data-event-opts="{{[['focus',[['onInputFocus',['$event']]]],['input',[['__set_model',['$0',slot.$orig-1,'$event',[]],['daySchedule.remarks']],['onInputChange',['$event']]]]]}}" value="{{daySchedule.remarks[slot.$orig-1]}}" bindfocus="__e" bindinput="__e"/></view></view></block></view></view></view></block></block></scroll-view><view class="bottom-actions-fixed"><view class="day-navigator"><view data-event-opts="{{[['tap',[['saveSchedule',['$event']]]]]}}" class="nav-btn save-btn" bindtap="__e">ğŸ’¾ ä¿å­˜æ’è¯¾</view><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="nav-btn return-btn" bindtap="__e">è¿”å›é¦–é¡µ</view></view></view></view>