(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/salary-statistics/salary-statistics"],{"0379":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var s=function(){var t=this.$createElement,e=(this._self._c,(this.isAdmin||this.isSuperAdmin)&&this.allStatistics&&this.allStatistics.length);this.$mp.data=Object.assign({},{$root:{g0:e}})},a=[]},1111:function(t,e,i){"use strict";(function(t,s){var a=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("34cf")),c={data:function(){return{allTeacherList:[],teacherIndex:0,searchKeyword:"",selectedMonth:(new Date).toISOString().slice(0,7),isLoading:!1,statistics:null,noData:!1,isLoadingAll:!1,allStatistics:null,isSuperAdmin:!1,isAdmin:!1}},computed:{filteredTeacherList:function(){var t=this;return this.searchKeyword?this.allTeacherList.filter((function(e){return e.teacherName&&e.teacherName.toLowerCase().includes(t.searchKeyword.toLowerCase())})):this.allTeacherList},selectedTeacher:function(){return this.filteredTeacherList.length>0?this.filteredTeacherList[this.teacherIndex]:null}},watch:{searchKeyword:function(){this.teacherIndex=0}},onLoad:function(){this.fetchTeachers()},onShow:function(){this.checkAdminRole()},methods:{checkAdminRole:function(){var e=t.getStorageSync("userInfo");this.isSuperAdmin=e&&"superadmin"===e.permission;var i=e&&"管理员"===e.permission,s=e&&e.role&&(e.role.includes("管理员")||"管理员"===e.role);if(this.isAdmin=i||s||this.isSuperAdmin,!this.isAdmin&&!this.isSuperAdmin){var a=this.allTeacherList.find((function(t){return t._id===e._id}));a&&(this.selectedTeacher=a,this.teacherIndex=this.filteredTeacherList.findIndex((function(t){return t._id===a._id})))}},fetchTeachers:function(){var e=this;s.callFunction({name:"user-center",data:{action:"get-accounts"},success:function(i){var s=i.result;200===s.code?(e.allTeacherList=s.data.filter((function(t){return!!t.role&&(Array.isArray(t.role)?t.role.includes("教师"):"教师"===t.role)})),e.checkAdminRole()):t.showToast({title:"获取教师列表失败",icon:"none"})},fail:function(){t.showToast({title:"获取教师列表请求失败",icon:"none"})}})},onTeacherChange:function(t){(this.isAdmin||this.isSuperAdmin)&&(this.teacherIndex=t.detail.value,this.selectedTeacher=this.filteredTeacherList[this.teacherIndex])},onMonthChange:function(t){this.selectedMonth=t.detail.value},fetchAndCalculateStatistics:function(){var e=this;if(this.selectedTeacher&&this.selectedTeacher._id){this.isLoading=!0,this.statistics=null,this.noData=!1;var i=this.selectedMonth.split("-").map(Number),a=(0,n.default)(i,2),c=a[0],r=a[1],o="".concat(this.selectedMonth,"-01"),l=new Date(c,r,0).toISOString().slice(0,10);s.callFunction({name:"teacher-hours-statistics",data:{action:"get-teacher-hours",params:{teacher_id:this.selectedTeacher._id,startDate:o,endDate:l}},success:function(i){var s=i.result;if(200===s.code&&s.data){e.statistics=s.data.statistics;var a=Object.values(s.data.statistics).some((function(t){return t>0}));a||(e.noData=!0)}else e.noData=!0,e.statistics={"一对一":0,"班课":0,"脱产生":0},t.showToast({title:s.message||"查询失败",icon:"none"})},fail:function(i){console.error("查询课时失败:",i),t.showToast({title:"查询课时失败",icon:"none"}),e.noData=!0,e.statistics={"一对一":0,"班课":0,"脱产生":0}},complete:function(){e.isLoading=!1}})}else t.showToast({title:"请先选择一位教师",icon:"none"})},goBack:function(){t.navigateBack()},fetchAllTeachersStatistics:function(){var e=this;this.isLoadingAll=!0,this.allStatistics=null,this.noData=!1;var i=this.selectedMonth.split("-").map(Number),a=(0,n.default)(i,2),c=a[0],r=a[1],o="".concat(this.selectedMonth,"-01"),l=new Date(c,r,0).toISOString().slice(0,10);s.callFunction({name:"teacher-hours-statistics",data:{action:"get-all-teachers-hours",params:{startDate:o,endDate:l}},success:function(i){var s=i.result;if(console.log("全员课时统计结果:",s),200===s.code&&s.data){var a=s.data.map((function(t){return{username:t.username,teacherName:t.teacherName||t.username,"一对一":t.statistics["一对一"]||0,"班课":t.statistics["班课"]||0,"脱产生":t.statistics["脱产生"]||0}}));e.allStatistics=a;var n=a.some((function(t){return t["一对一"]>0||t["班课"]>0||t["脱产生"]>0}));n||t.showToast({title:"暂无教师有课时记录",icon:"none"})}else e.allStatistics=[],t.showToast({title:s.message||"查询失败",icon:"none"})},fail:function(i){console.error("查询全员课时失败:",i),t.showToast({title:"查询全员课时失败",icon:"none"}),e.allStatistics=[]},complete:function(){e.isLoadingAll=!1}})},getCourseDuration:function(t){switch(t){case"一对一":return 2;case"班课":return 2;case"脱产生":return 2;default:return 2}}}};e.default=c}).call(this,i("df3c")["default"],i("861b")["uniCloud"])},"491e":function(t,e,i){},5809:function(t,e,i){"use strict";(function(t,e){var s=i("47a9");i("a226"),i("861b");s(i("3240"));var a=s(i("61ce"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"61ce":function(t,e,i){"use strict";i.r(e);var s=i("0379"),a=i("9b49");for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);i("ca60");var c=i("828b"),r=Object(c["a"])(a["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);e["default"]=r.exports},"9b49":function(t,e,i){"use strict";i.r(e);var s=i("1111"),a=i.n(s);for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e["default"]=a.a},ca60:function(t,e,i){"use strict";var s=i("491e"),a=i.n(s);a.a}},[["5809","common/runtime","common/vendor"]]]);