<view class="container data-v-0cccd6b3"><view class="page-header animated-card data-v-0cccd6b3"><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="back-button data-v-0cccd6b3" bindtap="__e"><text class="back-icon data-v-0cccd6b3">←</text></view><text class="page-title data-v-0cccd6b3">班级管理</text></view><view class="search-filter-section animated-card data-v-0cccd6b3"><view class="search-container data-v-0cccd6b3"><input class="search-input data-v-0cccd6b3" placeholder="🔍 搜索班级名称" data-event-opts="{{[['input',[['__set_model',['','searchKeyword','$event',[]]],['onSearchInput',['$event']]]]]}}" value="{{searchKeyword}}" bindinput="__e"/><text class="search-icon data-v-0cccd6b3">🔍</text></view><view class="filter-container data-v-0cccd6b3"><view class="filter-group data-v-0cccd6b3"><text class="filter-label data-v-0cccd6b3">年级：</text><picker class="filter-picker data-v-0cccd6b3" value="{{gradeIndex}}" range="{{gradeOptions}}" data-event-opts="{{[['change',[['onGradeChange',['$event']]]]]}}" bindchange="__e"><view class="picker-display data-v-0cccd6b3"><text class="picker-text data-v-0cccd6b3">{{gradeOptions[gradeIndex]}}</text><text class="picker-arrow data-v-0cccd6b3">▼</text></view></picker></view><view class="filter-group data-v-0cccd6b3"><text class="filter-label data-v-0cccd6b3">科目：</text><picker class="filter-picker data-v-0cccd6b3" value="{{subjectIndex}}" range="{{subjectOptions}}" data-event-opts="{{[['change',[['onSubjectChange',['$event']]]]]}}" bindchange="__e"><view class="picker-display data-v-0cccd6b3"><text class="picker-text data-v-0cccd6b3">{{subjectOptions[subjectIndex]}}</text><text class="picker-arrow data-v-0cccd6b3">▼</text></view></picker></view></view></view><view class="class-list data-v-0cccd6b3"><block wx:if="{{$root.g0===0}}"><view class="no-result-tip data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">没有找到符合条件的班级</text></view></block><block wx:for="{{$root.l0}}" wx:for-item="item" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['tap',[['openClassDetail',['$0'],[[['filteredClassList','_id',item.$orig._id]]]]]]]}}" class="class-item animated-card data-v-0cccd6b3" bindtap="__e"><view class="class-header data-v-0cccd6b3"><view class="class-badge data-v-0cccd6b3"><text class="class-badge-text data-v-0cccd6b3">班</text></view><view class="class-info-main data-v-0cccd6b3"><text class="class-name data-v-0cccd6b3">{{item.$orig.className||item.$orig.class_name||'未命名班级'}}</text><block wx:if="{{item.$orig.grade}}"><text class="class-grade-badge data-v-0cccd6b3">{{item.$orig.grade}}</text></block></view><view class="student-count-badge data-v-0cccd6b3"><text class="count-text data-v-0cccd6b3">{{(item.$orig.students?item.g1:0)+"人"}}</text></view></view><view class="class-details data-v-0cccd6b3"><view class="detail-row data-v-0cccd6b3"><text class="detail-label data-v-0cccd6b3">班主任：</text><block wx:if="{{item.g2}}"><text class="detail-value data-v-0cccd6b3">{{''+item.m0+''}}</text></block><block wx:else><text class="detail-value empty-value data-v-0cccd6b3">未设置</text></block></view></view><view class="class-actions data-v-0cccd6b3"><text data-event-opts="{{[['tap',[['deleteClass',['$0'],[[['filteredClassList','_id',item.$orig._id]]]]]]]}}" class="delete-btn data-v-0cccd6b3" catchtap="__e">删除</text></view></view></block></view><block wx:if="{{showAddClassModalFlag}}"><view class="modal data-v-0cccd6b3"><view class="modal-content animated-modal data-v-0cccd6b3"><view class="modal-header data-v-0cccd6b3"><text class="modal-title data-v-0cccd6b3">新建班级</text><text data-event-opts="{{[['tap',[['closeAddClassModal',['$event']]]]]}}" class="close-btn data-v-0cccd6b3" bindtap="__e">×</text></view><view class="modal-body data-v-0cccd6b3"><view class="form-group data-v-0cccd6b3"><label class="form-label data-v-0cccd6b3">班级名称</label><input class="search-input data-v-0cccd6b3" placeholder="请输入班级名称" data-event-opts="{{[['input',[['__set_model',['$0','className','$event',[]],['newClass']]]]]}}" value="{{newClass.className}}" bindinput="__e"/></view><view class="form-group data-v-0cccd6b3"><label class="form-label data-v-0cccd6b3">年级</label><input class="search-input data-v-0cccd6b3" placeholder="请输入年级" data-event-opts="{{[['input',[['__set_model',['$0','grade','$event',[]],['newClass']]]]]}}" value="{{newClass.grade}}" bindinput="__e"/></view><view class="form-group data-v-0cccd6b3"><label class="form-label data-v-0cccd6b3">选择老师</label><view class="search-container data-v-0cccd6b3"><input class="search-input data-v-0cccd6b3" placeholder="搜索老师姓名" data-event-opts="{{[['input',[['__set_model',['','teacherSearchKeyword','$event',[]]],['onTeacherSearchInput',['$event']]]]]}}" value="{{teacherSearchKeyword}}" bindinput="__e"/></view><view class="teacher-selection data-v-0cccd6b3"><block wx:for="{{$root.l1}}" wx:for-item="teacher" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['tap',[['toggleTeacherSelection',['$0'],[[['filteredTeachers','_id',teacher.$orig._id]]]]]]]}}" class="{{['teacher-item','data-v-0cccd6b3',(teacher.m1)?'selected':'']}}" bindtap="__e"><view class="teacher-avatar data-v-0cccd6b3"><text class="avatar-text data-v-0cccd6b3">{{teacher.m2}}</text></view><text class="teacher-name data-v-0cccd6b3">{{teacher.$orig.teacherName||teacher.$orig.username}}</text><block wx:if="{{teacher.m3}}"><view class="selection-indicator data-v-0cccd6b3"><text class="check-icon data-v-0cccd6b3">✓</text></view></block></view></block><block wx:if="{{$root.g3}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">未找到匹配的老师</text></view></block></view></view></view><view class="modal-footer data-v-0cccd6b3"><button data-event-opts="{{[['tap',[['closeAddClassModal',['$event']]]]]}}" class="cancel-btn data-v-0cccd6b3" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['addClass',['$event']]]]]}}" class="confirm-btn data-v-0cccd6b3" bindtap="__e">确定</button></view></view></view></block><block wx:if="{{showClassDetailModal}}"><view class="modal data-v-0cccd6b3"><view class="modal-content class-detail-modal animated-modal data-v-0cccd6b3"><view class="modal-header data-v-0cccd6b3"><text class="modal-title data-v-0cccd6b3">{{currentClass.className+" 班级详情"}}</text><text data-event-opts="{{[['tap',[['closeClassDetailModal',['$event']]]]]}}" class="close-btn data-v-0cccd6b3" bindtap="__e">×</text></view><view class="modal-body data-v-0cccd6b3"><view class="detail-section data-v-0cccd6b3"><text class="section-title data-v-0cccd6b3">班级老师</text><view class="teacher-list data-v-0cccd6b3"><block wx:for="{{$root.l2}}" wx:for-item="teacher" wx:for-index="index" wx:key="_id"><view class="teacher-item data-v-0cccd6b3"><view class="teacher-avatar data-v-0cccd6b3"><text class="avatar-text data-v-0cccd6b3">{{teacher.m4}}</text></view><view class="teacher-info data-v-0cccd6b3"><text class="teacher-name data-v-0cccd6b3">{{teacher.$orig.teacherName||teacher.$orig.username}}</text></view><text data-event-opts="{{[['tap',[['removeTeacher',['$0'],[[['currentClass.teachers','_id',teacher.$orig._id]]]]]]]}}" class="remove-btn data-v-0cccd6b3" bindtap="__e">移除</text></view></block><block wx:if="{{$root.g4}}"><view data-event-opts="{{[['tap',[['showReplaceTeacherModal',['$event']]]]]}}" class="replace-teacher-btn data-v-0cccd6b3" bindtap="__e"><text class="data-v-0cccd6b3">🔄 替换老师</text></view></block><block wx:else><view data-event-opts="{{[['tap',[['showAddTeacherModal',['$event']]]]]}}" class="add-teacher-btn data-v-0cccd6b3" bindtap="__e"><text class="data-v-0cccd6b3">+ 添加老师</text></view></block></view></view><view class="detail-section data-v-0cccd6b3"><text class="section-title data-v-0cccd6b3">班级学生</text><view class="student-list data-v-0cccd6b3"><block wx:for="{{$root.l3}}" wx:for-item="student" wx:for-index="index" wx:key="_id"><view class="student-item data-v-0cccd6b3"><view class="student-avatar data-v-0cccd6b3"><text class="avatar-text data-v-0cccd6b3">{{student.g5}}</text></view><view class="student-info data-v-0cccd6b3"><text class="student-name data-v-0cccd6b3">{{student.$orig.name}}</text><text class="student-id data-v-0cccd6b3">{{student.$orig.studentId}}</text><block wx:if="{{student.$orig.grade}}"><text class="student-grade data-v-0cccd6b3">{{student.$orig.grade}}</text></block></view><text data-event-opts="{{[['tap',[['removeStudent',['$0'],[[['currentClass.students','_id',student.$orig._id]]]]]]]}}" class="remove-btn data-v-0cccd6b3" bindtap="__e">移除</text></view></block><block wx:if="{{$root.g6}}"><view class="no-student-tip data-v-0cccd6b3"><text class="no-student-text data-v-0cccd6b3">暂无学生</text></view></block><view data-event-opts="{{[['tap',[['showAddStudentModal',['$event']]]]]}}" class="add-student-btn data-v-0cccd6b3" bindtap="__e"><text class="data-v-0cccd6b3">+ 添加学生</text></view></view></view></view><view class="modal-footer data-v-0cccd6b3"><button data-event-opts="{{[['tap',[['closeClassDetailModal',['$event']]]]]}}" class="cancel-btn data-v-0cccd6b3" bindtap="__e">关闭</button></view></view></view></block><block wx:if="{{showAddTeacherModalFlag}}"><view class="modal data-v-0cccd6b3"><view class="modal-content animated-modal data-v-0cccd6b3"><view class="modal-header data-v-0cccd6b3"><text class="modal-title data-v-0cccd6b3">选择老师</text><text data-event-opts="{{[['tap',[['closeAddTeacherModal',['$event']]]]]}}" class="close-btn data-v-0cccd6b3" bindtap="__e">×</text></view><view class="modal-body data-v-0cccd6b3"><view class="search-container data-v-0cccd6b3"><input class="search-input data-v-0cccd6b3" placeholder="🔍 搜索老师姓名或用户名" data-event-opts="{{[['input',[['__set_model',['','teacherSearchKeyword','$event',[]]],['filterTeachers',['$event']]]]]}}" value="{{teacherSearchKeyword}}" bindinput="__e"/><text class="search-icon data-v-0cccd6b3">🔍</text></view><view class="teacher-selection data-v-0cccd6b3"><block wx:for="{{$root.l4}}" wx:for-item="teacher" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['tap',[['selectTeacherToAdd',['$0'],[[['filteredTeacherList','_id',teacher.$orig._id]]]]]]]}}" class="{{['teacher-item','data-v-0cccd6b3',(teacher.m5)?'selected':'']}}" bindtap="__e"><view class="teacher-avatar data-v-0cccd6b3"><text class="avatar-text data-v-0cccd6b3">{{teacher.m6}}</text></view><view class="teacher-info data-v-0cccd6b3"><text class="teacher-name data-v-0cccd6b3">{{teacher.$orig.teacherName||teacher.$orig.username}}</text><block wx:if="{{teacher.$orig.teacherName&&teacher.$orig.username}}"><text class="teacher-username data-v-0cccd6b3">{{"@"+teacher.$orig.username}}</text></block></view><block wx:if="{{teacher.m7}}"><view class="selection-indicator data-v-0cccd6b3"><text class="check-icon data-v-0cccd6b3">✓</text></view></block></view></block><block wx:if="{{$root.g7}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">未找到匹配的老师</text></view></block><block wx:if="{{$root.g8}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">暂无老师数据</text></view></block></view></view><view class="modal-footer data-v-0cccd6b3"><button data-event-opts="{{[['tap',[['closeAddTeacherModal',['$event']]]]]}}" class="cancel-btn data-v-0cccd6b3" bindtap="__e">取消</button><button class="confirm-btn data-v-0cccd6b3" disabled="{{!teacherToAdd}}" data-event-opts="{{[['tap',[['addTeacherToClass',['$event']]]]]}}" bindtap="__e">确定</button></view></view></view></block><block wx:if="{{showReplaceTeacherModalFlag}}"><view class="modal data-v-0cccd6b3"><view class="modal-content animated-modal data-v-0cccd6b3"><view class="modal-header data-v-0cccd6b3"><text class="modal-title data-v-0cccd6b3">替换班主任</text><text data-event-opts="{{[['tap',[['closeReplaceTeacherModal',['$event']]]]]}}" class="close-btn data-v-0cccd6b3" bindtap="__e">×</text></view><view class="modal-body data-v-0cccd6b3"><view class="search-container data-v-0cccd6b3"><input class="search-input data-v-0cccd6b3" placeholder="🔍 搜索老师姓名或用户名" data-event-opts="{{[['input',[['__set_model',['','teacherSearchKeyword','$event',[]]],['filterTeachers',['$event']]]]]}}" value="{{teacherSearchKeyword}}" bindinput="__e"/><text class="search-icon data-v-0cccd6b3">🔍</text></view><view class="teacher-selection data-v-0cccd6b3"><block wx:for="{{$root.l5}}" wx:for-item="teacher" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['tap',[['selectTeacherToReplace',['$0'],[[['filteredTeacherList','_id',teacher.$orig._id]]]]]]]}}" class="{{['teacher-item','data-v-0cccd6b3',(teacher.m8)?'selected':'']}}" bindtap="__e"><view class="teacher-avatar data-v-0cccd6b3"><text class="avatar-text data-v-0cccd6b3">{{teacher.m9}}</text></view><view class="teacher-info data-v-0cccd6b3"><text class="teacher-name data-v-0cccd6b3">{{teacher.$orig.teacherName||teacher.$orig.username}}</text><block wx:if="{{teacher.$orig.teacherName&&teacher.$orig.username}}"><text class="teacher-username data-v-0cccd6b3">{{"@"+teacher.$orig.username}}</text></block></view><block wx:if="{{teacher.m10}}"><view class="selection-indicator data-v-0cccd6b3"><text class="check-icon data-v-0cccd6b3">✓</text></view></block></view></block><block wx:if="{{$root.g9}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">未找到匹配的老师</text></view></block><block wx:if="{{$root.g10}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">暂无老师数据</text></view></block></view></view><view class="modal-footer data-v-0cccd6b3"><button data-event-opts="{{[['tap',[['closeReplaceTeacherModal',['$event']]]]]}}" class="cancel-btn data-v-0cccd6b3" bindtap="__e">取消</button><button class="confirm-btn data-v-0cccd6b3" disabled="{{!teacherToReplace}}" data-event-opts="{{[['tap',[['replaceTeacher',['$event']]]]]}}" bindtap="__e">确定</button></view></view></view></block><block wx:if="{{showAddStudentModalFlag}}"><view class="modal data-v-0cccd6b3"><view class="modal-content animated-modal data-v-0cccd6b3"><view class="modal-header data-v-0cccd6b3"><text class="modal-title data-v-0cccd6b3">选择学生</text><text data-event-opts="{{[['tap',[['closeAddStudentModal',['$event']]]]]}}" class="close-btn data-v-0cccd6b3" bindtap="__e">×</text></view><view class="modal-body data-v-0cccd6b3"><view class="search-container data-v-0cccd6b3"><input class="search-input data-v-0cccd6b3" placeholder="🔍 搜索学生姓名或学号" data-event-opts="{{[['input',[['__set_model',['','studentSearchKeyword','$event',[]]],['filterStudents',['$event']]]]]}}" value="{{studentSearchKeyword}}" bindinput="__e"/><text class="search-icon data-v-0cccd6b3">🔍</text></view><view class="student-selection-list data-v-0cccd6b3"><block wx:for="{{$root.l6}}" wx:for-item="student" wx:for-index="__i0__" wx:key="_id"><view data-event-opts="{{[['tap',[['selectStudent',['$0'],[[['filteredStudentList','_id',student.$orig._id]]]]]]]}}" class="{{['student-selection-item','data-v-0cccd6b3',(student.m11)?'selected':'']}}" bindtap="__e"><view class="student-avatar data-v-0cccd6b3"><text class="avatar-text data-v-0cccd6b3">{{student.g11}}</text></view><view class="student-info data-v-0cccd6b3"><text class="student-name data-v-0cccd6b3">{{student.$orig.name}}</text><text class="student-details data-v-0cccd6b3">{{student.$orig.studentId+" · "+student.$orig.grade}}</text></view><block wx:if="{{student.m12}}"><text class="check-icon data-v-0cccd6b3">✓</text></block></view></block><block wx:if="{{$root.g12}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">未找到匹配的学生</text></view></block><block wx:if="{{$root.g13}}"><view class="no-result data-v-0cccd6b3"><text class="no-result-text data-v-0cccd6b3">暂无学生数据，请先通过学生录入功能添加学生</text></view></block></view></view><view class="modal-footer data-v-0cccd6b3"><button data-event-opts="{{[['tap',[['closeAddStudentModal',['$event']]]]]}}" class="cancel-btn data-v-0cccd6b3" bindtap="__e">取消</button><button class="confirm-btn data-v-0cccd6b3" disabled="{{$root.g14===0}}" data-event-opts="{{[['tap',[['addSelectedStudentsToClass',['$event']]]]]}}" bindtap="__e">{{'确定 ('+$root.g15+')'}}</button></view></view></view></block><view data-event-opts="{{[['tap',[['showAddClassModal',['$event']]]]]}}" class="floating-add-btn data-v-0cccd6b3" bindtap="__e"><image class="add-icon data-v-0cccd6b3" src="/static/745 (1).png" mode="aspectFit"></image></view><block wx:if="{{showToast}}"><view class="toast data-v-0cccd6b3"><text class="toast-text data-v-0cccd6b3">{{toastMessage}}</text></view></block></view>