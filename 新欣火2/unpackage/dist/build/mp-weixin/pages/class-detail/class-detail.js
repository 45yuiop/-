(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/class-detail/class-detail"],{"48cd":function(e,t,a){"use strict";var s=a("cf4b"),n=a.n(s);n.a},7160:function(e,t,a){"use strict";(function(e,s){var n=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("7eb4")),c=n(a("ee10")),l={data:function(){return{classData:null,originalClassData:null,showTeacherModalFlag:!1,availableTeachers:[],teacherSearchKeyword:"",filteredTeachers:[],tempTeacher:null,showAddStudentModalFlag:!1,availableStudents:[],studentSearchKeyword:"",filteredStudents:[],selectedStudents:[]}},computed:{canSubmit:function(){return this.classData&&this.classData.className.trim()}},onLoad:function(e){e.classId&&this.loadClassDetail(e.classId)},methods:{goBack:function(){e.navigateBack()},loadClassDetail:function(t){var a=this;return(0,c.default)(r.default.mark((function n(){var c;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s.callFunction({name:"archive-manager",data:{action:"getClassDetail",classId:t}});case 3:c=n.sent,0===c.result.code?(a.classData=c.result.data,a.originalClassData=JSON.parse(JSON.stringify(c.result.data)),a.loadAvailableTeachers()):(e.showToast({title:"加载班级信息失败",icon:"error"}),setTimeout((function(){e.navigateBack()}),1500)),n.next=12;break;case 7:n.prev=7,n.t0=n["catch"](0),console.error("加载班级详情失败:",n.t0),e.showToast({title:"加载班级信息失败",icon:"error"}),setTimeout((function(){e.navigateBack()}),1500);case 12:case"end":return n.stop()}}),n,null,[[0,7]])})))()},loadAvailableTeachers:function(){var t=this;return(0,c.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,s.callFunction({name:"archive-manager",data:{action:"getTeachers"}});case 3:n=a.sent,0===n.result.code&&(t.availableTeachers=n.result.data||[],t.filteredTeachers=t.availableTeachers),a.next=11;break;case 7:a.prev=7,a.t0=a["catch"](0),console.error("加载老师列表失败:",a.t0),e.showToast({title:"加载老师列表失败",icon:"error"});case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))()},showTeacherModal:function(){var e=this;this.tempTeacher=this.classData.teacherId?this.availableTeachers.find((function(t){return t._id===e.classData.teacherId})):null,this.showTeacherModalFlag=!0,this.filteredTeachers=this.availableTeachers,this.teacherSearchKeyword=""},closeTeacherModal:function(){this.showTeacherModalFlag=!1},onTeacherSearchInput:function(){if(this.teacherSearchKeyword){var e=this.teacherSearchKeyword.toLowerCase();this.filteredTeachers=this.availableTeachers.filter((function(t){var a=t.teacherName||t.username||"";return a.toLowerCase().includes(e)}))}else this.filteredTeachers=this.availableTeachers},isSelectedTeacher:function(e){return this.tempTeacher&&this.tempTeacher._id===e._id},selectTeacher:function(e){this.tempTeacher=e},confirmTeacher:function(){this.tempTeacher?(this.classData.teacherId=this.tempTeacher._id,this.classData.teacherName=this.tempTeacher.teacherName||this.tempTeacher.username):(this.classData.teacherId="",this.classData.teacherName=""),this.showTeacherModalFlag=!1},loadAvailableStudents:function(){var t=this;return(0,c.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,s.callFunction({name:"archive-manager",data:{action:"getStudents",page:1,pageSize:100}});case 3:n=a.sent,0===n.result.code&&(t.availableStudents=n.result.data||[],t.filteredStudents=t.availableStudents),a.next=11;break;case 7:a.prev=7,a.t0=a["catch"](0),console.error("加载学生列表失败:",a.t0),e.showToast({title:"加载学生列表失败",icon:"error"});case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))()},showAddStudentModal:function(){var e=this;return(0,c.default)(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.showAddStudentModalFlag=!0,e.selectedStudents=[],e.studentSearchKeyword="",0!==e.availableStudents.length){t.next=8;break}return t.next=6,e.loadAvailableStudents();case 6:t.next=9;break;case 8:e.filteredStudents=e.availableStudents;case 9:case"end":return t.stop()}}),t)})))()},closeAddStudentModal:function(){this.showAddStudentModalFlag=!1,this.selectedStudents=[],this.studentSearchKeyword=""},onStudentSearchInput:function(){if(this.studentSearchKeyword){var e=this.studentSearchKeyword.toLowerCase();this.filteredStudents=this.availableStudents.filter((function(t){var a=t.name||"",s=t.studentId||"";return a.toLowerCase().includes(e)||s.toLowerCase().includes(e)}))}else this.filteredStudents=this.availableStudents},isStudentSelected:function(e){return this.selectedStudents.some((function(t){return t._id===e._id}))},selectStudent:function(e){var t=this.selectedStudents.findIndex((function(t){return t._id===e._id}));t>-1?this.selectedStudents.splice(t,1):this.selectedStudents.push(e)},addSelectedStudentsToClass:function(){var t=this;return(0,c.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(0!==t.selectedStudents.length){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,s.callFunction({name:"class-management",data:{action:"addStudentsToClass",classId:t.classData._id,studentIds:t.selectedStudents.map((function(e){return e.studentId}))}});case 5:if(n=a.sent,0!==n.result.code){a.next=12;break}e.showToast({title:"添加学生成功",icon:"success"}),t.loadClassDetail(t.classData._id),t.closeAddStudentModal(),a.next=13;break;case 12:throw new Error(n.result.message||"添加学生失败");case 13:a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](2),console.error("添加学生失败:",a.t0),e.showToast({title:"添加学生失败，请重试",icon:"error"});case 19:case"end":return a.stop()}}),a,null,[[2,15]])})))()},removeStudentFromClass:function(t){var a=this;return(0,c.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.showModal({title:"确认移除",content:"确定要从班级中移除学生 ".concat(t.name," 吗？"),success:function(){var n=(0,c.default)(r.default.mark((function n(c){var l;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!c.confirm){n.next=17;break}return n.prev=1,n.next=4,s.callFunction({name:"class-management",data:{action:"removeStudentFromClass",classId:a.classData._id,studentId:t.studentId}});case 4:if(l=n.sent,0!==l.result.code){n.next=10;break}e.showToast({title:"移除学生成功",icon:"success"}),a.loadClassDetail(a.classData._id),n.next=11;break;case 10:throw new Error(l.result.message||"移除学生失败");case 11:n.next=17;break;case 13:n.prev=13,n.t0=n["catch"](1),console.error("移除学生失败:",n.t0),e.showToast({title:"移除学生失败，请重试",icon:"error"});case 17:case"end":return n.stop()}}),n,null,[[1,13]])})));return function(e){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})))()},updateClass:function(){var t=this;return(0,c.default)(r.default.mark((function a(){var n,c;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.canSubmit){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,n={classId:t.classData._id,className:t.classData.className.trim(),grade:t.classData.grade.trim(),teacherId:t.classData.teacherId,teacherName:t.classData.teacherName},a.next=6,s.callFunction({name:"archive-manager",data:{action:"updateClass",classData:n}});case 6:if(c=a.sent,0!==c.result.code){a.next=13;break}e.showToast({title:"更新成功",icon:"success"}),t.updateArchiveCache(),setTimeout((function(){e.navigateBack()}),1500),a.next=14;break;case 13:throw new Error(c.result.message||"更新失败");case 14:a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](2),console.error("更新班级信息失败:",a.t0),e.showToast({title:"更新失败，请重试",icon:"error"});case 20:case"end":return a.stop()}}),a,null,[[2,16]])})))()},deleteClass:function(){var t=this;e.showModal({title:"确认删除",content:"确定要删除班级 ".concat(this.classData.className," 吗？"),success:function(){var a=(0,c.default)(r.default.mark((function a(n){var c;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.confirm){a.next=17;break}return a.prev=1,a.next=4,s.callFunction({name:"archive-manager",data:{action:"deleteClass",classId:t.classData._id}});case 4:if(c=a.sent,0!==c.result.code){a.next=10;break}e.showToast({title:"删除成功",icon:"success"}),setTimeout((function(){e.navigateBack()}),1500),a.next=11;break;case 10:throw new Error(c.result.message||"删除失败");case 11:a.next=17;break;case 13:a.prev=13,a.t0=a["catch"](1),console.error("删除班级失败:",a.t0),e.showToast({title:"删除失败，请重试",icon:"error"});case 17:case"end":return a.stop()}}),a,null,[[1,13]])})));return function(e){return a.apply(this,arguments)}}()})},updateArchiveCache:function(){try{var e=getApp();e.globalData&&e.globalData.updateArchiveCache?(e.globalData.updateArchiveCache(),console.log("已通知档案管理页面更新缓存")):console.log("档案管理页面未加载，无法更新缓存")}catch(t){console.error("更新档案管理缓存失败:",t)}}}};t.default=l}).call(this,a("df3c")["default"],a("861b")["uniCloud"])},"770f":function(e,t,a){"use strict";a.r(t);var s=a("7160"),n=a.n(s);for(var r in s)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(r);t["default"]=n.a},"8e4b":function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var s=function(){var e=this,t=e.$createElement,a=(e._self._c,e.classData?!e.classData.students||0===e.classData.students.length:null),s=e.showTeacherModalFlag?e.__map(e.filteredTeachers,(function(t,a){var s=e.__get_orig(t),n=e.isSelectedTeacher(t),r=e.isSelectedTeacher(t);return{$orig:s,m0:n,m1:r}})):null,n=e.showTeacherModalFlag?e.filteredTeachers.length:null,r=e.showAddStudentModalFlag?e.__map(e.filteredStudents,(function(t,a){var s=e.__get_orig(t),n=e.isStudentSelected(t),r=(t.name||"学").charAt(0),c=e.isStudentSelected(t);return{$orig:s,m2:n,g2:r,m3:c}})):null,c=e.showAddStudentModalFlag?e.filteredStudents.length:null,l=e.showAddStudentModalFlag?e.selectedStudents.length:null,i=e.showAddStudentModalFlag?e.selectedStudents.length:null;e.$mp.data=Object.assign({},{$root:{g0:a,l0:s,g1:n,l1:r,g3:c,g4:l,g5:i}})},n=[]},9786:function(e,t,a){"use strict";a.r(t);var s=a("8e4b"),n=a("770f");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("48cd");var c=a("828b"),l=Object(c["a"])(n["default"],s["b"],s["c"],!1,null,"274e801e",null,!1,s["a"],void 0);t["default"]=l.exports},ac02:function(e,t,a){"use strict";(function(e,t){var s=a("47a9");a("a226"),a("861b");s(a("3240"));var n=s(a("9786"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(n.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},cf4b:function(e,t,a){}},[["ac02","common/runtime","common/vendor"]]]);