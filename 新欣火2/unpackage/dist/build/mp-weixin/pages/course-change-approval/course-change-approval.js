(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/course-change-approval/course-change-approval"],{"1c45":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=(t._self._c,t.filteredApplications.length),n=t.__map(t.filteredApplications,(function(e,a){var n=t.__get_orig(e),r=t.formatDate(e.createTime),i="pending"!==e.status&&e.approvalTime?t.formatDate(e.approvalTime):null;return{$orig:n,m0:r,m1:i}}));t.$mp.data=Object.assign({},{$root:{g0:a,l0:n}})},r=[]},"3ad0":function(t,e,a){"use strict";a.r(e);var n=a("1c45"),r=a("847e");for(var i in r)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(i);a("5af6");var o=a("828b"),c=Object(o["a"])(r["default"],n["b"],n["c"],!1,null,"9175a3a2",null,!1,n["a"],void 0);e["default"]=c.exports},"40ce":function(t,e,a){},"5af6":function(t,e,a){"use strict";var n=a("40ce"),r=a.n(n);r.a},"847e":function(t,e,a){"use strict";a.r(e);var n=a("d5ac"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=r.a},d5ac:function(t,e,a){"use strict";(function(t,n){var r=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(a("7eb4")),o=r(a("ee10")),c={data:function(){return{applications:[],currentFilter:"all",isLoading:!1,statusBarHeight:0,topBarPadding:0,showRejectDialog:!1,rejectReason:"",rejectApplicationId:""}},computed:{filteredApplications:function(){var t=this;return"all"===this.currentFilter?this.applications:this.applications.filter((function(e){return e.status===t.currentFilter}))},statusBarStyle:function(){return"height: ".concat(this.statusBarHeight,"px; background-color: #1976D2;")},topBarStyle:function(){return"padding-top: ".concat(this.topBarPadding,"px; background-color: #1976D2;")}},onLoad:function(){this.loadApplications();var e=t.getSystemInfoSync();this.statusBarHeight=e.statusBarHeight||20,this.topBarPadding=e.statusBarHeight?e.statusBarHeight/2:10},onShow:function(){this.loadApplications()},methods:{goBack:function(){t.navigateBack()},setFilter:function(t){this.currentFilter=t},loadApplications:function(){var e=this;return(0,o.default)(i.default.mark((function a(){var r,o,c,s;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e.isLoading=!0,r=t.getStorageSync("userInfo"),o={action:"list"},c=r&&("管理员"===r.permission||"superadmin"===r.permission),c||(o.teacherId=r._id),a.next=8,n.callFunction({name:"course-change",data:o});case 8:s=a.sent,s.result&&s.result.success||s.success?e.applications=s.result&&s.result.data||s.data||[]:t.showToast({title:s.result&&s.result.message||s.message||"加载失败",icon:"none"}),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](0),t.showToast({title:"加载失败",icon:"none"});case 15:return a.prev=15,e.isLoading=!1,a.finish(15);case 18:case"end":return a.stop()}}),a,null,[[0,12,15,18]])})))()},formatDate:function(t){if(!t)return"";var e=new Date(t);return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0")," ").concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0"))},getStatusClass:function(t){return{pending:"status-pending",approved:"status-approved",rejected:"status-rejected"}[t]||"status-pending"},getStatusText:function(t){return{pending:"待审批",approved:"已通过",rejected:"已拒绝"}[t]||"待审批"},approveApplication:function(e){var a=this;return(0,o.default)(i.default.mark((function r(){var o,c,s;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t.showLoading({title:"处理中..."}),o=t.getStorageSync("userInfo"),c=o.teacherName||o.username||"",r.next=6,n.callFunction({name:"course-change",data:{action:"approve",applicationId:e._id,status:"approved",approverName:c}});case 6:s=r.sent,t.hideLoading(),s.result.success?(t.showToast({title:"审批通过",icon:"success"}),a.loadApplications()):t.showToast({title:s.result.message||"操作失败",icon:"none"}),r.next=16;break;case 11:r.prev=11,r.t0=r["catch"](0),t.hideLoading(),console.error("审批失败:",r.t0),t.showToast({title:"操作失败",icon:"none"});case 16:case"end":return r.stop()}}),r,null,[[0,11]])})))()},rejectApplication:function(t){var e=this;return(0,o.default)(i.default.mark((function a(){return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.rejectApplicationId=t._id,e.rejectReason="",e.$refs.rejectDialog.open();case 3:case"end":return a.stop()}}),a)})))()},closeRejectDialog:function(){this.$refs.rejectDialog.close()},submitReject:function(){var e=this;return(0,o.default)(i.default.mark((function a(){var r,o,c;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.rejectReason.trim()){a.next=3;break}return t.showToast({title:"请填写拒绝理由",icon:"none"}),a.abrupt("return");case 3:return a.prev=3,t.showLoading({title:"处理中..."}),r=t.getStorageSync("userInfo"),o=r.teacherName||r.username||"",a.next=9,n.callFunction({name:"course-change",data:{action:"approve",applicationId:e.rejectApplicationId,status:"rejected",approverName:o,approvalRemark:e.rejectReason}});case 9:c=a.sent,t.hideLoading(),e.$refs.rejectDialog.close(),c.result.success?(t.showToast({title:"已拒绝",icon:"success"}),e.loadApplications()):t.showToast({title:c.result.message||"操作失败",icon:"none"}),a.next=20;break;case 15:a.prev=15,a.t0=a["catch"](3),t.hideLoading(),e.$refs.rejectDialog.close(),t.showToast({title:"操作失败",icon:"none"});case 20:case"end":return a.stop()}}),a,null,[[3,15]])})))()}}};e.default=c}).call(this,a("df3c")["default"],a("861b")["uniCloud"])},fad4:function(t,e,a){"use strict";(function(t,e){var n=a("47a9");a("a226"),a("861b");n(a("3240"));var r=n(a("3ad0"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(r.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])}},[["fad4","common/runtime","common/vendor"]]]);